{"version":3,"file":"..\\www\\javascripts\\app.js","sources":["app/application.coffee","app/collections/files.coffee","app/initialize.coffee","app/lib/base_view.coffee","app/lib/basic.coffee","app/lib/device_status.coffee","app/lib/request.js","app/lib/view_collection.coffee","app/locales/digidisk.coffee","app/locales/en.coffee","app/locales/fr.coffee","app/models/file.coffee","app/replicator/filesystem.coffee","app/replicator/main.coffee","app/replicator/replicator_backups.coffee","app/replicator/replicator_config.coffee","app/replicator/replicator_mapreduce.coffee","app/replicator/utils.coffee","app/router.coffee","app/templates/config.jade","app/templates/folder_line.jade","app/templates/layout.jade","app/templates/login.jade","app/templates/menu.jade","app/views/config.coffee","app/views/folder.coffee","app/views/folder_line.coffee","app/views/layout.coffee","app/views/login.coffee","app/views/menu.coffee"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3DA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1MA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7CA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtCA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxDA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzdA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/GA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzCA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzCA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjCA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5CA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlTA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5dA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7UA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7FA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7FA;;A,CCAA;;AACA;AADA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7GA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnEA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvDA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAdA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApBA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnBA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1FA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnHA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArLA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlMA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhGA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxHA;;A","sourcesContent":["var LayoutView, Replicator;\n\nReplicator = require('./replicator/main');\n\nLayoutView = require('./views/layout');\n\nmodule.exports = {\n  initialize: function() {\n    var Router, e, locales,\n      _this = this;\n\n    window.app = this;\n    this.locale = 'en';\n    this.polyglot = new Polyglot();\n    locales = (function() {\n      try {\n        return require('locales/' + this.locale);\n      } catch (_error) {\n        e = _error;\n        return require('locales/en');\n      }\n    }).call(this);\n    this.polyglot.extend(locales);\n    window.t = this.polyglot.t.bind(this.polyglot);\n    Router = require('router');\n    this.router = new Router();\n    this.replicator = new Replicator();\n    this.layout = new LayoutView();\n    $('body').empty().append(this.layout.render().$el);\n    return this.replicator.init(function(err, config) {\n      if (err) {\n        console.log(err, err.stack);\n        return alert(err.message || err);\n      }\n      Backbone.history.start();\n      if (config.remote) {\n        _this.router.navigate('folder/', {\n          trigger: true\n        });\n        return _this.router.once('collectionfetched', function() {\n          app.replicator.startRealtime();\n          app.replicator.backup();\n          return document.addEventListener(\"resume\", function() {\n            console.log(\"RESUME EVENT\");\n            if (app.backFromOpen) {\n              return app.backFromOpen = false;\n            } else {\n              return app.replicator.backup();\n            }\n          }, false);\n        });\n      } else {\n        return _this.router.navigate('login', {\n          trigger: true\n        });\n      }\n    });\n  }\n};\n","var File, FileAndFolderCollection, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nFile = require('../models/file');\n\nmodule.exports = FileAndFolderCollection = (function(_super) {\n  __extends(FileAndFolderCollection, _super);\n\n  function FileAndFolderCollection() {\n    _ref = FileAndFolderCollection.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  FileAndFolderCollection.prototype.model = File;\n\n  FileAndFolderCollection.cache = {};\n\n  FileAndFolderCollection.prototype.initialize = function(models, options) {\n    this.path = options.path;\n    this.query = options.query;\n    return this.notloaded = true;\n  };\n\n  FileAndFolderCollection.prototype.comparator = function(a, b) {\n    var aname, atype, bname, btype, out;\n\n    if (a.isDeviceFolder) {\n      return -1;\n    }\n    if (b.isDeviceFolder) {\n      return 1;\n    }\n    atype = a.get('docType').toLowerCase();\n    btype = b.get('docType').toLowerCase();\n    aname = a.get('name').toLowerCase();\n    bname = b.get('name').toLowerCase();\n    return out = atype < btype ? 1 : atype > btype ? -1 : aname > bname ? 2 : aname < bname ? -2 : 0;\n  };\n\n  FileAndFolderCollection.prototype.isSearch = function() {\n    return this.path === void 0;\n  };\n\n  FileAndFolderCollection.prototype.search = function(callback) {\n    var params,\n      _this = this;\n\n    params = {\n      query: this.query,\n      fields: ['name'],\n      include_docs: true\n    };\n    return app.replicator.db.search(params, function(err, items) {\n      return _this.slowReset(items, function(err) {\n        _this.notloaded = false;\n        return callback(err);\n      });\n    });\n  };\n\n  FileAndFolderCollection.prototype.fetch = function(_callback) {\n    var cacheKey, callback, items,\n      _this = this;\n\n    if (_callback == null) {\n      _callback = function() {};\n    }\n    callback = function(err) {\n      _this.notloaded = false;\n      _this.trigger('sync');\n      return _callback(err);\n    };\n    cacheKey = this.path === null ? '' : this.path;\n    if (cacheKey in FileAndFolderCollection.cache) {\n      items = FileAndFolderCollection.cache[cacheKey];\n      return this.slowReset(items, function(err) {\n        if (!err) {\n          _this.fetchAdditional();\n        }\n        return callback(err);\n      });\n    }\n    console.log(\"CACHE MISS \" + cacheKey);\n    return this._fetch(this.path, function(err, items) {\n      if (err) {\n        return callback(err);\n      }\n      return _this.slowReset(items, function(err) {\n        if (!err) {\n          _this.fetchAdditional();\n        }\n        return callback(err);\n      });\n    });\n  };\n\n  FileAndFolderCollection.prototype._fetch = function(path, callback) {\n    var params;\n\n    params = {\n      key: path ? '/' + path : '',\n      include_docs: true\n    };\n    return app.replicator.db.query('FilesAndFolder', params, callback);\n  };\n\n  FileAndFolderCollection.prototype.slowReset = function(results, callback) {\n    var i, models, nonBlockingAdd,\n      _this = this;\n\n    models = results.rows.map(function(row) {\n      var binary_id, doc, _ref1;\n\n      doc = row.doc;\n      if (binary_id = (_ref1 = doc.binary) != null ? _ref1.file.id : void 0) {\n        doc.incache = app.replicator.fileInFileSystem(doc);\n      }\n      return doc;\n    });\n    this.reset(models.slice(0, 10));\n    i = 0;\n    return (nonBlockingAdd = function() {\n      if (i * 10 > models.length) {\n        _this.nextAdd = null;\n        return callback(null);\n      }\n      i++;\n      _this.add(models.slice(i * 10, (i + 1) * 10));\n      return _this.nextAdd = setTimeout(nonBlockingAdd, 10);\n    })();\n  };\n\n  FileAndFolderCollection.prototype.remove = function() {\n    FileAndFolderCollection.__super__.remove.apply(this, arguments);\n    return this.clearTimeout(this.nextAdd);\n  };\n\n  FileAndFolderCollection.prototype.cancelFetchAdditional = function() {\n    return this.cancelled = true;\n  };\n\n  FileAndFolderCollection.prototype.fetchAdditional = function() {\n    var toBeCached,\n      _this = this;\n\n    FileAndFolderCollection.cache = {};\n    toBeCached = this.filter(function(model) {\n      var _ref1;\n\n      return ((_ref1 = model.get('docType')) != null ? _ref1.toLowerCase() : void 0) === 'folder';\n    });\n    return async.eachSeries(toBeCached, function(folder, cb) {\n      var path;\n\n      if (_this.cancelled) {\n        return cb(new Error('cancelled'));\n      }\n      path = folder.wholePath();\n      return _this._fetch(path, function(err, items) {\n        if (this.cancelled) {\n          return cb(new Error('cancelled'));\n        }\n        if (!err) {\n          FileAndFolderCollection.cache[path] = items;\n        }\n        return app.replicator.folderInFileSystem(path, function(err, incache) {\n          if (this.cancelled) {\n            return cb(new Error('cancelled'));\n          }\n          if (err) {\n            console.log(err);\n          }\n          folder.set('incache', incache);\n          return setTimeout(cb, 10);\n        });\n      });\n    }, function(err) {\n      var path;\n\n      if (_this.cancelled) {\n        return;\n      }\n      if (err) {\n        console.log(err);\n      }\n      path = (_this.path || '').split('/').slice(0, -1).join('/');\n      return _this._fetch(path, function(err, items) {\n        if (_this.cancelled) {\n          return;\n        }\n        if (!err) {\n          FileAndFolderCollection.cache[path] = items;\n        }\n        return _this.trigger('fullsync');\n      });\n    });\n  };\n\n  return FileAndFolderCollection;\n\n})(Backbone.Collection);\n","var app;\n\napp = require('application');\n\ndocument.addEventListener('deviceready', function() {\n  return app.initialize();\n});\n","var BaseView, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nmodule.exports = BaseView = (function(_super) {\n  __extends(BaseView, _super);\n\n  function BaseView() {\n    _ref = BaseView.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  BaseView.prototype.template = function() {};\n\n  BaseView.prototype.initialize = function() {};\n\n  BaseView.prototype.getRenderData = function() {\n    var _ref1;\n\n    return {\n      model: (_ref1 = this.model) != null ? _ref1.toJSON() : void 0\n    };\n  };\n\n  BaseView.prototype.render = function() {\n    this.beforeRender();\n    this.$el.html(this.template(this.getRenderData()));\n    this.afterRender();\n    return this;\n  };\n\n  BaseView.prototype.beforeRender = function() {};\n\n  BaseView.prototype.afterRender = function() {};\n\n  BaseView.prototype.destroy = function() {\n    this.undelegateEvents();\n    this.$el.removeData().unbind();\n    this.remove();\n    return Backbone.View.prototype.remove.call(this);\n  };\n\n  return BaseView;\n\n})(Backbone.View);\n","var b64, b64_enc, basic;\n\nb64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n\nb64_enc = function(data) {\n  var ac, bits, h1, h2, h3, h4, i, o1, o2, o3, out;\n\n  if (!data) {\n    return data;\n  }\n  i = 0;\n  ac = 0;\n  out = [];\n  while (i < data.length) {\n    o1 = data.charCodeAt(i++);\n    o2 = data.charCodeAt(i++);\n    o3 = data.charCodeAt(i++);\n    bits = o1 << 16 | o2 << 8 | o3;\n    h1 = bits >> 18 & 0x3f;\n    h2 = bits >> 12 & 0x3f;\n    h3 = bits >> 6 & 0x3f;\n    h4 = bits & 0x3f;\n    out[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\n  }\n  out = out.join('');\n  switch (data.length % 3) {\n    case 1:\n      out = out.slice(0, -2) + '==';\n      break;\n    case 2:\n      out = out.slice(0, -1) + '=';\n  }\n  return out;\n};\n\nmodule.exports = basic = function(auth) {\n  return 'Basic ' + b64_enc(auth.username + ':' + auth.password);\n};\n","var battery, callbackWaiting, callbacks, initialized, readyForSync, readyForSyncMsg, update;\n\ncallbacks = [];\n\ninitialized = false;\n\nreadyForSync = null;\n\nreadyForSyncMsg = \"\";\n\nbattery = null;\n\ncallbackWaiting = function(err, ready, msg) {\n  var callback, _i, _len;\n\n  readyForSync = ready;\n  readyForSyncMsg = msg;\n  for (_i = 0, _len = callbacks.length; _i < _len; _i++) {\n    callback = callbacks[_i];\n    callback(err, ready, msg);\n  }\n  return callbacks = [];\n};\n\nupdate = function() {\n  if (battery == null) {\n    return;\n  }\n  if (!(battery.level > 20 || battery.isPlugged)) {\n    return callbackWaiting(null, false, 'no battery');\n  }\n  if (app.replicator.config.get('syncOnWifi') && !navigator.connection.type === Connection.WIFI) {\n    return callbackWaiting(null, false, 'no wifi');\n  }\n  return callbackWaiting(null, true);\n};\n\nmodule.exports.checkReadyForSync = function(callback) {\n  var _this = this;\n\n  if (readyForSync != null) {\n    callback(null, readyForSync, readyForSyncMsg);\n  } else if (window.isBrowserDebugging) {\n    callback(null, true);\n  } else {\n    callbacks.push(callback);\n  }\n  if (!initialized) {\n    window.addEventListener('batterystatus', function(newStatus) {\n      battery = newStatus;\n      return update();\n    }, false);\n    app.replicator.config.on('change:syncOnWifi', update);\n    return initialized = true;\n  }\n};\n","// Browser Request\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nvar XHR = XMLHttpRequest\r\nif (!XHR) throw new Error('missing XMLHttpRequest')\r\nrequest.log = {\r\n  'trace': noop, 'debug': noop, 'info': noop, 'warn': noop, 'error': noop\r\n}\r\n\r\nvar DEFAULT_TIMEOUT = 3 * 60 * 1000 // 3 minutes\r\n\r\n//\r\n// request\r\n//\r\n\r\nfunction request(options, callback) {\r\n  // The entry-point to the API: prep the options object and pass the real work to run_xhr.\r\n  if(typeof callback !== 'function')\r\n    throw new Error('Bad callback given: ' + callback)\r\n\r\n  if(!options)\r\n    throw new Error('No options given')\r\n\r\n  var options_onResponse = options.onResponse; // Save this for later.\r\n\r\n  if(typeof options === 'string')\r\n    options = {'uri':options};\r\n  else\r\n    options = JSON.parse(JSON.stringify(options)); // Use a duplicate for mutating.\r\n\r\n  options.onResponse = options_onResponse // And put it back.\r\n\r\n  if (options.verbose) request.log = getLogger();\r\n\r\n  if(options.url) {\r\n    options.uri = options.url;\r\n    delete options.url;\r\n  }\r\n\r\n  if(!options.uri && options.uri !== \"\")\r\n    throw new Error(\"options.uri is a required argument\");\r\n\r\n  if(typeof options.uri != \"string\")\r\n    throw new Error(\"options.uri must be a string\");\r\n\r\n  var unsupported_options = ['proxy', '_redirectsFollowed', 'maxRedirects', 'followRedirect']\r\n  for (var i = 0; i < unsupported_options.length; i++)\r\n    if(options[ unsupported_options[i] ])\r\n      throw new Error(\"options.\" + unsupported_options[i] + \" is not supported\")\r\n\r\n  options.callback = callback\r\n  options.method = options.method || 'GET';\r\n  options.headers = options.headers || {};\r\n  options.body    = options.body || null\r\n  options.timeout = options.timeout || request.DEFAULT_TIMEOUT\r\n\r\n  if(options.headers.host)\r\n    throw new Error(\"Options.headers.host is not supported\");\r\n\r\n  if(options.json) {\r\n    options.headers.accept = options.headers.accept || 'application/json'\r\n    if(options.method !== 'GET')\r\n      options.headers['content-type'] = 'application/json'\r\n\r\n    if(typeof options.json !== 'boolean')\r\n      options.body = JSON.stringify(options.json)\r\n    else if(typeof options.body !== 'string')\r\n      options.body = JSON.stringify(options.body)\r\n  }\r\n\r\n  //BEGIN QS Hack\r\n  var serialize = function(obj) {\r\n    var str = [];\r\n    for(var p in obj)\r\n      if (obj.hasOwnProperty(p)) {\r\n        str.push(encodeURIComponent(p) + \"=\" + encodeURIComponent(obj[p]));\r\n      }\r\n    return str.join(\"&\");\r\n  }\r\n\r\n  if(options.qs){\r\n    var qs = (typeof options.qs == 'string')? options.qs : serialize(options.qs);\r\n    if(options.uri.indexOf('?') !== -1){ //no get params\r\n        options.uri = options.uri+'&'+qs;\r\n    }else{ //existing get params\r\n        options.uri = options.uri+'?'+qs;\r\n    }\r\n  }\r\n  //END QS Hack\r\n\r\n  //BEGIN FORM Hack\r\n  var multipart = function(obj) {\r\n    //todo: support file type (useful?)\r\n    var result = {};\r\n    result.boundry = '-------------------------------'+Math.floor(Math.random()*1000000000);\r\n    var lines = [];\r\n    for(var p in obj){\r\n        if (obj.hasOwnProperty(p)) {\r\n            lines.push(\r\n                '--'+result.boundry+\"\\n\"+\r\n                'Content-Disposition: form-data; name=\"'+p+'\"'+\"\\n\"+\r\n                \"\\n\"+\r\n                obj[p]+\"\\n\"\r\n            );\r\n        }\r\n    }\r\n    lines.push( '--'+result.boundry+'--' );\r\n    result.body = lines.join('');\r\n    result.length = result.body.length;\r\n    result.type = 'multipart/form-data; boundary='+result.boundry;\r\n    return result;\r\n  }\r\n\r\n  if(options.form){\r\n    if(typeof options.form == 'string') throw('form name unsupported');\r\n    if(options.method === 'POST'){\r\n        var encoding = (options.encoding || 'application/x-www-form-urlencoded').toLowerCase();\r\n        options.headers['content-type'] = encoding;\r\n        switch(encoding){\r\n            case 'application/x-www-form-urlencoded':\r\n                options.body = serialize(options.form).replace(/%20/g, \"+\");\r\n                break;\r\n            case 'multipart/form-data':\r\n                var multi = multipart(options.form);\r\n                //options.headers['content-length'] = multi.length;\r\n                options.body = multi.body;\r\n                options.headers['content-type'] = multi.type;\r\n                break;\r\n            default : throw new Error('unsupported encoding:'+encoding);\r\n        }\r\n    }\r\n  }\r\n  //END FORM Hack\r\n\r\n  // If onResponse is boolean true, call back immediately when the response is known,\r\n  // not when the full request is complete.\r\n  options.onResponse = options.onResponse || noop\r\n  if(options.onResponse === true) {\r\n    options.onResponse = callback\r\n    options.callback = noop\r\n  }\r\n\r\n  // XXX Browsers do not like this.\r\n  //if(options.body)\r\n  //  options.headers['content-length'] = options.body.length;\r\n\r\n  // HTTP basic authentication\r\n  if(!options.headers.authorization && options.auth)\r\n    options.headers.authorization = 'Basic ' + b64_enc(options.auth.username + ':' + options.auth.password);\r\n\r\n  return run_xhr(options)\r\n}\r\n\r\nvar req_seq = 0\r\nfunction run_xhr(options) {\r\n  var xhr = new XHR\r\n    , timed_out = false\r\n    , is_cors = is_crossDomain(options.uri)\r\n    , supports_cors = ('withCredentials' in xhr)\r\n\r\n  req_seq += 1\r\n  xhr.seq_id = req_seq\r\n  xhr.id = req_seq + ': ' + options.method + ' ' + options.uri\r\n  xhr._id = xhr.id // I know I will type \"_id\" from habit all the time.\r\n\r\n  if(is_cors && !supports_cors) {\r\n    var cors_err = new Error('Browser does not support cross-origin request: ' + options.uri)\r\n    cors_err.cors = 'unsupported'\r\n    return options.callback(cors_err, xhr)\r\n  }\r\n\r\n  xhr.timeoutTimer = setTimeout(too_late, options.timeout)\r\n  function too_late() {\r\n    timed_out = true\r\n    var er = new Error('ETIMEDOUT')\r\n    er.code = 'ETIMEDOUT'\r\n    er.duration = options.timeout\r\n\r\n    request.log.error('Timeout', { 'id':xhr._id, 'milliseconds':options.timeout })\r\n    return options.callback(er, xhr)\r\n  }\r\n\r\n  // Some states can be skipped over, so remember what is still incomplete.\r\n  var did = {'response':false, 'loading':false, 'end':false}\r\n\r\n  xhr.onreadystatechange = on_state_change\r\n  xhr.open(options.method, options.uri, true) // asynchronous\r\n  if(is_cors)\r\n    xhr.withCredentials = !! options.withCredentials\r\n  xhr.send(options.body)\r\n  return xhr\r\n\r\n  function on_state_change(event) {\r\n    if(timed_out)\r\n      return request.log.debug('Ignoring timed out state change', {'state':xhr.readyState, 'id':xhr.id})\r\n\r\n    request.log.debug('State change', {'state':xhr.readyState, 'id':xhr.id, 'timed_out':timed_out})\r\n\r\n    if(xhr.readyState === XHR.OPENED) {\r\n      request.log.debug('Request started', {'id':xhr.id})\r\n      for (var key in options.headers)\r\n        xhr.setRequestHeader(key, options.headers[key])\r\n    }\r\n\r\n    else if(xhr.readyState === XHR.HEADERS_RECEIVED)\r\n      on_response()\r\n\r\n    else if(xhr.readyState === XHR.LOADING) {\r\n      on_response()\r\n      on_loading()\r\n    }\r\n\r\n    else if(xhr.readyState === XHR.DONE) {\r\n      on_response()\r\n      on_loading()\r\n      on_end()\r\n    }\r\n  }\r\n\r\n  function on_response() {\r\n    if(did.response)\r\n      return\r\n\r\n    did.response = true\r\n    request.log.debug('Got response', {'id':xhr.id, 'status':xhr.status})\r\n    clearTimeout(xhr.timeoutTimer)\r\n    xhr.statusCode = xhr.status // Node request compatibility\r\n\r\n    // Detect failed CORS requests.\r\n    if(is_cors && xhr.statusCode == 0) {\r\n      var cors_err = new Error('CORS request rejected: ' + options.uri)\r\n      cors_err.cors = 'rejected'\r\n\r\n      // Do not process this request further.\r\n      did.loading = true\r\n      did.end = true\r\n\r\n      return options.callback(cors_err, xhr)\r\n    }\r\n\r\n    options.onResponse(null, xhr)\r\n  }\r\n\r\n  function on_loading() {\r\n    if(did.loading)\r\n      return\r\n\r\n    did.loading = true\r\n    request.log.debug('Response body loading', {'id':xhr.id})\r\n    // TODO: Maybe simulate \"data\" events by watching xhr.responseText\r\n  }\r\n\r\n  function on_end() {\r\n    if(did.end)\r\n      return\r\n\r\n    did.end = true\r\n    request.log.debug('Request done', {'id':xhr.id})\r\n\r\n    xhr.body = xhr.responseText\r\n    if(options.json) {\r\n      try        { xhr.body = JSON.parse(xhr.responseText) }\r\n      catch (er) { return options.callback(er, xhr)        }\r\n    }\r\n\r\n    options.callback(null, xhr, xhr.body)\r\n  }\r\n\r\n} // request\r\n\r\nrequest.withCredentials = false;\r\nrequest.DEFAULT_TIMEOUT = DEFAULT_TIMEOUT;\r\n\r\n//\r\n// defaults\r\n//\r\n\r\nrequest.defaults = function(options, requester) {\r\n  var def = function (method) {\r\n    var d = function (params, callback) {\r\n      if(typeof params === 'string')\r\n        params = {'uri': params};\r\n      else {\r\n        params = JSON.parse(JSON.stringify(params));\r\n      }\r\n      for (var i in options) {\r\n        if (params[i] === undefined) params[i] = options[i]\r\n      }\r\n      return method(params, callback)\r\n    }\r\n    return d\r\n  }\r\n  var de = def(request)\r\n  de.get = def(request.get)\r\n  de.post = def(request.post)\r\n  de.put = def(request.put)\r\n  de.head = def(request.head)\r\n  return de\r\n}\r\n\r\n//\r\n// HTTP method shortcuts\r\n//\r\n\r\nvar shortcuts = [ 'get', 'put', 'post', 'head' ];\r\nshortcuts.forEach(function(shortcut) {\r\n  var method = shortcut.toUpperCase();\r\n  var func   = shortcut.toLowerCase();\r\n\r\n  request[func] = function(opts) {\r\n    if(typeof opts === 'string')\r\n      opts = {'method':method, 'uri':opts};\r\n    else {\r\n      opts = JSON.parse(JSON.stringify(opts));\r\n      opts.method = method;\r\n    }\r\n\r\n    var args = [opts].concat(Array.prototype.slice.apply(arguments, [1]));\r\n    return request.apply(this, args);\r\n  }\r\n})\r\n\r\n//\r\n// CouchDB shortcut\r\n//\r\n\r\nrequest.couch = function(options, callback) {\r\n  if(typeof options === 'string')\r\n    options = {'uri':options}\r\n\r\n  // Just use the request API to do JSON.\r\n  options.json = true\r\n  if(options.body)\r\n    options.json = options.body\r\n  delete options.body\r\n\r\n  callback = callback || noop\r\n\r\n  var xhr = request(options, couch_handler)\r\n  return xhr\r\n\r\n  function couch_handler(er, resp, body) {\r\n    if(er)\r\n      return callback(er, resp, body)\r\n\r\n    if((resp.statusCode < 200 || resp.statusCode > 299) && body.error) {\r\n      // The body is a Couch JSON object indicating the error.\r\n      er = new Error('CouchDB error: ' + (body.error.reason || body.error.error || body.error))\r\n      for (var key in body)\r\n        er[key] = body[key]\r\n      return callback(er, resp, body);\r\n    }\r\n\r\n    return callback(er, resp, body);\r\n  }\r\n}\r\n\r\n//\r\n// Utility\r\n//\r\n\r\nfunction noop() {}\r\n\r\nfunction getLogger() {\r\n  var logger = {}\r\n    , levels = ['trace', 'debug', 'info', 'warn', 'error']\r\n    , level, i\r\n\r\n  for(i = 0; i < levels.length; i++) {\r\n    level = levels[i]\r\n\r\n    logger[level] = noop\r\n    if(typeof console !== 'undefined' && console && console[level])\r\n      logger[level] = formatted(console, level)\r\n  }\r\n\r\n  return logger\r\n}\r\n\r\nfunction formatted(obj, method) {\r\n  return formatted_logger\r\n\r\n  function formatted_logger(str, context) {\r\n    if(typeof context === 'object')\r\n      str += ' ' + JSON.stringify(context)\r\n\r\n    return obj[method].call(obj, str)\r\n  }\r\n}\r\n\r\n// Return whether a URL is a cross-domain request.\r\nfunction is_crossDomain(url) {\r\n  var rurl = /^([\\w\\+\\.\\-]+:)(?:\\/\\/([^\\/?#:]*)(?::(\\d+))?)?/\r\n\r\n  // jQuery #8138, IE may throw an exception when accessing\r\n  // a field from window.location if document.domain has been set\r\n  var ajaxLocation\r\n  try { ajaxLocation = location.href }\r\n  catch (e) {\r\n    // Use the href attribute of an A element since IE will modify it given document.location\r\n    ajaxLocation = document.createElement( \"a\" );\r\n    ajaxLocation.href = \"\";\r\n    ajaxLocation = ajaxLocation.href;\r\n  }\r\n\r\n  var ajaxLocParts = rurl.exec(ajaxLocation.toLowerCase()) || []\r\n    , parts = rurl.exec(url.toLowerCase() )\r\n\r\n  var result = !!(\r\n    parts &&\r\n    (  parts[1] != ajaxLocParts[1]\r\n    || parts[2] != ajaxLocParts[2]\r\n    || (parts[3] || (parts[1] === \"http:\" ? 80 : 443)) != (ajaxLocParts[3] || (ajaxLocParts[1] === \"http:\" ? 80 : 443))\r\n    )\r\n  )\r\n\r\n  //console.debug('is_crossDomain('+url+') -> ' + result)\r\n  return result\r\n}\r\n\r\n// MIT License from http://phpjs.org/functions/base64_encode:358\r\nfunction b64_enc (data) {\r\n    // Encodes string using MIME base64 algorithm\r\n    var b64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\r\n    var o1, o2, o3, h1, h2, h3, h4, bits, i = 0, ac = 0, enc=\"\", tmp_arr = [];\r\n\r\n    if (!data) {\r\n        return data;\r\n    }\r\n\r\n    // assume utf8 data\r\n    // data = this.utf8_encode(data+'');\r\n\r\n    do { // pack three octets into four hexets\r\n        o1 = data.charCodeAt(i++);\r\n        o2 = data.charCodeAt(i++);\r\n        o3 = data.charCodeAt(i++);\r\n\r\n        bits = o1<<16 | o2<<8 | o3;\r\n\r\n        h1 = bits>>18 & 0x3f;\r\n        h2 = bits>>12 & 0x3f;\r\n        h3 = bits>>6 & 0x3f;\r\n        h4 = bits & 0x3f;\r\n\r\n        // use hexets to index into b64, and append result to encoded string\r\n        tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\r\n    } while (i < data.length);\r\n\r\n    enc = tmp_arr.join('');\r\n\r\n    switch (data.length % 3) {\r\n        case 1:\r\n            enc = enc.slice(0, -2) + '==';\r\n        break;\r\n        case 2:\r\n            enc = enc.slice(0, -1) + '=';\r\n        break;\r\n    }\r\n\r\n    return enc;\r\n}\r\nmodule.exports = request;","var BaseView, ViewCollection, _ref,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('lib/base_view');\n\nmodule.exports = ViewCollection = (function(_super) {\n  __extends(ViewCollection, _super);\n\n  function ViewCollection() {\n    this.removeItem = __bind(this.removeItem, this);\n    this.addItem = __bind(this.addItem, this);    _ref = ViewCollection.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  ViewCollection.prototype.itemview = null;\n\n  ViewCollection.prototype.views = {};\n\n  ViewCollection.prototype.template = function() {\n    return '';\n  };\n\n  ViewCollection.prototype.itemViewOptions = function() {};\n\n  ViewCollection.prototype.collectionEl = null;\n\n  ViewCollection.prototype.onChange = function() {\n    return this.$el.toggleClass('empty', _.size(this.views) === 0);\n  };\n\n  ViewCollection.prototype.appendView = function(view) {\n    return this.$collectionEl.append(view.el);\n  };\n\n  ViewCollection.prototype.initialize = function() {\n    ViewCollection.__super__.initialize.apply(this, arguments);\n    this.views = {};\n    this.listenTo(this.collection, \"reset\", this.onReset);\n    this.listenTo(this.collection, \"add\", this.addItem);\n    this.listenTo(this.collection, \"remove\", this.removeItem);\n    if (this.collectionEl == null) {\n      this.collectionEl = this.el;\n      return this.$collectionEl = this.$el;\n    }\n  };\n\n  ViewCollection.prototype.render = function() {\n    var id, view, _ref1;\n\n    _ref1 = this.views;\n    for (id in _ref1) {\n      view = _ref1[id];\n      view.$el.detach();\n    }\n    return ViewCollection.__super__.render.apply(this, arguments);\n  };\n\n  ViewCollection.prototype.afterRender = function() {\n    var id, view, _ref1;\n\n    if (!this.$collectionEl) {\n      this.$collectionEl = this.$(this.collectionEl);\n    }\n    _ref1 = this.views;\n    for (id in _ref1) {\n      view = _ref1[id];\n      this.appendView(view);\n    }\n    this.onReset(this.collection);\n    return this.onChange(this.views);\n  };\n\n  ViewCollection.prototype.remove = function() {\n    this.onReset([]);\n    return ViewCollection.__super__.remove.apply(this, arguments);\n  };\n\n  ViewCollection.prototype.onReset = function(newcollection) {\n    var id, view, _ref1;\n\n    _ref1 = this.views;\n    for (id in _ref1) {\n      view = _ref1[id];\n      view.remove();\n    }\n    return newcollection.forEach(this.addItem);\n  };\n\n  ViewCollection.prototype.addItem = function(model) {\n    var options, view;\n\n    options = _.extend({}, {\n      model: model\n    }, this.itemViewOptions(model));\n    view = new this.itemview(options);\n    this.views[model.cid] = view.render();\n    this.appendView(view);\n    return this.onChange(this.views);\n  };\n\n  ViewCollection.prototype.removeItem = function(model) {\n    this.views[model.cid].remove();\n    delete this.views[model.cid];\n    return this.onChange(this.views);\n  };\n\n  return ViewCollection;\n\n})(BaseView);\n","module.exports = {\n  \"app name\": \"Digidisk mobile\",\n  \"cozy url\": \"Addresse Digidisk\",\n  \"cozy password\": \"Mot de Passe\",\n  \"device name\": \"Nom du device\",\n  \"search\": \"Recherche\",\n  \"config\": \"Config\",\n  \"never\": \"Jamais\",\n  \"phone2cozy title\": \"Sauvegarde téléphone\",\n  \"contacts sync label\": \"Sauvegarde contacts\",\n  \"images sync label\": \"Sauvegarde images\",\n  \"wifi sync label\": \"Sauvegarde en Wifi uniquement\",\n  \"config done\": \"Lancer première sauvegarde\",\n  \"home\": \"Accueil\",\n  \"about\": \"A propos\",\n  \"last sync\": \"Dernière synchro : \",\n  \"last backup\": \"Sauvegardé : \",\n  \"reset\": \"Reset\",\n  \"reset warning\": \"Cela supprimera toutes les données digidisk sur votre mobile.\",\n  \"pull to sync\": \"Tirer pour synchroniser\",\n  \"syncing\": \"En cours de synchro\",\n  \"contacts_scan\": \"Extraction des contacts\",\n  \"contacts_sync\": \"Sauvegarde des contacts\",\n  \"pictures_sync\": \"Sauvegarde des images\",\n  \"synchronized with\": \"Synchronisé avec \",\n  \"this folder is empty\": \"Ce dossier est vide.\",\n  \"no results\": \"Pas de résultats\",\n  \"loading\": \"Chargement ...\",\n  \"remove local\": \"Supprimer du tel\",\n  \"download\": \"Télécharger\",\n  \"sync\": \"Rafraichir\",\n  \"backup\": \"Sauvegarde\",\n  \"save\": \"Login\",\n  \"registering\": \"Connection\",\n  \"downloading hierarchy\": \"Téléchargement metadonnées : \",\n  \"replication complete\": \"Replication complète\",\n  \"no activity found\": \"Aucune application sur votre téléphone ne permet d'ouvrir ce type de fichier.\",\n  \"not enough space\": \"Il n'y a pas suffisament de place sur votre téléphone, supprimez des données du cache.\",\n  \"no battery\": \"La sauvegarde n'aura pas lieu car vous manquez de batterie.\",\n  \"no wifi\": \"La sauvegarde n'aura pas lieu car vous n'êtes pas en wifi.\"\n};\n","module.exports = {\n  \"app name\": \"Cozy mobile\",\n  \"cozy url\": \"Cozy's domain\",\n  \"cozy password\": \"Cozy's password\",\n  \"device name\": \"Name this device\",\n  \"search\": \"search\",\n  \"config\": \"Config\",\n  \"never\": \"Never\",\n  \"phone2cozy title\": \"Phone to Cozy backup\",\n  \"contacts sync label\": \"Backup contacts\",\n  \"images sync label\": \"Backup images\",\n  \"wifi sync label\": \"Backup on Wifi only\",\n  \"config done\": \"Save and run first backup\",\n  \"home\": \"Home\",\n  \"about\": \"About\",\n  \"last sync\": \"Last sync was : \",\n  \"last backup\": \"Last was : \",\n  \"reset\": \"Reset\",\n  \"reset warning\": \"This will erase all cozy-generated data on your phone\",\n  \"pull to sync\": \"Pull to sync\",\n  \"syncing\": \"Syncing\",\n  \"contacts_scan\": \"Scanning contacts for changes\",\n  \"contacts_sync\": \"Syncing contacts\",\n  \"pictures_sync\": \"Syncing pictures\",\n  \"synchronized with\": \"Synchronized with \",\n  \"this folder is empty\": \"This folder is empty.\",\n  \"no results\": \"No results\",\n  \"loading\": \"Loading\",\n  \"remove local\": \"Remove local\",\n  \"download\": \"Download\",\n  \"sync\": \"Refresh\",\n  \"backup\": \"Backup\",\n  \"save\": \"Login\",\n  \"registering\": \"Registering\",\n  \"downloading hierarchy\": \"Downloading hierarchy\",\n  \"replication complete\": \"Replication complete\",\n  \"no activity found\": \"No application on phone for this kind of file.\",\n  \"not enough space\": \"Not enough disk space, remove some files from cache.\",\n  \"no battery\": \"Not enough battery, Backup cancelled.\",\n  \"no wifi\": \"No Wifi, Backup cancelled.\"\n};\n","module.exports = {\n  \"app name\": \"Cozy mobile\",\n  \"cozy url\": \"Addresse Cozy\",\n  \"cozy password\": \"Mot de Passe\",\n  \"device name\": \"Nom du device\",\n  \"search\": \"Recherche\",\n  \"config\": \"Config\",\n  \"never\": \"Jamais\",\n  \"phone2cozy title\": \"Backup téléphone\",\n  \"contacts sync label\": \"Backup contacts\",\n  \"images sync label\": \"Backup images\",\n  \"wifi sync label\": \"Backup uniquement en Wifi\",\n  \"config done\": \"Sauvegarder et lancer le premier backup\",\n  \"home\": \"Accueil\",\n  \"about\": \"A propos\",\n  \"last sync\": \"Dernière synchro : \",\n  \"last backup\": \"Dernier backup : \",\n  \"reset\": \"Reset\",\n  \"reset warning\": \"Cela supprimera toutes les données digidisk sur votre mobile.\",\n  \"pull to sync\": \"Tirer pour synchroniser\",\n  \"syncing\": \"En cours de synchro\",\n  \"contacts_scan\": \"Extraction des contacts\",\n  \"contacts_sync\": \"Synchronisation des contacts\",\n  \"pictures_sync\": \"Synchronisation des images\",\n  \"synchronized with\": \"Synchronizé avec \",\n  \"this folder is empty\": \"Ce dossier est vide.\",\n  \"no results\": \"Pas de résultats\",\n  \"loading\": \"Chargement\",\n  \"remove local\": \"Supprimer du tel\",\n  \"download\": \"Télécharger\",\n  \"not enough space\": \"There is not enough disk space, try download sub-folders.\",\n  \"not ready for sync\": \"La réplication n'aura pas lieu car vous n'êtes pas en wifi.\"\n};\n","var File, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nmodule.exports = File = (function(_super) {\n  __extends(File, _super);\n\n  function File() {\n    _ref = File.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  File.prototype.idAttribute = \"_id\";\n\n  File.prototype.defaults = function() {\n    return {\n      incache: 'loading'\n    };\n  };\n\n  File.prototype.initialize = function() {\n    return this.isDeviceFolder = this.isFolder() && this.wholePath() === app.replicator.config.get('deviceName');\n  };\n\n  File.prototype.isFolder = function() {\n    var _ref1;\n\n    return ((_ref1 = this.get('docType')) != null ? _ref1.toLowerCase() : void 0) === 'folder';\n  };\n\n  File.prototype.wholePath = function() {\n    var name, path;\n\n    name = this.get('name');\n    if (path = this.get('path')) {\n      return \"\" + (path.slice(1)) + \"/\" + name;\n    } else {\n      return name;\n    }\n  };\n\n  return File;\n\n})(Backbone.Model);\n","var DOWNLOADS_FOLDER, basic, fs, getFileSystem, readable, __chromeSafe;\n\nDOWNLOADS_FOLDER = 'cozy-downloads';\n\nbasic = require('../lib/basic');\n\nmodule.exports = fs = {};\n\ngetFileSystem = function(callback) {\n  var onError, onSuccess;\n\n  onSuccess = function(fs) {\n    return callback(null, fs);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  if (window.isBrowserDebugging) {\n    __chromeSafe();\n  }\n  return window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onSuccess, onError);\n};\n\nreadable = function(err) {\n  var code, name;\n\n  for (name in FileError) {\n    code = FileError[name];\n    if (code === err.code) {\n      return new Error(name.replace('_ERR', '').replace('_', ' '));\n    }\n  }\n  return new Error(JSON.stringify(err));\n};\n\nmodule.exports.initialize = function(callback) {\n  var _this = this;\n\n  return getFileSystem(function(err, filesystem) {\n    if (err) {\n      return callback(readable(err));\n    }\n    window.FileTransfer.fs = filesystem;\n    return fs.getOrCreateSubFolder(filesystem.root, DOWNLOADS_FOLDER, function(err, downloads) {\n      if (err) {\n        return callback(readable(err));\n      }\n      downloads.getFile('.nomedia', {\n        create: true,\n        exclusive: false\n      }, function() {\n        return console.log(\"NOMEDIA FILE CREATED\");\n      }, function() {\n        return console.log(\"NOMEDIA FILE NOT CREATED\");\n      });\n      return fs.getChildren(downloads, function(err, children) {\n        if (err) {\n          return callback(readable(err));\n        }\n        return callback(null, downloads, children);\n      });\n    });\n  });\n};\n\nmodule.exports[\"delete\"] = function(entry, callback) {\n  var onError, onSuccess;\n\n  onSuccess = function() {\n    return callback(null);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return entry.remove(onSuccess, onError);\n};\n\nmodule.exports.getFile = function(parent, name, callback) {\n  var onError, onSuccess;\n\n  onSuccess = function(entry) {\n    return callback(null, entry);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return parent.getFile(name, null, onSuccess, onError);\n};\n\nmodule.exports.getDirectory = function(parent, name, callback) {\n  var onError, onSuccess;\n\n  onSuccess = function(entry) {\n    return callback(null, entry);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return parent.getDirectory(name, {}, onSuccess, onError);\n};\n\nmodule.exports.getOrCreateSubFolder = function(parent, name, callback) {\n  var onError, onSuccess;\n\n  onSuccess = function(entry) {\n    return callback(null, entry);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return parent.getDirectory(name, {\n    create: true\n  }, onSuccess, function(err) {\n    if (err.code !== FileError.PATH_EXISTS_ERR) {\n      return callback(err);\n    }\n    return parent.getDirectory(name, {}, onSuccess, function(err) {\n      if (err.code !== FileError.NOT_FOUND_ERR) {\n        return callback(err);\n      }\n      return new Error(t('filesystem bug error'));\n    });\n  });\n};\n\nmodule.exports.getChildren = function(directory, callback) {\n  var onError, onSuccess, reader;\n\n  reader = directory.createReader();\n  onSuccess = function(entries) {\n    return callback(null, entries);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return reader.readEntries(onSuccess, onError);\n};\n\nmodule.exports.rmrf = function(directory, callback) {\n  var onError, onSuccess;\n\n  onError = function(err) {\n    return callback(err);\n  };\n  onSuccess = function() {\n    return callback(null);\n  };\n  return directory.removeRecursively(onSuccess, onError);\n};\n\nmodule.exports.freeSpace = function(callback) {\n  var onError, onSuccess;\n\n  onError = function(err) {\n    return callback(err);\n  };\n  onSuccess = function() {\n    return callback(null);\n  };\n  return cordova.exec(onSuccess, onError, 'File', 'getFreeDiskSpace', []);\n};\n\nmodule.exports.entryFromPath = function(path, callback) {\n  var onError, onSuccess;\n\n  onSuccess = function(entry) {\n    return callback(null, entry);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return resolveLocalFileSystemURL('file://' + path, onSuccess, onError);\n};\n\nmodule.exports.fileFromEntry = function(entry, callback) {\n  var onError, onSuccess;\n\n  onSuccess = function(file) {\n    return callback(null, file);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return entry.file(onSuccess, onError);\n};\n\nmodule.exports.contentFromFile = function(file, callback) {\n  var reader;\n\n  reader = new FileReader();\n  reader.onerror = callback;\n  reader.onload = function() {\n    return callback(null, reader.result);\n  };\n  return reader.readAsArrayBuffer(file);\n};\n\nmodule.exports.getFileFromPath = function(path, callback) {\n  return fs.entryFromPath(path, function(err, entry) {\n    if (err) {\n      return callback(err);\n    }\n    return fs.fileFromEntry(entry, callback);\n  });\n};\n\nmodule.exports.metadataFromEntry = function(entry, callback) {\n  var onError, onSuccess;\n\n  onSuccess = function(file) {\n    return callback(null, file);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return entry.getMetadata(onSuccess, onError);\n};\n\nmodule.exports.download = function(options, progressback, callback) {\n  var auth, errors, ft, headers, onError, onSuccess, path, url;\n\n  errors = ['An error happened (UNKNOWN)', 'An error happened (NOT FOUND)', 'An error happened (INVALID URL)', 'This file isnt available offline', 'ABORTED'];\n  options = (url = options.url, path = options.path, auth = options.auth, options);\n  url = encodeURI(url);\n  onSuccess = function(entry) {\n    return callback(null, entry);\n  };\n  onError = function(err) {\n    return callback(new Error(errors[err.code]));\n  };\n  ft = new FileTransfer();\n  ft.onprogress = function(e) {\n    if (e.lengthComputable) {\n      return progressback(e.loaded, e.total);\n    } else {\n      return progressback(3, 10);\n    }\n  };\n  headers = {\n    Authorization: basic(auth)\n  };\n  return ft.download(url, path, onSuccess, onError, true, {\n    headers: headers\n  });\n};\n\n__chromeSafe = function() {\n  var FileTransfer;\n\n  window.LocalFileSystem = {\n    PERSISTENT: window.PERSISTENT\n  };\n  window.requestFileSystem = function(type, size, onSuccess, onError) {\n    size = 5 * 1024 * 1024;\n    return navigator.webkitPersistentStorage.requestQuota(size, function(granted) {\n      return window.webkitRequestFileSystem(type, granted, onSuccess, onError);\n    }, onError);\n  };\n  return window.window.FileTransfer = FileTransfer = (function() {\n    function FileTransfer() {}\n\n    FileTransfer.prototype.download = function(url, local, onSuccess, onError, _, options) {\n      var key, value, xhr, _ref;\n\n      xhr = new XMLHttpRequest();\n      xhr.open('GET', url, true);\n      xhr.overrideMimeType('text/plain; charset=x-user-defined');\n      xhr.responseType = \"arraybuffer\";\n      _ref = options.headers;\n      for (key in _ref) {\n        value = _ref[key];\n        xhr.setRequestHeader(key, value);\n      }\n      xhr.onreadystatechange = function() {\n        if (xhr.readyState !== 4) {\n          return;\n        }\n        return FileTransfer.fs.root.getFile(local, {\n          create: true\n        }, function(entry) {\n          return entry.createWriter(function(writer) {\n            var bb;\n\n            writer.onwrite = function() {\n              return onSuccess(entry);\n            };\n            writer.onerror = function(err) {\n              return onError(err);\n            };\n            bb = new BlobBuilder();\n            bb.append(xhr.response);\n            return writer.write(bb.getBlob(mimetype));\n          }, function(err) {\n            return onError(err);\n          });\n        }, function(err) {\n          return onError(err);\n        });\n      };\n      return xhr.send(null);\n    };\n\n    return FileTransfer;\n\n  })();\n};\n","var DBCONTACTS, DBNAME, DBOPTIONS, Replicator, ReplicatorConfig, fs, makeDesignDocs, request, _ref,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\nrequest = require('../lib/request');\n\nfs = require('./filesystem');\n\nmakeDesignDocs = require('./replicator_mapreduce');\n\nReplicatorConfig = require('./replicator_config');\n\nDBNAME = \"cozy-files.db\";\n\nDBCONTACTS = \"cozy-contacts.db\";\n\nDBOPTIONS = window.isBrowserDebugging ? {} : {\n  adapter: 'websql'\n};\n\nmodule.exports = Replicator = (function(_super) {\n  var realtimeBackupCoef;\n\n  __extends(Replicator, _super);\n\n  function Replicator() {\n    this.startRealtime = __bind(this.startRealtime, this);\n    this.folderInFileSystem = __bind(this.folderInFileSystem, this);\n    this.fileInFileSystem = __bind(this.fileInFileSystem, this);    _ref = Replicator.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  Replicator.prototype.db = null;\n\n  Replicator.prototype.config = null;\n\n  _.extend(Replicator.prototype, require('./replicator_backups'));\n\n  Replicator.prototype.defaults = function() {\n    return {\n      inSync: false,\n      inBackup: false\n    };\n  };\n\n  Replicator.prototype.destroyDB = function(callback) {\n    var _this = this;\n\n    return this.db.destroy(function(err) {\n      if (err) {\n        return callback(err);\n      }\n      return _this.contactsDB.destroy(function(err) {\n        if (err) {\n          return callback(err);\n        }\n        return fs.rmrf(_this.downloads, callback);\n      });\n    });\n  };\n\n  Replicator.prototype.init = function(callback) {\n    var _this = this;\n\n    return fs.initialize(function(err, downloads, cache) {\n      if (err) {\n        return callback(err);\n      }\n      _this.downloads = downloads;\n      _this.cache = cache;\n      _this.db = new PouchDB(DBNAME, DBOPTIONS);\n      _this.contactsDB = new PouchDB(DBCONTACTS, DBOPTIONS);\n      return makeDesignDocs(_this.db, _this.contactsDB, function(err) {\n        if (err) {\n          return callback(err);\n        }\n        _this.config = new ReplicatorConfig(_this);\n        return _this.config.fetch(callback);\n      });\n    });\n  };\n\n  Replicator.prototype.getDbFilesOfFolder = function(folder, callback) {\n    var options, path;\n\n    path = folder.path + '/' + folder.name;\n    options = {\n      include_docs: true,\n      startkey: path,\n      endkey: path + '\\uffff'\n    };\n    return this.db.query('FilesAndFolder', options, function(err, results) {\n      var docs, files;\n\n      if (err) {\n        return callback(err);\n      }\n      docs = results.rows.map(function(row) {\n        return row.doc;\n      });\n      files = docs.filter(function(doc) {\n        var _ref1;\n\n        return ((_ref1 = doc.docType) != null ? _ref1.toLowerCase() : void 0) === 'file';\n      });\n      return callback(null, files);\n    });\n  };\n\n  Replicator.prototype.registerRemote = function(config, callback) {\n    var _this = this;\n\n    return request.post({\n      uri: \"https://\" + config.cozyURL + \"/device/\",\n      auth: {\n        username: 'owner',\n        password: config.password\n      },\n      json: {\n        login: config.deviceName,\n        type: 'mobile'\n      }\n    }, function(err, response, body) {\n      if (err) {\n        return callback(err);\n      } else if (response.statusCode === 401 && response.reason) {\n        return callback(new Error('cozy need patch'));\n      } else if (response.statusCode === 401) {\n        return callback(new Error('wrong password'));\n      } else if (response.statusCode === 400) {\n        return callback(new Error('device name already exist'));\n      } else {\n        _.extend(config, {\n          password: body.password,\n          deviceId: body.id,\n          auth: {\n            username: config.deviceName,\n            password: body.password\n          },\n          fullRemoteURL: (\"https://\" + config.deviceName + \":\" + body.password) + (\"@\" + config.cozyURL + \"/cozy\")\n        });\n        return _this.config.save(config, callback);\n      }\n    });\n  };\n\n  Replicator.prototype.updateIndex = function(callback) {\n    var _this = this;\n\n    return this.db.search({\n      build: true,\n      fields: ['name']\n    }, function(err) {\n      console.log(\"INDEX BUILT\");\n      if (err) {\n        console.log(err);\n      }\n      return _this.db.query('FilesAndFolder', {}, function() {\n        return _this.db.query('LocalPath', {}, function() {\n          return callback(null);\n        });\n      });\n    });\n  };\n\n  Replicator.prototype.initialReplication = function(progressback, callback) {\n    var options,\n      _this = this;\n\n    progressback(0);\n    options = this.config.makeUrl('/_changes?descending=true&limit=1');\n    return request.get(options, function(err, res, body) {\n      var last_seq;\n\n      if (err) {\n        return callback(err);\n      }\n      last_seq = body.last_seq;\n      progressback(1 / 5);\n      return async.series([\n        function(cb) {\n          return _this.copyView('file', cb);\n        }, function(cb) {\n          return progressback(2 / 5) && cb(null);\n        }, function(cb) {\n          return _this.copyView('folder', cb);\n        }, function(cb) {\n          return progressback(3 / 5) && cb(null);\n        }, function(cb) {\n          return _this.config.save({\n            checkpointed: last_seq\n          }, cb);\n        }, function(cb) {\n          return progressback(4 / 5) && cb(null);\n        }, function(cb) {\n          return _this.db.query('FilesAndFolder', {}, cb);\n        }\n      ], function(err) {\n        callback(err);\n        return _this.updateIndex(function() {\n          return console.log(\"Index built\");\n        });\n      });\n    });\n  };\n\n  Replicator.prototype.copyView = function(model, callback) {\n    var options,\n      _this = this;\n\n    options = this.config.makeUrl(\"/_design/\" + model + \"/_view/all/\");\n    return request.get(options, function(err, res, body) {\n      var docs, _ref1, _ref2;\n\n      if (err) {\n        return callback(err);\n      }\n      if (!((_ref1 = body.rows) != null ? _ref1.length : void 0)) {\n        return callback(null);\n      }\n      docs = (_ref2 = body.rows) != null ? _ref2.map(function(row) {\n        return row.value;\n      }) : void 0;\n      return _this.db.bulkDocs(docs, callback);\n    });\n  };\n\n  Replicator.prototype.fileInFileSystem = function(file) {\n    return this.cache.some(function(entry) {\n      return entry.name === file.binary.file.id;\n    });\n  };\n\n  Replicator.prototype.folderInFileSystem = function(path, callback) {\n    var fsCacheFolder, options;\n\n    options = {\n      startkey: path,\n      endkey: path + '\\uffff'\n    };\n    fsCacheFolder = this.cache.map(function(entry) {\n      return entry.name;\n    });\n    return this.db.query('PathToBinary', options, function(err, results) {\n      if (err) {\n        return callback(err);\n      }\n      if (results.rows.length === 0) {\n        return callback(null, null);\n      }\n      return callback(null, _.every(results.rows, function(row) {\n        var _ref1;\n\n        return _ref1 = row.value, __indexOf.call(fsCacheFolder, _ref1) >= 0;\n      }));\n    });\n  };\n\n  Replicator.prototype.getBinary = function(model, progressback, callback) {\n    var binary_id,\n      _this = this;\n\n    binary_id = model.binary.file.id;\n    return fs.getOrCreateSubFolder(this.downloads, binary_id, function(err, binfolder) {\n      if (err && err.code !== FileError.PATH_EXISTS_ERR) {\n        return callback(err);\n      }\n      if (!model.name) {\n        return callback(new Error('no model name :' + JSON.stringify(model)));\n      }\n      return fs.getFile(binfolder, model.name, function(err, entry) {\n        var options;\n\n        if (entry) {\n          return callback(null, entry.toURL());\n        }\n        options = _this.config.makeUrl(\"/\" + binary_id + \"/file\");\n        options.path = binfolder.toURL() + '/' + model.name;\n        return fs.download(options, progressback, function(err, entry) {\n          if (err) {\n            return fs[\"delete\"](binfolder, function(delerr) {\n              return callback(err);\n            });\n          } else {\n            _this.cache.push(binfolder);\n            return callback(null, entry.toURL());\n          }\n        });\n      });\n    });\n  };\n\n  Replicator.prototype.getBinaryFolder = function(folder, progressback, callback) {\n    var _this = this;\n\n    return this.getDbFilesOfFolder(folder, function(err, files) {\n      var totalSize;\n\n      if (err) {\n        return callback(err);\n      }\n      totalSize = files.reduce((function(sum, file) {\n        return sum + file.size;\n      }), 0);\n      return fs.freeSpace(function(err, available) {\n        var progressHandlers, reportProgress;\n\n        if (err) {\n          return callback(err);\n        }\n        if (totalSize > available * 1024) {\n          alert(t('not enough space'));\n          return callback(null);\n        } else {\n          progressHandlers = {};\n          reportProgress = function(id, done, total) {\n            var key, status;\n\n            progressHandlers[id] = [done, total];\n            total = done = 0;\n            for (key in progressHandlers) {\n              status = progressHandlers[key];\n              done += status[0];\n              total += status[1];\n            }\n            return progressback(done, total);\n          };\n          return async.eachLimit(files, 5, function(file, cb) {\n            var pb;\n\n            console.log(\"DOWNLOAD \" + file.name);\n            pb = reportProgress.bind(null, file._id);\n            return _this.getBinary(file, pb, cb);\n          }, callback);\n        }\n      });\n    });\n  };\n\n  Replicator.prototype.removeLocal = function(model, callback) {\n    var binary_id,\n      _this = this;\n\n    binary_id = model.binary.file.id;\n    console.log(\"REMOVE LOCAL\");\n    console.log(binary_id);\n    return fs.getDirectory(this.downloads, binary_id, function(err, binfolder) {\n      if (err) {\n        return callback(err);\n      }\n      return fs.rmrf(binfolder, function(err) {\n        var entry, index, _i, _len, _ref1;\n\n        _ref1 = _this.cache;\n        for (index = _i = 0, _len = _ref1.length; _i < _len; index = ++_i) {\n          entry = _ref1[index];\n          if (!(entry.name === binary_id)) {\n            continue;\n          }\n          _this.cache.splice(index, 1);\n          break;\n        }\n        return callback(null);\n      });\n    });\n  };\n\n  Replicator.prototype.removeLocalFolder = function(folder, callback) {\n    var _this = this;\n\n    return this.getDbFilesOfFolder(folder, function(err, files) {\n      if (err) {\n        return callback(err);\n      }\n      return async.eachSeries(files, function(file, cb) {\n        return _this.removeLocal(file, cb);\n      }, callback);\n    });\n  };\n\n  Replicator.prototype.sync = function(callback) {\n    var _this = this;\n\n    if (this.get('inSync')) {\n      return callback(null);\n    }\n    console.log(\"SYNC CALLED\");\n    this.set('inSync', true);\n    return this._sync(function(err) {\n      _this.set('inSync', false);\n      return callback(err);\n    });\n  };\n\n  Replicator.prototype._sync = function(callback) {\n    var replication, _ref1,\n      _this = this;\n\n    console.log(\"BEGIN SYNC\");\n    if ((_ref1 = this.liveReplication) != null) {\n      _ref1.cancel();\n    }\n    replication = this.db.replicate.from(this.config.remote, {\n      batch_size: 50,\n      batches_limit: 5,\n      filter: this.config.makeFilterName(),\n      since: this.config.get('checkpointed')\n    });\n    replication.once('error', function(err) {\n      console.log(\"REPLICATOR ERRROR \" + (JSON.stringify(err)) + \" \" + err.stack);\n      return callback(err);\n    });\n    return replication.once('complete', function(result) {\n      console.log(\"REPLICATION COMPLETED\");\n      return _this.config.save({\n        checkpointed: result.last_seq\n      }, function(err) {\n        callback(err);\n        app.router.forceRefresh();\n        return _this.updateIndex(function() {\n          return _this.startRealtime();\n        });\n      });\n    });\n  };\n\n  realtimeBackupCoef = 1;\n\n  Replicator.prototype.startRealtime = function() {\n    var _this = this;\n\n    if (this.liveReplication) {\n      return;\n    }\n    console.log('REALTIME START');\n    this.liveReplication = this.db.replicate.from(this.config.remote, {\n      batch_size: 50,\n      batches_limit: 5,\n      filter: this.config.makeFilterName(),\n      since: this.config.get('checkpointed'),\n      continuous: true\n    });\n    this.liveReplication.on('change', function(e) {\n      realtimeBackupCoef = 1;\n      return _this.set('inSync', true);\n    });\n    this.liveReplication.on('uptodate', function(e) {\n      realtimeBackupCoef = 1;\n      app.router.forceRefresh();\n      _this.set('inSync', false);\n      return console.log(\"UPTODATE\", e);\n    });\n    this.liveReplication.once('complete', function(e) {\n      console.log(\"LIVE REPLICATION CANCELLED\");\n      _this.set('inSync', false);\n      return _this.liveReplication = null;\n    });\n    return this.liveReplication.once('error', function(e) {\n      var timeout;\n\n      console.log(\"THIS HAPPENS\");\n      _this.liveReplication = null;\n      if (realtimeBackupCoef < 6) {\n        realtimeBackupCoef++;\n      }\n      timeout = 1000 * (1 << realtimeBackupCoef);\n      console.log(\"REALTIME BROKE, TRY AGAIN IN \" + timeout + \" \" + (e.toString()));\n      return setTimeout(_this.startRealtime, timeout);\n    });\n  };\n\n  return Replicator;\n\n})(Backbone.Model);\n","var DeviceStatus, fs,\n  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\nDeviceStatus = require('../lib/device_status');\n\nfs = require('./filesystem');\n\nmodule.exports = {\n  backup: function(callback) {\n    var _ref,\n      _this = this;\n\n    if (callback == null) {\n      callback = function() {};\n    }\n    if (this.get('inBackup')) {\n      return callback(null);\n    }\n    this.set('inBackup', true);\n    this.set('backup_step', null);\n    if ((_ref = this.liveReplication) != null) {\n      _ref.cancel();\n    }\n    return this._backup(function(err) {\n      _this.set('backup_step', null);\n      _this.set('inBackup', false);\n      _this.startRealtime();\n      if (err) {\n        return callback(err);\n      }\n      return _this.config.save({\n        lastBackup: new Date().toString()\n      }, function(err) {\n        return callback(null);\n      });\n    });\n  },\n  _backup: function(callback) {\n    var _this = this;\n\n    return DeviceStatus.checkReadyForSync(function(err, ready, msg) {\n      console.log(\"SYNC STATUS\", err, ready, msg);\n      if (err) {\n        return callback(err);\n      }\n      if (!ready) {\n        return callback(new Error(t(msg)));\n      }\n      console.log(\"WE ARE READY FOR SYNC\");\n      return _this.syncPictures(function(err) {\n        if (err) {\n          return callback(err);\n        }\n        return _this.syncContacts(function(err) {\n          return callback(err);\n        });\n      });\n    });\n  },\n  syncContacts: function(callback) {\n    var _this = this;\n\n    if (!this.config.get('syncContacts')) {\n      return callback(null);\n    }\n    console.log(\"SYNC CONTACTS\");\n    this.set('backup_step', 'contacts_scan');\n    this.set('backup_step_done', null);\n    return async.parallel([\n      ImagesBrowser.getContactsList, function(cb) {\n        return _this.contactsDB.query('ContactsByLocalId', {}, cb);\n      }\n    ], function(err, result) {\n      var dbCache, dbContacts, phoneContacts, processed, _ref;\n\n      if (err) {\n        return callback(err);\n      }\n      phoneContacts = result[0], (_ref = result[1], dbContacts = _ref.rows);\n      console.log(\"BEGIN SYNC \" + dbContacts.length + \" \" + phoneContacts.length);\n      dbCache = {};\n      dbContacts.forEach(function(row) {\n        return dbCache[row.key] = {\n          id: row.id,\n          rev: row.value[1],\n          version: row.value[0]\n        };\n      });\n      processed = 0;\n      _this.set('backup_step_total', phoneContacts.length);\n      return async.eachSeries(phoneContacts, function(contact, cb) {\n        var inDb, log;\n\n        _this.set('backup_step_done', processed++);\n        contact.localId = contact.localId.toString();\n        contact.docType = 'Contact';\n        inDb = dbCache[contact.localId];\n        log = \"CONTACT : \" + contact.localId + \" \" + contact.localVersion;\n        log += \"DB \" + (inDb != null ? inDb.version : void 0) + \" : \";\n        if (contact.localVersion === (inDb != null ? inDb.version : void 0)) {\n          console.log(log + \"NOTHING TO DO\");\n          return cb(null);\n        } else if (inDb != null) {\n          console.log(log + \"UPDATING\");\n          return _this.contactsDB.put(contact, inDb.id, inDb.rev, cb);\n        } else {\n          console.log(log + \"CREATING\");\n          return _this.contactsDB.post(contact, function(err, doc) {\n            if (err) {\n              return callback(err);\n            }\n            if (!doc.ok) {\n              return callback(new Error('cant create'));\n            }\n            dbCache[contact.localId] = {\n              id: doc.id,\n              rev: doc.rev,\n              version: contact.localVersion\n            };\n            return cb(null);\n          });\n        }\n      }, function(err) {\n        var ids, replication;\n\n        if (err) {\n          return callback(err);\n        }\n        console.log(\"SYNC CONTACTS phone -> pouch DONE\");\n        ids = _.map(dbCache, function(doc) {\n          return doc.id;\n        });\n        _this.set('backup_step', 'contacts_sync');\n        _this.set('backup_step_total', ids.length);\n        replication = _this.contactsDB.replicate.to(_this.config.remote, {\n          since: 0,\n          doc_ids: ids\n        });\n        replication.on('error', callback);\n        replication.on('change', function(e) {\n          return _this.set('backup_step_done', e.last_seq);\n        });\n        return replication.on('complete', function() {\n          callback(null);\n          return _this.contactsDB.query('ContactsByLocalId', {}, function() {});\n        });\n      });\n    });\n  },\n  syncPictures: function(callback) {\n    var _this = this;\n\n    if (!this.config.get('syncImages')) {\n      return callback(null);\n    }\n    console.log(\"SYNC PICTURES\");\n    this.set('backup_step', 'pictures_sync');\n    this.set('backup_step_done', null);\n    return async.series([\n      this.ensureDeviceFolder.bind(this), ImagesBrowser.getImagesList, function(cb) {\n        return _this.db.query('LocalPath', {}, cb);\n      }\n    ], function(err, results) {\n      var dbImages, images, myDownloadFolder, processed, _, _ref;\n\n      if (err) {\n        return callback(err);\n      }\n      _ = results[0], images = results[1], (_ref = results[2], dbImages = _ref.rows);\n      console.log(\"SYNC IMAGES : \" + images.length + \" \" + dbImages.length);\n      dbImages = dbImages.map(function(row) {\n        return row.key;\n      });\n      myDownloadFolder = _this.downloads.toURL().replace('file://', '');\n      processed = 0;\n      _this.set('backup_step_total', images.length);\n      return async.eachSeries(images, function(path, cb) {\n        _this.set('backup_step_done', processed++);\n        console.log(\"IMAGE : \" + path);\n        if (__indexOf.call(dbImages, path) >= 0) {\n          console.log(\"ALREADY IN DB \" + path);\n          return cb(null);\n        } else if (__indexOf.call(path, myDownloadFolder) >= 0) {\n          console.log(\"IS IN MY DOWNLOADS\");\n          return cb(null);\n        } else {\n          console.log(\"UPLOADING \" + path);\n          return _this.uploadPicture(path, function(err) {\n            if (err) {\n              console.log(\"ERROR \" + path + \" \" + err);\n            }\n            return setTimeout(cb, 1);\n          });\n        }\n      }, callback);\n    });\n  },\n  uploadPicture: function(path, callback) {\n    var _this = this;\n\n    return fs.getFileFromPath(path, function(err, file) {\n      if (err) {\n        return callback(err);\n      }\n      return fs.contentFromFile(file, function(err, content) {\n        if (err) {\n          return callback(err);\n        }\n        return _this.createBinary(content, file.type, function(err, bin) {\n          if (err) {\n            return callback(err);\n          }\n          return _this.createFile(file, path, bin, callback);\n        });\n      });\n    });\n  },\n  createBinary: function(blob, mime, callback) {\n    var _this = this;\n\n    return this.config.remote.post({\n      docType: 'Binary'\n    }, function(err, doc) {\n      if (err) {\n        return callback(err);\n      }\n      if (!doc.ok) {\n        return callback(new Error('cant create binary'));\n      }\n      return _this.config.remote.putAttachment(doc.id, 'file', doc.rev, blob, mime, function(err, doc) {\n        if (err) {\n          return callback(err);\n        }\n        if (!doc.ok) {\n          return callback(new Error('cant attach'));\n        }\n        delete _this.config.remoteHostObject.headers['Content-Type'];\n        return callback(null, doc);\n      });\n    });\n  },\n  createFile: function(cordovaFile, localPath, binaryDoc, callback) {\n    var dbFile,\n      _this = this;\n\n    dbFile = {\n      docType: 'File',\n      localPath: localPath,\n      name: cordovaFile.name,\n      path: '/' + this.config.get('deviceName'),\n      \"class\": this.fileClassFromMime(cordovaFile.type),\n      lastModification: new Date(cordovaFile.lastModified).toISOString(),\n      creationDate: new Date(cordovaFile.lastModified).toISOString(),\n      size: cordovaFile.size,\n      tags: ['uploaded-from-' + this.config.get('deviceName')],\n      binary: {\n        file: {\n          id: binaryDoc.id,\n          rev: binaryDoc.rev\n        }\n      }\n    };\n    return this.config.remote.post(dbFile, function(err, created) {\n      if (err) {\n        return callback(err);\n      }\n      if (!created.ok) {\n        return callback(new Error('cant create file'));\n      }\n      dbFile._id = created.id;\n      dbFile._rev = created.rev;\n      return _this.db.put(dbFile, callback);\n    });\n  },\n  fileClassFromMime: function(type) {\n    switch (type.split('/')[0]) {\n      case 'image':\n        return \"image\";\n      case 'audio':\n        return \"music\";\n      case 'video':\n        return \"video\";\n      case 'text':\n      case 'application':\n        return \"document\";\n      default:\n        return \"file\";\n    }\n  },\n  ensureDeviceFolder: function(callback) {\n    var options,\n      _this = this;\n\n    options = {\n      key: '',\n      include_docs: true\n    };\n    return this.db.query('FilesAndFolder', options, function(err, results) {\n      var deviceName, exists, folder;\n\n      if (err) {\n        return callback(err);\n      }\n      deviceName = _this.config.get('deviceName');\n      exists = results.rows.some(function(row) {\n        var _ref;\n\n        return row.doc.name === deviceName && ((_ref = row.doc.docType) != null ? _ref.toLowerCase() : void 0) === 'folder';\n      });\n      console.log(\"DEVICE FOLDER EXISTS \" + exists);\n      if (exists) {\n        return callback(null);\n      }\n      console.log(\"MAKING ONE\");\n      folder = {\n        docType: 'Folder',\n        name: deviceName,\n        path: '',\n        lastModification: new Date().toISOString(),\n        creationDate: new Date().toISOString(),\n        tags: []\n      };\n      return _this.config.remote.post(folder, function(err, res) {\n        if (err) {\n          return callback(err);\n        }\n        folder._id = res.id;\n        folder._rev = res.rev;\n        return this.db.put(folder, callback);\n      });\n    });\n  }\n};\n","var ReplicatorConfig, basic,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nbasic = require('../lib/basic');\n\nmodule.exports = ReplicatorConfig = (function(_super) {\n  __extends(ReplicatorConfig, _super);\n\n  function ReplicatorConfig(replicator) {\n    this.replicator = replicator;\n    ReplicatorConfig.__super__.constructor.call(this, null);\n    this.remote = null;\n  }\n\n  ReplicatorConfig.prototype.defaults = function() {\n    return {\n      _id: 'localconfig',\n      syncContacts: app.locale === 'digidisk',\n      syncImages: true,\n      syncOnWifi: true,\n      cozyURL: t('None'),\n      deviceName: t('None')\n    };\n  };\n\n  ReplicatorConfig.prototype.fetch = function(callback) {\n    var _this = this;\n\n    return this.replicator.db.get('localconfig', function(err, config) {\n      if (config) {\n        _this.set(config);\n        _this.remote = _this.createRemotePouchInstance();\n      }\n      return callback(null, _this);\n    });\n  };\n\n  ReplicatorConfig.prototype.save = function(changes, callback) {\n    var _this = this;\n\n    this.set(changes);\n    return this.replicator.db.put(this.toJSON(), function(err, res) {\n      if (err) {\n        return callback(err);\n      }\n      if (!res.ok) {\n        return callback(new Error('cant save config'));\n      }\n      _this.set({\n        _rev: res.rev\n      });\n      _this.remote = _this.createRemotePouchInstance();\n      return typeof callback === \"function\" ? callback(null, _this) : void 0;\n    });\n  };\n\n  ReplicatorConfig.prototype.makeUrl = function(path) {\n    return {\n      json: true,\n      auth: this.get('auth'),\n      url: 'https://' + this.get('cozyURL') + '/cozy' + path\n    };\n  };\n\n  ReplicatorConfig.prototype.makeFilterName = function() {\n    return this.get('deviceId') + '/filter';\n  };\n\n  ReplicatorConfig.prototype.createRemotePouchInstance = function() {\n    var _this = this;\n\n    return new PouchDB({\n      name: this.get('fullRemoteURL'),\n      getHost: function() {\n        return _this.remoteHostObject = {\n          remote: true,\n          protocol: 'https',\n          host: _this.get('cozyURL'),\n          port: 443,\n          path: '',\n          db: 'cozy',\n          headers: {\n            Authorization: basic(_this.get('auth'))\n          }\n        };\n      }\n    });\n  };\n\n  return ReplicatorConfig;\n\n})(Backbone.Model);\n","var ContactsByLocalIdDesignDoc, FilesAndFolderDesignDoc, LocalPathDesignDoc, PathToBinaryDesignDoc, createOrUpdateDesign;\n\ncreateOrUpdateDesign = function(db, design, callback) {\n  var _this = this;\n\n  return db.get(design._id, function(err, existing) {\n    if ((existing != null ? existing.version : void 0) === design.version) {\n      return callback(null);\n    } else {\n      console.log(\"REDEFINING DESIGN \" + design._id + \" FROM \" + existing);\n      if (existing) {\n        design._rev = existing._rev;\n      }\n      return db.put(design, callback);\n    }\n  });\n};\n\nPathToBinaryDesignDoc = {\n  _id: '_design/PathToBinary',\n  version: 1,\n  views: {\n    'PathToBinary': {\n      map: Object.toString.apply(function(doc) {\n        var _ref, _ref1, _ref2;\n\n        if (((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'file') {\n          return emit(doc.path + '/' + doc.name, (_ref1 = doc.binary) != null ? (_ref2 = _ref1.file) != null ? _ref2.id : void 0 : void 0);\n        }\n      })\n    }\n  }\n};\n\nFilesAndFolderDesignDoc = {\n  _id: '_design/FilesAndFolder',\n  version: 1,\n  views: {\n    'FilesAndFolder': {\n      map: Object.toString.apply(function(doc) {\n        var _ref, _ref1;\n\n        if ((_ref = (_ref1 = doc.docType) != null ? _ref1.toLowerCase() : void 0) === 'file' || _ref === 'folder') {\n          return emit(doc.path);\n        }\n      })\n    }\n  }\n};\n\nLocalPathDesignDoc = {\n  _id: '_design/LocalPath',\n  version: 1,\n  views: {\n    'LocalPath': {\n      map: Object.toString.apply(function(doc) {\n        if (doc.localPath) {\n          return emit(doc.localPath);\n        }\n      })\n    }\n  }\n};\n\nContactsByLocalIdDesignDoc = {\n  _id: '_design/ContactsByLocalId',\n  version: 1,\n  views: {\n    'ContactsByLocalId': {\n      map: Object.toString.apply(function(doc) {\n        var _ref;\n\n        if (((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'contact' && doc.localId) {\n          return emit(doc.localId, [doc.localVersion, doc._rev]);\n        }\n      })\n    }\n  }\n};\n\nmodule.exports = function(db, contactsDB, callback) {\n  return async.series([\n    function(cb) {\n      return createOrUpdateDesign(db, FilesAndFolderDesignDoc, cb);\n    }, function(cb) {\n      return createOrUpdateDesign(db, LocalPathDesignDoc, cb);\n    }, function(cb) {\n      return createOrUpdateDesign(db, PathToBinaryDesignDoc, cb);\n    }, function(cb) {\n      return createOrUpdateDesign(contactsDB, ContactsByLocalIdDesignDoc, cb);\n    }\n  ], callback);\n};\n","\n","var ConfigView, FolderCollection, FolderView, LoginView, Router, app, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\napp = require('application');\n\nFolderView = require('./views/folder');\n\nLoginView = require('./views/login');\n\nConfigView = require('./views/config');\n\nFolderCollection = require('./collections/files');\n\nmodule.exports = Router = (function(_super) {\n  __extends(Router, _super);\n\n  function Router() {\n    _ref = Router.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  Router.prototype.routes = {\n    'folder/*path': 'folder',\n    'search/*query': 'search',\n    'login': 'login',\n    'config': 'config'\n  };\n\n  Router.prototype.folder = function(path) {\n    var backpath, collection, parts,\n      _this = this;\n\n    $('#btn-menu, #btn-back').show();\n    if (path === null) {\n      app.layout.setBackButton('#folder/', 'home');\n      app.layout.setTitle(t('home'));\n    } else {\n      parts = path.split('/');\n      backpath = '#folder/' + parts.slice(0, -1).join('/');\n      app.layout.setBackButton(backpath, 'ios7-arrow-back');\n      app.layout.setTitle(parts[parts.length - 1]);\n    }\n    collection = new FolderCollection([], {\n      path: path\n    });\n    this.display(new FolderView({\n      collection: collection\n    }, collection.fetch()));\n    return collection.once('fullsync', function() {\n      return _this.trigger('collectionfetched');\n    });\n  };\n\n  Router.prototype.search = function(query) {\n    var collection,\n      _this = this;\n\n    $('#btn-menu, #btn-back').show();\n    app.layout.setBackButton('#folder/', 'home');\n    app.layout.setTitle(t('search') + ' \"' + query + '\"');\n    collection = new FolderCollection([], {\n      query: query\n    });\n    this.display(new FolderView({\n      collection: collection\n    }));\n    return collection.search(function(err) {\n      if (err) {\n        console.log(err.stack);\n        return alert(err);\n      }\n      return $('#search-input').blur();\n    });\n  };\n\n  Router.prototype.login = function() {\n    $('#btn-menu, #btn-back').hide();\n    return this.display(new LoginView());\n  };\n\n  Router.prototype.config = function() {\n    $('#btn-back').hide();\n    app.layout.setTitle(t('config'));\n    return this.display(new ConfigView());\n  };\n\n  Router.prototype.display = function(view) {\n    return app.layout.transitionTo(view);\n  };\n\n  Router.prototype.forceRefresh = function() {\n    var col, path, _ref1;\n\n    col = (_ref1 = app.layout.currentView) != null ? _ref1.collection : void 0;\n    if ((col != null ? col.path : void 0) === null) {\n      path = '';\n    } else if ((col != null ? col.path : void 0) !== void 0) {\n      path = col.path;\n    } else {\n      return;\n    }\n    delete FolderCollection.cache[path];\n    return col.fetch();\n  };\n\n  return Router;\n\n})(Backbone.Router);\n","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div class=\"list\"><div class=\"item item-divider\">');\nvar __val__ = t('phone2cozy title')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div>');\nif ( locale == 'digidisk')\n{\nbuf.push('<div class=\"item item-checkbox\">');\nvar __val__ = t('contacts sync label')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('<label class=\"checkbox\"><input');\nbuf.push(attrs({ 'id':('contactSyncCheck'), 'type':(\"checkbox\"), 'checked':(syncContacts) }, {\"type\":true,\"checked\":true}));\nbuf.push('/></label></div>');\n}\nbuf.push('<div class=\"item item-checkbox\">');\nvar __val__ = t('images sync label')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('<label class=\"checkbox\"><input');\nbuf.push(attrs({ 'id':('imageSyncCheck'), 'type':(\"checkbox\"), 'checked':(syncImages) }, {\"type\":true,\"checked\":true}));\nbuf.push('/></label></div><div class=\"item item-checkbox\">');\nvar __val__ = t('wifi sync label')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('<label class=\"checkbox\"><input');\nbuf.push(attrs({ 'id':('wifiSyncCheck'), 'type':(\"checkbox\"), 'checked':(syncOnWifi) }, {\"type\":true,\"checked\":true}));\nbuf.push('/></label></div>');\nif ( firstRun)\n{\nbuf.push('<div class=\"item\"><button id=\"configDone\" class=\"button button-block button-calm\">');\nvar __val__ = t('config done')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</button></div>');\n}\nelse\n{\nbuf.push('<div id=\"doBackup\" class=\"item item-icon-left\"><i class=\"icon ion-clock\"></i><span class=\"text\">');\nvar __val__ = t('last backup')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('&nbsp;' + escape((interp = lastBackup) == null ? '' : interp) + '.</span></div><div class=\"item item-divider\">');\nvar __val__ = t('about')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div class=\"item\">');\nvar __val__ = t('synchronized with') + cozyURL\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div class=\"item\">');\nvar __val__ = t('device name') + ' : ' + deviceName\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div class=\"item\">');\nvar __val__ = t('app name') + ' v0.0.5'\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div class=\"item item-divider\">');\nvar __val__ = t('reset')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div style=\"padding-left: 95px; white-space: normal;\" class=\"item item-button-left\"><button id=\"redbtn\" class=\"button button-assertive\">');\nvar __val__ = t('reset')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</button>');\nvar __val__ = t('reset warning')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div>');\n}\nbuf.push('</div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div class=\"item-content\">');\nif ( isFolder)\n{\nbuf.push('<i class=\"icon ion-folder\"></i>');\n}\nelse\n{\nbuf.push('<i class=\"icon ion-document\"></i>');\n}\nbuf.push('<span>');\nvar __val__ = model.name\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</span>');\nif ( isFolder)\n{\nbuf.push('<i class=\"icon ion-chevron-right\"></i>');\n}\nelse if ( model.incache)\n{\nbuf.push('<i class=\"cache-indicator icon ion-iphone\"></i>');\n}\nelse\n{\nbuf.push('<i class=\"cache-indicator icon ion-ios7-cloud-download-outline\"></i>');\n}\nbuf.push('</div><div class=\"item-options invisible\">');\nif ( model.incache == 'loading')\n{\nbuf.push('<div class=\"button\">');\nvar __val__ = t('loading')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div>');\n}\nelse if ( model.incache)\n{\nbuf.push('<div class=\"button uncache\">');\nvar __val__ = t('remove local')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div>');\n}\nelse\n{\nbuf.push('<div class=\"button download\">');\nvar __val__ = t('download')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div>');\n}\nbuf.push('</div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div id=\"container\" class=\"pane\"><div class=\"bar bar-header bar-calm\"><a id=\"btn-menu\" class=\"button button-icon icon ion-navicon-round\"></a><a id=\"headerSpinner\" class=\"button button-icon icon ion-looping\"></a><h1 id=\"title\" class=\"title\">Digidisk</h1></div><div class=\"bar bar-subheader bar-calm\"><h2 id=\"backupIndicator\" class=\"title\"></h2></div><div id=\"viewsPlaceholder\" class=\"scroll-content has-header has-footer\"><div class=\"scroll\"><div class=\"scroll-refresher\"><div class=\"ionic-refresher-content\"><div class=\"icon-pulling\"><i class=\"icon ion-arrow-down-c\"></i>');\nvar __val__ = t('pull to sync')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div class=\"icon-refreshing\"><i class=\"icon ion-loading-d\"></i>');\nvar __val__ = t('syncing')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div></div></div></div></div><div class=\"bar bar-footer\"><a id=\"btn-back\" class=\"button button-icon icon ion-ios7-arrow-back\"></a></div></div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<label class=\"item item-input\"><span class=\"input-label\">');\nvar __val__ = t('cozy url')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</span><input id=\"input-url\" type=\"text\" placeholder=\"john.cozycloud.cc\"/></label><label class=\"item item-input\"><span class=\"input-label\">');\nvar __val__ = t('cozy password')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</span><input id=\"input-pass\" type=\"password\" placeholder=\"cozy\\'s password\"/></label><label class=\"item item-input\"><span class=\"input-label\">');\nvar __val__ = t('device name')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</span><input id=\"input-device\" type=\"text\" placeholder=\"my-phone\"/></label><button id=\"btn-save\" class=\"button button-block button-balanced\">');\nvar __val__ = t('save')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</button>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div class=\"bar bar-header bar-dark\"><h1 class=\"title\">Menu</h1></div><div class=\"content has-header\"><div class=\"item item-input-inset\"><label class=\"item-input-wrapper\"><input');\nbuf.push(attrs({ 'id':('search-input'), 'type':(\"text\"), 'placeholder':(t(\"search\")) }, {\"type\":true,\"placeholder\":true}));\nbuf.push('/></label><a id=\"btn-search\" class=\"button button-icon icon ion-search\"></a></div><a href=\"#folder/\" class=\"item item-icon-left\"><i class=\"icon ion-home\"></i>');\nvar __val__ = t('home')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</a><a href=\"#config\" class=\"item item-icon-left\"><i class=\"icon ion-wrench\"></i>');\nvar __val__ = t('config')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</a><a id=\"backupButton\" class=\"item item-icon-left\"><i class=\"icon ion-ios7-cloud-upload-outline\"></i>');\nvar __val__ = t('backup')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</a></div>');\n}\nreturn buf.join(\"\");\n};","var BaseView, ConfigView, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nmodule.exports = ConfigView = (function(_super) {\n  __extends(ConfigView, _super);\n\n  function ConfigView() {\n    _ref = ConfigView.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  ConfigView.prototype.template = require('../templates/config');\n\n  ConfigView.prototype.events = function() {\n    return {\n      'tap #configDone': 'configDone',\n      'tap #redbtn': 'redBtn',\n      'change #contactSyncCheck': 'saveChanges',\n      'change #imageSyncCheck': 'saveChanges',\n      'change #wifiSyncCheck': 'saveChanges'\n    };\n  };\n\n  ConfigView.prototype.getRenderData = function() {\n    var config;\n\n    config = app.replicator.config.toJSON();\n    return _.extend({}, config, {\n      lastSync: this.formatDate(config != null ? config.lastSync : void 0),\n      lastBackup: this.formatDate(config != null ? config.lastBackup : void 0),\n      firstRun: app.isFirstRun,\n      locale: app.locale\n    });\n  };\n\n  ConfigView.prototype.formatDate = function(date) {\n    if (!date) {\n      return t('never');\n    } else {\n      if (!(date instanceof Date)) {\n        date = new Date(date);\n      }\n      return date.toDateString() + ' ' + date.toTimeString();\n    }\n  };\n\n  ConfigView.prototype.configDone = function() {\n    app.replicator.backup(function(err) {\n      if (err) {\n        alert(err);\n      }\n      return console.log(\"pics & contacts synced\");\n    });\n    app.isFirstRun = false;\n    return app.router.navigate('folder/', {\n      trigger: true\n    });\n  };\n\n  ConfigView.prototype.redBtn = function() {\n    var _this = this;\n\n    if (confirm(t(\"Are you sure ?\"))) {\n      return app.replicator.destroyDB(function(err) {\n        if (err) {\n          return alert(err.message);\n        }\n        $('#redbtn').text(t('done'));\n        return window.location.reload(true);\n      });\n    }\n  };\n\n  ConfigView.prototype.saveChanges = function(e) {\n    this.$('#contactSyncCheck, #imageSyncCheck, #wifiSyncCheck').prop('disabled', true);\n    return app.replicator.config.save({\n      syncContacts: this.$('#contactSyncCheck').is(':checked'),\n      syncImages: this.$('#imageSyncCheck').is(':checked'),\n      syncOnWifi: this.$('#wifiSyncCheck').is(':checked')\n    }, function() {\n      return this.$('#contactSyncCheck, #imageSyncCheck, #wifiSyncCheck').prop('disabled', false);\n    });\n  };\n\n  return ConfigView;\n\n})(BaseView);\n","var CollectionView, FolderView, _ref,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nCollectionView = require('../lib/view_collection');\n\nmodule.exports = FolderView = (function(_super) {\n  __extends(FolderView, _super);\n\n  function FolderView() {\n    this.displaySlider = __bind(this.displaySlider, this);\n    this.remove = __bind(this.remove, this);\n    this.appendView = __bind(this.appendView, this);\n    this.onChange = __bind(this.onChange, this);    _ref = FolderView.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  FolderView.prototype.className = 'list';\n\n  FolderView.prototype.itemview = require('./folder_line');\n\n  FolderView.prototype.events = function() {\n    return {\n      'tap .cache-indicator': 'displaySlider',\n      'hold .item': 'displaySlider'\n    };\n  };\n\n  FolderView.prototype.isParentOf = function(otherFolderView) {\n    if (this.collection.path === null) {\n      return true;\n    }\n    if (this.collection.isSearch()) {\n      return false;\n    }\n    if (!otherFolderView.collection.path) {\n      return false;\n    }\n    return -1 !== otherFolderView.collection.path.indexOf(this.collection.path);\n  };\n\n  FolderView.prototype.initialize = function() {\n    FolderView.__super__.initialize.apply(this, arguments);\n    return this.listenTo(this.collection, 'sync', this.onChange);\n  };\n\n  FolderView.prototype.afterRender = function() {\n    var _ref1;\n\n    if ((_ref1 = this.ionicView) != null) {\n      _ref1.destroy();\n    }\n    FolderView.__super__.afterRender.apply(this, arguments);\n    return this.ionicView = new ionic.views.ListView({\n      el: this.$el[0],\n      _handleDrag: function(e) {\n        ionic.views.ListView.prototype._handleDrag.apply(this, arguments);\n        return e.stopPropagation();\n      }\n    });\n  };\n\n  FolderView.prototype.onChange = function() {\n    var message;\n\n    this.$('#empty-message').remove();\n    if (_.size(this.views) === 0) {\n      message = this.collection.notloaded ? 'loading' : this.collection.isSearch() ? 'no results' : 'this folder is empty';\n      return $('<li class=\"item\" id=\"empty-message\">').text(t(message)).appendTo(this.$el);\n    }\n  };\n\n  FolderView.prototype.appendView = function(view) {\n    FolderView.__super__.appendView.apply(this, arguments);\n    return view.parent = this;\n  };\n\n  FolderView.prototype.remove = function() {\n    FolderView.__super__.remove.apply(this, arguments);\n    return this.collection.cancelFetchAdditional();\n  };\n\n  FolderView.prototype.displaySlider = function(event) {\n    var dX, op,\n      _this = this;\n\n    console.log(\"DISPLAY SLIDER\");\n    this.ionicView.clearDragEffects();\n    op = new ionic.SlideDrag({\n      el: this.ionicView.el,\n      canSwipe: function() {\n        return true;\n      }\n    });\n    op.start({\n      target: event.target\n    });\n    dX = op._currentDrag.startOffsetX === 0 ? 0 - op._currentDrag.buttonsWidth : op._currentDrag.buttonsWidth;\n    op.end({\n      gesture: {\n        deltaX: dX,\n        direction: 'right'\n      }\n    });\n    ionic.requestAnimationFrame(function() {\n      return _this.ionicView._lastDragOp = op;\n    });\n    event.preventDefault();\n    return event.stopPropagation();\n  };\n\n  return FolderView;\n\n})(CollectionView);\n","var BaseView, FolderLineView, _ref,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nmodule.exports = FolderLineView = (function(_super) {\n  __extends(FolderLineView, _super);\n\n  function FolderLineView() {\n    this.removeFromCache = __bind(this.removeFromCache, this);\n    this.addToCache = __bind(this.addToCache, this);\n    this.onClick = __bind(this.onClick, this);\n    this.updateProgress = __bind(this.updateProgress, this);\n    this.hideProgress = __bind(this.hideProgress, this);\n    this.displayProgress = __bind(this.displayProgress, this);\n    this.setCacheIcon = __bind(this.setCacheIcon, this);\n    this.afterRender = __bind(this.afterRender, this);\n    this.initialize = __bind(this.initialize, this);    _ref = FolderLineView.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  FolderLineView.prototype.tagName = 'a';\n\n  FolderLineView.prototype.template = require('../templates/folder_line');\n\n  FolderLineView.prototype.events = {\n    'tap .item-content': 'onClick',\n    'tap .item-options .download': 'addToCache',\n    'tap .item-options .uncache': 'removeFromCache'\n  };\n\n  FolderLineView.prototype.className = 'item item-icon-left item-icon-right item-complex';\n\n  FolderLineView.prototype.initialize = function() {\n    return this.listenTo(this.model, 'change', this.render);\n  };\n\n  FolderLineView.prototype.getRenderData = function() {\n    return _.extend(FolderLineView.__super__.getRenderData.apply(this, arguments), {\n      isFolder: this.model.isFolder()\n    });\n  };\n\n  FolderLineView.prototype.afterRender = function() {\n    this.$el[0].dataset.folderid = this.model.get('_id');\n    if (this.model.isDeviceFolder) {\n      return this.$('.ion-folder').css({\n        color: '#34a6ff'\n      });\n    }\n  };\n\n  FolderLineView.prototype.setCacheIcon = function(klass) {\n    var icon, _ref1, _ref2;\n\n    icon = this.$('.cache-indicator');\n    icon.removeClass('ion-warning ion-looping ion-ios7-cloud-download-outline');\n    icon.removeClass('ion-ios7-download-outline').addClass(klass);\n    return (_ref1 = this.parent) != null ? (_ref2 = _ref1.ionicView) != null ? _ref2.clearDragEffects() : void 0 : void 0;\n  };\n\n  FolderLineView.prototype.displayProgress = function() {\n    this.downloading = true;\n    this.hideProgress();\n    this.setCacheIcon('ion-looping');\n    this.progresscontainer = $('<div class=\"item-progress\"></div>').append(this.progressbar = $('<div class=\"item-progress-bar\"></div>'));\n    return this.progresscontainer.appendTo(this.$el);\n  };\n\n  FolderLineView.prototype.hideProgress = function(err, incache) {\n    var _ref1;\n\n    this.downloading = false;\n    if (err) {\n      alert(err);\n    }\n    incache = app.replicator.fileInFileSystem;\n    if ((incache != null) && incache !== this.model.get('incache')) {\n      this.model.set({\n        incache: incache\n      });\n    }\n    return (_ref1 = this.progresscontainer) != null ? _ref1.remove() : void 0;\n  };\n\n  FolderLineView.prototype.updateProgress = function(done, total) {\n    var _ref1;\n\n    return (_ref1 = this.progressbar) != null ? _ref1.css('width', (100 * done / total) + '%') : void 0;\n  };\n\n  FolderLineView.prototype.onClick = function(event) {\n    var path,\n      _this = this;\n\n    if ($(event.target).closest('.cache-indicator').length) {\n      return true;\n    }\n    if (this.downloading) {\n      return true;\n    }\n    if (this.model.isFolder()) {\n      path = this.model.get('path') + '/' + this.model.get('name');\n      app.router.navigate(\"#folder\" + path, {\n        trigger: true\n      });\n      return true;\n    }\n    this.displayProgress();\n    return app.replicator.getBinary(this.model.attributes, this.updateProgress, function(err, url) {\n      _this.hideProgress();\n      if (err) {\n        return alert(err);\n      }\n      _this.model.set({\n        incache: true\n      });\n      app.backFromOpen = true;\n      return ExternalFileUtil.openWith(url, '', void 0, function(success) {}, function(err) {\n        if (0 === (err != null ? err.indexOf('No Activity found') : void 0)) {\n          err = t('no activity found');\n        }\n        alert(err);\n        return console.log(err);\n      });\n    });\n  };\n\n  FolderLineView.prototype.addToCache = function() {\n    var onadded,\n      _this = this;\n\n    if (this.downloading) {\n      return true;\n    }\n    this.displayProgress();\n    onadded = function(err) {\n      _this.hideProgress();\n      if (err) {\n        return alert(err);\n      }\n      return _this.model.set({\n        incache: true\n      });\n    };\n    if (this.model.isFolder()) {\n      return app.replicator.getBinaryFolder(this.model.attributes, this.updateProgress, onadded);\n    } else {\n      return app.replicator.getBinary(this.model.attributes, this.updateProgress, onadded);\n    }\n  };\n\n  FolderLineView.prototype.removeFromCache = function() {\n    var onremoved,\n      _this = this;\n\n    if (this.downloading) {\n      return true;\n    }\n    this.displayProgress();\n    onremoved = function(err) {\n      _this.hideProgress();\n      if (err) {\n        return alert(err);\n      }\n      return _this.model.set({\n        incache: false\n      });\n    };\n    if (this.model.isFolder()) {\n      return app.replicator.removeLocalFolder(this.model.attributes, onremoved);\n    } else {\n      return app.replicator.removeLocal(this.model.attributes, onremoved);\n    }\n  };\n\n  return FolderLineView;\n\n})(BaseView);\n","var BaseView, FolderView, Layout, Menu, _ref,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nFolderView = require('./folder');\n\nMenu = require('./menu');\n\nmodule.exports = Layout = (function(_super) {\n  __extends(Layout, _super);\n\n  function Layout() {\n    this.onBackButtonClicked = __bind(this.onBackButtonClicked, this);\n    this.onSearchButtonClicked = __bind(this.onSearchButtonClicked, this);\n    this.onMenuButtonClicked = __bind(this.onMenuButtonClicked, this);\n    this.setTitle = __bind(this.setTitle, this);\n    this.setBackButton = __bind(this.setBackButton, this);\n    this.closeMenu = __bind(this.closeMenu, this);\n    this.togglePullToRefresh = __bind(this.togglePullToRefresh, this);    _ref = Layout.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  Layout.prototype.template = require('../templates/layout');\n\n  Layout.prototype.events = function() {\n    return {\n      'tap #btn-back': 'onBackButtonClicked',\n      'tap #btn-menu': 'onMenuButtonClicked'\n    };\n  };\n\n  Layout.prototype.initialize = function() {\n    var OpEvents,\n      _this = this;\n\n    document.addEventListener(\"menubutton\", this.onMenuButtonClicked, false);\n    document.addEventListener(\"searchbutton\", this.onSearchButtonClicked, false);\n    document.addEventListener(\"backbutton\", this.onBackButtonClicked, false);\n    this.listenTo(app.replicator, 'change:inSync change:inBackup', function() {\n      var inBackup, inSync;\n\n      inSync = app.replicator.get('inSync');\n      inBackup = app.replicator.get('inBackup');\n      _this.spinner.toggle(inSync || inBackup);\n      return _this.refresher.toggleClass('refreshing', inSync);\n    });\n    OpEvents = 'change:inBackup change:backup_step change:backup_step_done';\n    return this.listenTo(app.replicator, OpEvents, _.debounce(function() {\n      var step, text;\n\n      step = app.replicator.get('backup_step');\n      if (step) {\n        text = t(step);\n        if (app.replicator.get('backup_step_done')) {\n          text += \": \" + (app.replicator.get('backup_step_done'));\n          text += \"/\" + (app.replicator.get('backup_step_total'));\n        }\n        _this.backupIndicator.text(text).parent().show();\n        return _this.viewsPlaceholder.addClass('has-subheader');\n      } else {\n        _this.backupIndicator.parent().hide();\n        return _this.viewsPlaceholder.removeClass('has-subheader');\n      }\n    }, 100));\n  };\n\n  Layout.prototype.afterRender = function() {\n    var onActive, onClose, onStart,\n      _this = this;\n\n    this.menu = new Menu();\n    this.menu.render();\n    this.$el.append(this.menu.$el);\n    this.container = this.$('#container');\n    this.viewsPlaceholder = this.$('#viewsPlaceholder');\n    this.viewsBlock = this.viewsPlaceholder.find('.scroll');\n    this.refresher = this.viewsBlock.find('.scroll-refresher');\n    this.backButton = this.container.find('#btn-back');\n    this.menuButton = this.container.find('#btn-menu');\n    this.spinner = this.container.find('#headerSpinner');\n    this.spinner.hide();\n    this.title = this.container.find('#title');\n    this.backupIndicator = this.container.find('#backupIndicator');\n    this.backupIndicator.parent().hide();\n    this.ionicContainer = new ionic.views.SideMenuContent({\n      el: this.container[0]\n    });\n    this.ionicMenu = new ionic.views.SideMenu({\n      el: this.menu.$el[0],\n      width: 270\n    });\n    this.controller = new ionic.controllers.SideMenuController({\n      content: this.ionicContainer,\n      left: this.ionicMenu\n    });\n    this.ionicScroll = new ionic.views.Scroll({\n      el: this.viewsPlaceholder[0]\n    });\n    return this.ionicScroll.activatePullToRefresh(50, onActive = function() {\n      _this.refresher.addClass('active');\n      return console.log(\"ON ACTIVE\");\n    }, onClose = function() {\n      console.log(\"ON CLOSE\");\n      return _this.refresher.removeClass('active');\n    }, onStart = function() {\n      _this.ionicScroll.finishPullToRefresh();\n      return app.replicator.sync(function(err) {\n        if (err) {\n          return alert(err);\n        }\n      });\n    });\n  };\n\n  Layout.prototype.togglePullToRefresh = function(activated) {\n    this.refresher.toggle(activated);\n    return this.ionicScroll.__refreshHeight = activated ? 50 : null;\n  };\n\n  Layout.prototype.closeMenu = function() {\n    return this.controller.toggleLeft(false);\n  };\n\n  Layout.prototype.setBackButton = function(href, icon) {\n    this.backButton.attr('href', href);\n    this.backButton.removeClass('ion-home ion-ios7-arrow-back');\n    return this.backButton.addClass('ion-' + icon);\n  };\n\n  Layout.prototype.setTitle = function(text) {\n    return this.title.text(text);\n  };\n\n  Layout.prototype.transitionTo = function(view) {\n    var $next, currClass, nextClass, ptrEnabled, transitionend, type, _ref1,\n      _this = this;\n\n    this.closeMenu();\n    $next = view.render().$el;\n    ptrEnabled = view instanceof FolderView;\n    this.togglePullToRefresh(ptrEnabled);\n    if (this.currentView instanceof FolderView && view instanceof FolderView) {\n      type = this.currentView.isParentOf(view) ? 'left' : 'right';\n    } else {\n      type = 'none';\n    }\n    if (type === 'none') {\n      if ((_ref1 = this.currentView) != null) {\n        _ref1.remove();\n      }\n      this.viewsBlock.append($next);\n      this.ionicScroll.hintResize();\n      return this.currentView = view;\n    } else {\n      nextClass = type === 'left' ? 'sliding-next' : 'sliding-prev';\n      currClass = type === 'left' ? 'sliding-prev' : 'sliding-next';\n      $next.addClass(nextClass);\n      this.viewsBlock.append($next);\n      $next.width();\n      this.currentView.$el.addClass(currClass);\n      $next.removeClass(nextClass);\n      transitionend = 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend';\n      return $next.one(transitionend, _.once(function() {\n        _this.currentView.remove();\n        _this.currentView = view;\n        return _this.ionicScroll.scrollTo(0, 0, true, null);\n      }));\n    }\n  };\n\n  Layout.prototype.onMenuButtonClicked = function() {\n    this.menu.reset();\n    return this.controller.toggleLeft();\n  };\n\n  Layout.prototype.onSearchButtonClicked = function() {\n    this.onMenuButtonClicked();\n    return this.$('#search-input').focus();\n  };\n\n  Layout.prototype.onBackButtonClicked = function(event) {\n    app.router.navigate(this.backButton.attr('href'), {\n      trigger: true\n    });\n    event.preventDefault();\n    return event.stopPropagation();\n  };\n\n  return Layout;\n\n})(BaseView);\n","var BaseView, LoginView, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nmodule.exports = LoginView = (function(_super) {\n  __extends(LoginView, _super);\n\n  function LoginView() {\n    _ref = LoginView.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  LoginView.prototype.className = 'list';\n\n  LoginView.prototype.template = require('../templates/login');\n\n  LoginView.prototype.events = function() {\n    return {\n      'click #btn-save': 'doSave'\n    };\n  };\n\n  LoginView.prototype.doSave = function() {\n    var config, device, pass, url,\n      _this = this;\n\n    if (this.saving) {\n      return null;\n    }\n    this.saving = $('#btn-save').text();\n    if (this.error) {\n      this.error.remove();\n    }\n    url = this.$('#input-url').val();\n    pass = this.$('#input-pass').val();\n    device = this.$('#input-device').val();\n    if (!(url && pass && device)) {\n      return this.displayError('all fields are required');\n    }\n    if (url.slice(0, 4) === 'http') {\n      url = url.replace('https://', '').replace('http://', '');\n      this.$('#input-url').val(url);\n    }\n    if (url[url.length - 1] === '/') {\n      this.$('#input-url').val(url = url.slice(0, -1));\n    }\n    config = {\n      cozyURL: url,\n      password: pass,\n      deviceName: device\n    };\n    $('#btn-save').text(t('registering'));\n    return app.replicator.registerRemote(config, function(err) {\n      var onProgress;\n\n      if (err) {\n        return _this.displayError(t(err.message));\n      }\n      onProgress = function(percent) {\n        return $('#btn-save').text(t('downloading hierarchy') + parseInt(percent * 100) + '%');\n      };\n      return app.replicator.initialReplication(onProgress, function(err) {\n        if (err) {\n          console.log(err.stack);\n        }\n        if (err) {\n          return _this.displayError(t(err.message));\n        }\n        $('#footer').text(t('replication complete'));\n        app.isFirstRun = true;\n        return app.router.navigate('config', {\n          trigger: true\n        });\n      });\n    });\n  };\n\n  LoginView.prototype.displayError = function(text, field) {\n    $('#btn-save').text(this.saving);\n    this.saving = false;\n    if (this.error) {\n      this.error.remove();\n    }\n    if (~text.indexOf('CORS request rejected')) {\n      text = 'Connection faillure';\n    }\n    this.error = $('<div>').addClass('button button-full button-energized');\n    this.error.text(text);\n    return this.$(field || '#btn-save').before(this.error);\n  };\n\n  return LoginView;\n\n})(BaseView);\n","var BaseView, Menu, _ref,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nmodule.exports = Menu = (function(_super) {\n  var setLooping;\n\n  __extends(Menu, _super);\n\n  function Menu() {\n    this.doSearchIfEnter = __bind(this.doSearchIfEnter, this);    _ref = Menu.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  Menu.prototype.id = 'menu';\n\n  Menu.prototype.className = 'menu menu-left';\n\n  Menu.prototype.template = require('../templates/menu');\n\n  Menu.prototype.events = {\n    'click #syncButton': 'sync',\n    'click #backupButton': 'backup',\n    'click #btn-search': 'doSearch',\n    'click a.item': 'closeMenu',\n    'keydown #search-input': 'doSearchIfEnter'\n  };\n\n  setLooping = function(btn, looping) {\n    var newIcon, oldIcon;\n\n    oldIcon = looping ? 'ion-ios7-cloud-upload-outline' : 'ion-looping';\n    newIcon = looping ? 'ion-looping' : 'ion-ios7-cloud-upload-outline';\n    return btn.find('i').removeClass(oldIcon).addClass(newIcon);\n  };\n\n  Menu.prototype.afterRender = function() {\n    var _this = this;\n\n    this.syncButton = this.$('#syncButton');\n    this.backupButton = this.$('#backupButton');\n    this.listenTo(app.replicator, 'change:inSync', function() {\n      return setLooping(_this.syncButton, app.replicator.get('inSync'));\n    });\n    this.listenTo(app.replicator, 'change:inBackup', function() {\n      return setLooping(_this.backupButton, app.replicator.get('inBackup'));\n    });\n    setLooping(this.syncButton, app.replicator.get('inSync'));\n    return setLooping(this.backupButton, app.replicator.get('inBackup'));\n  };\n\n  Menu.prototype.closeMenu = function() {\n    return app.layout.closeMenu();\n  };\n\n  Menu.prototype.sync = function() {\n    if (app.replicator.get('inSync')) {\n      return;\n    }\n    app.layout.closeMenu();\n    return app.replicator.sync(function(err) {\n      var _ref1, _ref2;\n\n      if (err) {\n        console.log(err, err.stack);\n      }\n      if (err) {\n        alert(err);\n      }\n      return (_ref1 = app.layout.currentView) != null ? (_ref2 = _ref1.collection) != null ? _ref2.fetch() : void 0 : void 0;\n    });\n  };\n\n  Menu.prototype.backup = function() {\n    if (app.replicator.get('inBackup')) {\n      return;\n    }\n    app.layout.closeMenu();\n    return app.replicator.backup(function(err) {\n      var _ref1, _ref2;\n\n      if (err) {\n        console.log(err, err.stack);\n      }\n      if (err) {\n        alert(err);\n      }\n      return (_ref1 = app.layout.currentView) != null ? (_ref2 = _ref1.collection) != null ? _ref2.fetch() : void 0 : void 0;\n    });\n  };\n\n  Menu.prototype.doSearchIfEnter = function(event) {\n    if (event.which === 13) {\n      return this.doSearch();\n    }\n  };\n\n  Menu.prototype.doSearch = function() {\n    var val;\n\n    val = $('#search-input').val();\n    if (val.length === 0) {\n      return true;\n    }\n    app.layout.closeMenu();\n    return app.router.navigate('#search/' + val, {\n      trigger: true\n    });\n  };\n\n  Menu.prototype.reset = function() {\n    return this.$('#search-input').blur().val('');\n  };\n\n  return Menu;\n\n})(BaseView);\n"]}