{"version":3,"file":"..\\www\\javascripts\\app.js","sources":["app/application.coffee","app/collections/files.coffee","app/initialize.coffee","app/lib/base_view.coffee","app/lib/couchbase.coffee","app/lib/request.js","app/lib/url.coffee","app/lib/view_collection.coffee","app/locales/en.coffee","app/locales/fr.coffee","app/models/file.coffee","app/router.coffee","app/templates/config.jade","app/templates/folder.jade","app/templates/folder_line.jade","app/views/config.coffee","app/views/config_run.coffee","app/views/folder.coffee","app/views/folder_line.coffee","app/views/loader.coffee"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/CA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9CA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7CA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzaA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzdA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlBA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/GA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArHA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApHA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtCA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1DA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjBA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnBA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlFA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3DA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArBA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtDA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAdA;;A","sourcesContent":["var Replicator;\n\nReplicator = require('./lib/couchbase');\n\nmodule.exports = {\n  initialize: function() {\n    var Router, e, locales, _ref,\n      _this = this;\n\n    window.app = this;\n    this.polyglot = new Polyglot();\n    try {\n      locales = require('locales/' + this.locale);\n    } catch (_error) {\n      e = _error;\n      locales = require('locales/en');\n    }\n    this.polyglot.extend(locales);\n    window.t = this.polyglot.t.bind(this.polyglot);\n    Router = require('router');\n    this.router = new Router();\n    this.backButton = $('#btn-back');\n    if ((_ref = window.cblite) == null) {\n      window.cblite = {\n        getURL: function(cb) {\n          return cb(null, 'http://localhost:5984/');\n        }\n      };\n    }\n    this.replicator = new Replicator();\n    return this.replicator.init(function(err, config) {\n      if (err) {\n        return alert(err.message);\n      }\n      Backbone.history.start();\n      if (config) {\n        return _this.router.navigate('folder/', {\n          trigger: true\n        });\n      } else {\n        return _this.router.navigate('config', {\n          trigger: true\n        });\n      }\n    });\n  }\n};\n","var File, FileAndFolderCollection, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nFile = require('../models/file');\n\nmodule.exports = FileAndFolderCollection = (function(_super) {\n  __extends(FileAndFolderCollection, _super);\n\n  function FileAndFolderCollection() {\n    _ref = FileAndFolderCollection.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  FileAndFolderCollection.prototype.model = File;\n\n  FileAndFolderCollection.prototype.parse = function(couchdb_result) {\n    return couchdb_result.rows.map(function(row) {\n      return row.value;\n    });\n  };\n\n  return FileAndFolderCollection;\n\n})(Backbone.Collection);\n\nFileAndFolderCollection.getAtPath = function(path) {\n  var col;\n\n  if (!path) {\n    path = '';\n  } else {\n    path = '/' + path;\n  }\n  col = new FileAndFolderCollection();\n  col.url = app.replicator.db + '/_design/folder/_view/byFolder?key=%22' + path + '%22';\n  col.fetch({\n    remove: false\n  });\n  col.url = app.replicator.db + '/_design/file/_view/byFolder?key=%22' + path + '%22';\n  col.fetch({\n    remove: false\n  });\n  console.log(\"col was fetched\", col.url);\n  return col;\n};\n","var app;\n\napp = require('application');\n\ndocument.addEventListener('deviceready', function() {\n  return app.initialize();\n});\n","var BaseView, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nmodule.exports = BaseView = (function(_super) {\n  __extends(BaseView, _super);\n\n  function BaseView() {\n    _ref = BaseView.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  BaseView.prototype.template = function() {};\n\n  BaseView.prototype.initialize = function() {};\n\n  BaseView.prototype.getRenderData = function() {\n    var _ref1;\n\n    return {\n      model: (_ref1 = this.model) != null ? _ref1.toJSON() : void 0\n    };\n  };\n\n  BaseView.prototype.render = function() {\n    this.beforeRender();\n    this.$el.html(this.template(this.getRenderData()));\n    this.afterRender();\n    return this;\n  };\n\n  BaseView.prototype.beforeRender = function() {};\n\n  BaseView.prototype.afterRender = function() {};\n\n  BaseView.prototype.destroy = function() {\n    this.undelegateEvents();\n    this.$el.removeData().unbind();\n    this.remove();\n    return Backbone.View.prototype.remove.call(this);\n  };\n\n  return BaseView;\n\n})(Backbone.View);\n","var DBNAME, REGEXP_PROCESS_STATUS, Replicator, createView, makeFilter, makeView, request, urlparse;\n\nrequest = require('./request');\n\nurlparse = require('./url');\n\nDBNAME = \"cozy-files\";\n\nREGEXP_PROCESS_STATUS = /Processed (\\d+) \\/ (\\d+) changes/;\n\nmodule.exports = Replicator = (function() {\n  function Replicator() {}\n\n  Replicator.prototype.server = null;\n\n  Replicator.prototype.db = null;\n\n  Replicator.prototype.config = null;\n\n  Replicator.prototype.destroyDB = function(callback) {\n    return request.couch({\n      url: this.db,\n      method: 'DELETE'\n    }, callback);\n  };\n\n  Replicator.prototype.init = function(callback) {\n    var _this = this;\n\n    return window.cblite.getURL(function(err, server) {\n      if (err) {\n        return callback(err);\n      }\n      _this.server = server;\n      _this.db = server + DBNAME;\n      return request.get(_this.db, function(err, response, body) {\n        if (response.statusCode === 404) {\n          return _this.prepareDatabase(callback);\n        } else if (response.statusCode === 200) {\n          return _this.loadConfig(callback);\n        } else {\n          if (err == null) {\n            err = new Error('unexpected db state');\n          }\n          return callback(err);\n        }\n      });\n    });\n  };\n\n  Replicator.prototype.loadConfig = function(callback) {\n    var _this = this;\n\n    return request.couch(\"\" + this.db + \"/config\", function(err, res, config) {\n      if (res.statusCode === 404) {\n        return callback(null, null);\n      } else if (res.statusCode === 200) {\n        return callback(null, _this.config = config);\n      } else {\n        if (err == null) {\n          err = new Error('unexpected config state');\n        }\n        return callback(err);\n      }\n    });\n  };\n\n  Replicator.prototype.prepareDatabase = function(callback) {\n    var _this = this;\n\n    return request.put(this.db, function(err) {\n      var fullPath, ops;\n\n      if (err) {\n        return cb(err);\n      }\n      fullPath = \"path.toLowerCase() + '/' + doc.name.toLowerCase()\";\n      ops = [];\n      ops.push(createView(_this.db, 'Device', {\n        all: makeView('Device', '_id'),\n        byUrl: makeView('Device', 'url')\n      }));\n      ops.push(createView(_this.db, 'File', {\n        all: makeView('File', '_id'),\n        byFolder: makeView('File', 'path.toLowerCase()'),\n        byFullPath: makeView('File', fullPath)\n      }));\n      ops.push(createView(_this.db, 'Folder', {\n        all: makeView('Folder', '_id'),\n        byFolder: makeView('Folder', 'path.toLowerCase()'),\n        byFullPath: makeView('Folder', fullPath)\n      }));\n      ops.push(createView(_this.db, 'Binary', {\n        all: makeView('Binary', '_id')\n      }));\n      return async.series(ops, function(err) {\n        return callback(err);\n      });\n    });\n  };\n\n  Replicator.prototype.prepareDevice = function(callback) {\n    var config, ops,\n      _this = this;\n\n    config = this.config;\n    ops = [];\n    ops.push(function(cb) {\n      return request.couch({\n        url: \"\" + _this.db + \"/config\",\n        method: 'PUT',\n        body: config\n      }, cb);\n    });\n    ops.push(function(cb) {\n      return request.couch({\n        uri: \"\" + _this.db + \"/_design/\" + config.deviceId,\n        method: 'PUT',\n        body: {\n          views: {},\n          filters: {\n            filter: makeFilter(['Folder', 'File'], true),\n            filterDocType: makeFilter(['Folder', 'File'])\n          }\n        }\n      }, cb);\n    });\n    return async.series(ops, callback);\n  };\n\n  Replicator.prototype.registerRemote = function(config, callback) {\n    var _this = this;\n\n    return request.post({\n      uri: \"https://\" + config.cozyURL + \"/device/\",\n      auth: {\n        username: 'owner',\n        password: config.password\n      },\n      json: {\n        login: config.deviceName,\n        type: 'mobile'\n      }\n    }, function(err, response, body) {\n      if (err) {\n        return callback(err);\n      } else if (response.statusCode === 401 && response.reason) {\n        return callback(new Error('ds need patch'));\n      } else if (response.statusCode === 401) {\n        return callback(new Error('wrong password'));\n      } else if (response.statusCode === 400) {\n        return callback(new Error('device name already exist'));\n      } else {\n        config.password = body.password;\n        config.deviceId = body.id;\n        config.fullRemoteURL = (\"https://\" + config.deviceName + \":\" + config.password) + (\"@\" + config.cozyURL + \"/cozy\");\n        _this.config = config;\n        return _this.prepareDevice(callback);\n      }\n    });\n  };\n\n  Replicator.prototype.initialReplication = function(progressback, callback) {\n    var done, expectedtotal, xhr,\n      _this = this;\n\n    expectedtotal = 3000;\n    done = 0;\n    xhr = this.start_replication({\n      source: this.config.fullRemoteURL,\n      target: DBNAME,\n      filter: \"\" + this.config.deviceId + \"/filterDocType\"\n    }, function(err, replication) {\n      var waiting;\n\n      return waiting = _this.waitReplication(replication, {}, function(err) {\n        return callback(err);\n      });\n    });\n    return {\n      abort: function() {\n        if (waiting) {\n          waiting.abort();\n        }\n        return xhr != null ? xhr.abort() : void 0;\n      }\n    };\n  };\n\n  Replicator.prototype.getBinary = function(binary, callback) {\n    var binary_id, binary_rev, url, waiting, xhr,\n      _this = this;\n\n    binary_id = binary.file.id;\n    binary_rev = binary.file.rev;\n    url = \"\" + this.db + \"/\" + binary_id + \"/file\";\n    waiting = null;\n    xhr = request.couch({\n      url: url,\n      method: 'HEAD'\n    }, function(err, response) {\n      if (response.statusCode !== 404) {\n        return callback(null, url);\n      }\n      return xhr = _this.start_replication({\n        source: _this.config.fullRemoteURL,\n        target: DBNAME,\n        since: 0,\n        filter: '_doc_ids',\n        doc_ids: \"%5B%22\" + binary_id + \"%22%5D\"\n      }, function(err, replication) {\n        xhr = null;\n        if (err) {\n          return callback(err);\n        }\n        return waiting = _this.waitReplication(replication, function(err) {\n          return callback(err, url);\n        });\n      });\n    });\n    return {\n      abort: function() {\n        if (waiting) {\n          waiting.abort();\n        }\n        return xhr != null ? xhr.abort() : void 0;\n      }\n    };\n  };\n\n  Replicator.prototype.startSync = function(callback) {\n    var _this = this;\n\n    return this.start_replication({\n      source: this.config.fullRemoteURL,\n      target: DBNAME,\n      continuous: true,\n      filter: \"\" + this.config.deviceId + \"/filter\"\n    }, function(err) {\n      if (err) {\n        return callback(err);\n      }\n      return _this.start_replication({\n        source: DBNAME,\n        target: _this.config.fullRemoteURL,\n        continuous: true,\n        filter: \"\" + _this.config.deviceId + \"/filter\"\n      }, callback);\n    });\n  };\n\n  Replicator.prototype.stopSync = function(callback) {\n    var _this = this;\n\n    return this.cancel_replication({\n      source: DBNAME,\n      target: this.config.fullRemoteURL\n    }, function(err) {\n      return _this.cancel_replication({\n        source: _this.config.fullRemoteURL,\n        target: DBNAME\n      }, callback);\n    });\n  };\n\n  Replicator.prototype.start_replication = function(options, callback) {\n    var _this = this;\n\n    return request.couch({\n      url: \"\" + this.server + \"_replicate\",\n      method: \"POST\",\n      body: options\n    }, function(err, response, replication) {\n      return callback(err, replication);\n    });\n  };\n\n  Replicator.prototype.cancel_replication = function(options, callback) {\n    var source, target;\n\n    source = options.source, target = options.target;\n    return request.couch({\n      url: \"\" + this.server + \"_replicate\",\n      method: \"POST\",\n      body: {\n        source: source,\n        target: target,\n        cancel: true\n      }\n    }, function(err, response, body) {\n      if (err.message.indexOf('unable to lookup') === -1) {\n        err = null;\n      }\n      return callback(err);\n    });\n  };\n\n  Replicator.prototype.replication_status = function(replication, callback) {\n    var _this = this;\n\n    return request.couch(\"\" + this.server + \"_active_tasks\", function(err, response, tasks) {\n      var all, done, id, task, total, _ref, _ref1;\n\n      if (err) {\n        return callback(err);\n      }\n      id = replication._local_id || replication.session_id;\n      task = _.findWhere(tasks, {\n        replication_id: id\n      }) || _.findWhere(tasks, {\n        task: id\n      });\n      console.log(JSON.stringify(task));\n      if (!task) {\n        return callback(null, null);\n      }\n      if (task.error) {\n        return callback(task.error[1] || task.error[0]);\n      }\n      if ((_ref = task.status) === 'Idle' || _ref === 'Stopped') {\n        task.complete = true;\n      } else if (REGEXP_PROCESS_STATUS.test(task.status)) {\n        _ref1 = REGEXP_PROCESS_STATUS.exec(task.status), all = _ref1[0], done = _ref1[1], total = _ref1[2];\n        task.done = parseInt(done);\n        task.total = parseInt(total);\n      }\n      return callback(null, task);\n    });\n  };\n\n  Replicator.prototype.waitReplication = function(replication, waiting, callback) {\n    var _this = this;\n\n    waiting.xhr = this.replication_status(replication, function(err, task) {\n      var next;\n\n      waiting.xhr = null;\n      if (err) {\n        return callback(err);\n      }\n      if (!task || task.complete) {\n        return callback(null);\n      }\n      if (replication.continuous) {\n        return callback(null);\n      }\n      if (waiting.lastDone !== task.done) {\n        waiting.lastDone = task.done;\n        waiting.bugCount = task.done > 0 ? 10 : 0;\n      } else if (++waiting.bugCount > 12) {\n        return _this.cancel_replication(task, function(err) {\n          if (err) {\n            console.log(err);\n          }\n          return callback(null);\n        });\n      }\n      next = _this.waitReplication.bind(_this, replication, waiting, callback);\n      return waiting.timer = setTimeout(next, 10000);\n    });\n    return {\n      abort: function() {\n        var _ref;\n\n        if ((_ref = waiting.xhr) != null) {\n          _ref.abort();\n        }\n        if (waiting.timer) {\n          return clearTimeout(waiting.timer);\n        }\n      }\n    };\n  };\n\n  return Replicator;\n\n})();\n\ncreateView = function(db, docType, views) {\n  return function(callback) {\n    return request.couch({\n      uri: \"\" + db + \"/_design/\" + (docType.toLowerCase()),\n      method: 'PUT',\n      body: {\n        views: views\n      }\n    }, callback);\n  };\n};\n\nmakeView = function(docType, field) {\n  var fn;\n\n  fn = function(doc) {\n    if (doc.docType === '[DOCTYPE]') {\n      return emit(doc.__field__, doc);\n    }\n  };\n  fn = fn.toString().replace('[DOCTYPE]', docType);\n  fn = fn.replace('__field__', field);\n  return {\n    map: fn\n  };\n};\n\nmakeFilter = function(docTypes, allowDeleted) {\n  var docType, fn, test;\n\n  test = ((function() {\n    var _i, _len, _results;\n\n    _results = [];\n    for (_i = 0, _len = docTypes.length; _i < _len; _i++) {\n      docType = docTypes[_i];\n      _results.push(\"doc.docType == '\" + docType + \"'\");\n    }\n    return _results;\n  })()).join(' || ');\n  fn = allowDeleted ? function(doc) {\n    return doc._deleted || test;\n  } : function(doc) {\n    return test;\n  };\n  return fn = fn.toString().replace('test', test);\n};\n","// Browser Request\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nvar XHR = XMLHttpRequest\r\nif (!XHR) throw new Error('missing XMLHttpRequest')\r\nrequest.log = {\r\n  'trace': noop, 'debug': noop, 'info': noop, 'warn': noop, 'error': noop\r\n}\r\n\r\nvar DEFAULT_TIMEOUT = 3 * 60 * 1000 // 3 minutes\r\n\r\n//\r\n// request\r\n//\r\n\r\nfunction request(options, callback) {\r\n  // The entry-point to the API: prep the options object and pass the real work to run_xhr.\r\n  if(typeof callback !== 'function')\r\n    throw new Error('Bad callback given: ' + callback)\r\n\r\n  if(!options)\r\n    throw new Error('No options given')\r\n\r\n  var options_onResponse = options.onResponse; // Save this for later.\r\n\r\n  if(typeof options === 'string')\r\n    options = {'uri':options};\r\n  else\r\n    options = JSON.parse(JSON.stringify(options)); // Use a duplicate for mutating.\r\n\r\n  options.onResponse = options_onResponse // And put it back.\r\n\r\n  if (options.verbose) request.log = getLogger();\r\n\r\n  if(options.url) {\r\n    options.uri = options.url;\r\n    delete options.url;\r\n  }\r\n\r\n  if(!options.uri && options.uri !== \"\")\r\n    throw new Error(\"options.uri is a required argument\");\r\n\r\n  if(typeof options.uri != \"string\")\r\n    throw new Error(\"options.uri must be a string\");\r\n\r\n  var unsupported_options = ['proxy', '_redirectsFollowed', 'maxRedirects', 'followRedirect']\r\n  for (var i = 0; i < unsupported_options.length; i++)\r\n    if(options[ unsupported_options[i] ])\r\n      throw new Error(\"options.\" + unsupported_options[i] + \" is not supported\")\r\n\r\n  options.callback = callback\r\n  options.method = options.method || 'GET';\r\n  options.headers = options.headers || {};\r\n  options.body    = options.body || null\r\n  options.timeout = options.timeout || request.DEFAULT_TIMEOUT\r\n\r\n  if(options.headers.host)\r\n    throw new Error(\"Options.headers.host is not supported\");\r\n\r\n  if(options.json) {\r\n    options.headers.accept = options.headers.accept || 'application/json'\r\n    if(options.method !== 'GET')\r\n      options.headers['content-type'] = 'application/json'\r\n\r\n    if(typeof options.json !== 'boolean')\r\n      options.body = JSON.stringify(options.json)\r\n    else if(typeof options.body !== 'string')\r\n      options.body = JSON.stringify(options.body)\r\n  }\r\n\r\n  //BEGIN QS Hack\r\n  var serialize = function(obj) {\r\n    var str = [];\r\n    for(var p in obj)\r\n      if (obj.hasOwnProperty(p)) {\r\n        str.push(encodeURIComponent(p) + \"=\" + encodeURIComponent(obj[p]));\r\n      }\r\n    return str.join(\"&\");\r\n  }\r\n\r\n  if(options.qs){\r\n    var qs = (typeof options.qs == 'string')? options.qs : serialize(options.qs);\r\n    if(options.uri.indexOf('?') !== -1){ //no get params\r\n        options.uri = options.uri+'&'+qs;\r\n    }else{ //existing get params\r\n        options.uri = options.uri+'?'+qs;\r\n    }\r\n  }\r\n  //END QS Hack\r\n\r\n  //BEGIN FORM Hack\r\n  var multipart = function(obj) {\r\n    //todo: support file type (useful?)\r\n    var result = {};\r\n    result.boundry = '-------------------------------'+Math.floor(Math.random()*1000000000);\r\n    var lines = [];\r\n    for(var p in obj){\r\n        if (obj.hasOwnProperty(p)) {\r\n            lines.push(\r\n                '--'+result.boundry+\"\\n\"+\r\n                'Content-Disposition: form-data; name=\"'+p+'\"'+\"\\n\"+\r\n                \"\\n\"+\r\n                obj[p]+\"\\n\"\r\n            );\r\n        }\r\n    }\r\n    lines.push( '--'+result.boundry+'--' );\r\n    result.body = lines.join('');\r\n    result.length = result.body.length;\r\n    result.type = 'multipart/form-data; boundary='+result.boundry;\r\n    return result;\r\n  }\r\n\r\n  if(options.form){\r\n    if(typeof options.form == 'string') throw('form name unsupported');\r\n    if(options.method === 'POST'){\r\n        var encoding = (options.encoding || 'application/x-www-form-urlencoded').toLowerCase();\r\n        options.headers['content-type'] = encoding;\r\n        switch(encoding){\r\n            case 'application/x-www-form-urlencoded':\r\n                options.body = serialize(options.form).replace(/%20/g, \"+\");\r\n                break;\r\n            case 'multipart/form-data':\r\n                var multi = multipart(options.form);\r\n                //options.headers['content-length'] = multi.length;\r\n                options.body = multi.body;\r\n                options.headers['content-type'] = multi.type;\r\n                break;\r\n            default : throw new Error('unsupported encoding:'+encoding);\r\n        }\r\n    }\r\n  }\r\n  //END FORM Hack\r\n\r\n  // If onResponse is boolean true, call back immediately when the response is known,\r\n  // not when the full request is complete.\r\n  options.onResponse = options.onResponse || noop\r\n  if(options.onResponse === true) {\r\n    options.onResponse = callback\r\n    options.callback = noop\r\n  }\r\n\r\n  // XXX Browsers do not like this.\r\n  //if(options.body)\r\n  //  options.headers['content-length'] = options.body.length;\r\n\r\n  // HTTP basic authentication\r\n  if(!options.headers.authorization && options.auth)\r\n    options.headers.authorization = 'Basic ' + b64_enc(options.auth.username + ':' + options.auth.password);\r\n\r\n  return run_xhr(options)\r\n}\r\n\r\nvar req_seq = 0\r\nfunction run_xhr(options) {\r\n  var xhr = new XHR\r\n    , timed_out = false\r\n    , is_cors = is_crossDomain(options.uri)\r\n    , supports_cors = ('withCredentials' in xhr)\r\n\r\n  req_seq += 1\r\n  xhr.seq_id = req_seq\r\n  xhr.id = req_seq + ': ' + options.method + ' ' + options.uri\r\n  xhr._id = xhr.id // I know I will type \"_id\" from habit all the time.\r\n\r\n  if(is_cors && !supports_cors) {\r\n    var cors_err = new Error('Browser does not support cross-origin request: ' + options.uri)\r\n    cors_err.cors = 'unsupported'\r\n    return options.callback(cors_err, xhr)\r\n  }\r\n\r\n  xhr.timeoutTimer = setTimeout(too_late, options.timeout)\r\n  function too_late() {\r\n    timed_out = true\r\n    var er = new Error('ETIMEDOUT')\r\n    er.code = 'ETIMEDOUT'\r\n    er.duration = options.timeout\r\n\r\n    request.log.error('Timeout', { 'id':xhr._id, 'milliseconds':options.timeout })\r\n    return options.callback(er, xhr)\r\n  }\r\n\r\n  // Some states can be skipped over, so remember what is still incomplete.\r\n  var did = {'response':false, 'loading':false, 'end':false}\r\n\r\n  xhr.onreadystatechange = on_state_change\r\n  xhr.open(options.method, options.uri, true) // asynchronous\r\n  if(is_cors)\r\n    xhr.withCredentials = !! options.withCredentials\r\n  xhr.send(options.body)\r\n  return xhr\r\n\r\n  function on_state_change(event) {\r\n    if(timed_out)\r\n      return request.log.debug('Ignoring timed out state change', {'state':xhr.readyState, 'id':xhr.id})\r\n\r\n    request.log.debug('State change', {'state':xhr.readyState, 'id':xhr.id, 'timed_out':timed_out})\r\n\r\n    if(xhr.readyState === XHR.OPENED) {\r\n      request.log.debug('Request started', {'id':xhr.id})\r\n      for (var key in options.headers)\r\n        xhr.setRequestHeader(key, options.headers[key])\r\n    }\r\n\r\n    else if(xhr.readyState === XHR.HEADERS_RECEIVED)\r\n      on_response()\r\n\r\n    else if(xhr.readyState === XHR.LOADING) {\r\n      on_response()\r\n      on_loading()\r\n    }\r\n\r\n    else if(xhr.readyState === XHR.DONE) {\r\n      on_response()\r\n      on_loading()\r\n      on_end()\r\n    }\r\n  }\r\n\r\n  function on_response() {\r\n    if(did.response)\r\n      return\r\n\r\n    did.response = true\r\n    request.log.debug('Got response', {'id':xhr.id, 'status':xhr.status})\r\n    clearTimeout(xhr.timeoutTimer)\r\n    xhr.statusCode = xhr.status // Node request compatibility\r\n\r\n    // Detect failed CORS requests.\r\n    if(is_cors && xhr.statusCode == 0) {\r\n      var cors_err = new Error('CORS request rejected: ' + options.uri)\r\n      cors_err.cors = 'rejected'\r\n\r\n      // Do not process this request further.\r\n      did.loading = true\r\n      did.end = true\r\n\r\n      return options.callback(cors_err, xhr)\r\n    }\r\n\r\n    options.onResponse(null, xhr)\r\n  }\r\n\r\n  function on_loading() {\r\n    if(did.loading)\r\n      return\r\n\r\n    did.loading = true\r\n    request.log.debug('Response body loading', {'id':xhr.id})\r\n    // TODO: Maybe simulate \"data\" events by watching xhr.responseText\r\n  }\r\n\r\n  function on_end() {\r\n    if(did.end)\r\n      return\r\n\r\n    did.end = true\r\n    request.log.debug('Request done', {'id':xhr.id})\r\n\r\n    xhr.body = xhr.responseText\r\n    if(options.json) {\r\n      try        { xhr.body = JSON.parse(xhr.responseText) }\r\n      catch (er) { return options.callback(er, xhr)        }\r\n    }\r\n\r\n    options.callback(null, xhr, xhr.body)\r\n  }\r\n\r\n} // request\r\n\r\nrequest.withCredentials = false;\r\nrequest.DEFAULT_TIMEOUT = DEFAULT_TIMEOUT;\r\n\r\n//\r\n// defaults\r\n//\r\n\r\nrequest.defaults = function(options, requester) {\r\n  var def = function (method) {\r\n    var d = function (params, callback) {\r\n      if(typeof params === 'string')\r\n        params = {'uri': params};\r\n      else {\r\n        params = JSON.parse(JSON.stringify(params));\r\n      }\r\n      for (var i in options) {\r\n        if (params[i] === undefined) params[i] = options[i]\r\n      }\r\n      return method(params, callback)\r\n    }\r\n    return d\r\n  }\r\n  var de = def(request)\r\n  de.get = def(request.get)\r\n  de.post = def(request.post)\r\n  de.put = def(request.put)\r\n  de.head = def(request.head)\r\n  return de\r\n}\r\n\r\n//\r\n// HTTP method shortcuts\r\n//\r\n\r\nvar shortcuts = [ 'get', 'put', 'post', 'head' ];\r\nshortcuts.forEach(function(shortcut) {\r\n  var method = shortcut.toUpperCase();\r\n  var func   = shortcut.toLowerCase();\r\n\r\n  request[func] = function(opts) {\r\n    if(typeof opts === 'string')\r\n      opts = {'method':method, 'uri':opts};\r\n    else {\r\n      opts = JSON.parse(JSON.stringify(opts));\r\n      opts.method = method;\r\n    }\r\n\r\n    var args = [opts].concat(Array.prototype.slice.apply(arguments, [1]));\r\n    return request.apply(this, args);\r\n  }\r\n})\r\n\r\n//\r\n// CouchDB shortcut\r\n//\r\n\r\nrequest.couch = function(options, callback) {\r\n  if(typeof options === 'string')\r\n    options = {'uri':options}\r\n\r\n  // Just use the request API to do JSON.\r\n  options.json = true\r\n  if(options.body)\r\n    options.json = options.body\r\n  delete options.body\r\n\r\n  callback = callback || noop\r\n\r\n  var xhr = request(options, couch_handler)\r\n  return xhr\r\n\r\n  function couch_handler(er, resp, body) {\r\n    if(er)\r\n      return callback(er, resp, body)\r\n\r\n    if((resp.statusCode < 200 || resp.statusCode > 299) && body.error) {\r\n      // The body is a Couch JSON object indicating the error.\r\n      er = new Error('CouchDB error: ' + (body.error.reason || body.error.error || body.error))\r\n      for (var key in body)\r\n        er[key] = body[key]\r\n      return callback(er, resp, body);\r\n    }\r\n\r\n    return callback(er, resp, body);\r\n  }\r\n}\r\n\r\n//\r\n// Utility\r\n//\r\n\r\nfunction noop() {}\r\n\r\nfunction getLogger() {\r\n  var logger = {}\r\n    , levels = ['trace', 'debug', 'info', 'warn', 'error']\r\n    , level, i\r\n\r\n  for(i = 0; i < levels.length; i++) {\r\n    level = levels[i]\r\n\r\n    logger[level] = noop\r\n    if(typeof console !== 'undefined' && console && console[level])\r\n      logger[level] = formatted(console, level)\r\n  }\r\n\r\n  return logger\r\n}\r\n\r\nfunction formatted(obj, method) {\r\n  return formatted_logger\r\n\r\n  function formatted_logger(str, context) {\r\n    if(typeof context === 'object')\r\n      str += ' ' + JSON.stringify(context)\r\n\r\n    return obj[method].call(obj, str)\r\n  }\r\n}\r\n\r\n// Return whether a URL is a cross-domain request.\r\nfunction is_crossDomain(url) {\r\n  var rurl = /^([\\w\\+\\.\\-]+:)(?:\\/\\/([^\\/?#:]*)(?::(\\d+))?)?/\r\n\r\n  // jQuery #8138, IE may throw an exception when accessing\r\n  // a field from window.location if document.domain has been set\r\n  var ajaxLocation\r\n  try { ajaxLocation = location.href }\r\n  catch (e) {\r\n    // Use the href attribute of an A element since IE will modify it given document.location\r\n    ajaxLocation = document.createElement( \"a\" );\r\n    ajaxLocation.href = \"\";\r\n    ajaxLocation = ajaxLocation.href;\r\n  }\r\n\r\n  var ajaxLocParts = rurl.exec(ajaxLocation.toLowerCase()) || []\r\n    , parts = rurl.exec(url.toLowerCase() )\r\n\r\n  var result = !!(\r\n    parts &&\r\n    (  parts[1] != ajaxLocParts[1]\r\n    || parts[2] != ajaxLocParts[2]\r\n    || (parts[3] || (parts[1] === \"http:\" ? 80 : 443)) != (ajaxLocParts[3] || (ajaxLocParts[1] === \"http:\" ? 80 : 443))\r\n    )\r\n  )\r\n\r\n  //console.debug('is_crossDomain('+url+') -> ' + result)\r\n  return result\r\n}\r\n\r\n// MIT License from http://phpjs.org/functions/base64_encode:358\r\nfunction b64_enc (data) {\r\n    // Encodes string using MIME base64 algorithm\r\n    var b64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\r\n    var o1, o2, o3, h1, h2, h3, h4, bits, i = 0, ac = 0, enc=\"\", tmp_arr = [];\r\n\r\n    if (!data) {\r\n        return data;\r\n    }\r\n\r\n    // assume utf8 data\r\n    // data = this.utf8_encode(data+'');\r\n\r\n    do { // pack three octets into four hexets\r\n        o1 = data.charCodeAt(i++);\r\n        o2 = data.charCodeAt(i++);\r\n        o3 = data.charCodeAt(i++);\r\n\r\n        bits = o1<<16 | o2<<8 | o3;\r\n\r\n        h1 = bits>>18 & 0x3f;\r\n        h2 = bits>>12 & 0x3f;\r\n        h3 = bits>>6 & 0x3f;\r\n        h4 = bits & 0x3f;\r\n\r\n        // use hexets to index into b64, and append result to encoded string\r\n        tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\r\n    } while (i < data.length);\r\n\r\n    enc = tmp_arr.join('');\r\n\r\n    switch (data.length % 3) {\r\n        case 1:\r\n            enc = enc.slice(0, -2) + '==';\r\n        break;\r\n        case 2:\r\n            enc = enc.slice(0, -1) + '=';\r\n        break;\r\n    }\r\n\r\n    return enc;\r\n}\r\nmodule.exports = request;","var a;\n\na = document.createElement('a');\n\nmodule.exports = function(url) {\n  var result;\n\n  a.href = url;\n  return result = {\n    host: a.host,\n    hostname: a.hostname,\n    pathname: a.pathname,\n    port: a.port,\n    protocol: a.protocol,\n    search: a.search,\n    hash: a.hash\n  };\n};\n","var BaseView, ViewCollection, _ref,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('lib/base_view');\n\nmodule.exports = ViewCollection = (function(_super) {\n  __extends(ViewCollection, _super);\n\n  function ViewCollection() {\n    this.removeItem = __bind(this.removeItem, this);\n    this.addItem = __bind(this.addItem, this);    _ref = ViewCollection.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  ViewCollection.prototype.itemview = null;\n\n  ViewCollection.prototype.views = {};\n\n  ViewCollection.prototype.template = function() {\n    return '';\n  };\n\n  ViewCollection.prototype.itemViewOptions = function() {};\n\n  ViewCollection.prototype.collectionEl = null;\n\n  ViewCollection.prototype.onChange = function() {\n    return this.$el.toggleClass('empty', _.size(this.views) === 0);\n  };\n\n  ViewCollection.prototype.appendView = function(view) {\n    return this.$collectionEl.append(view.el);\n  };\n\n  ViewCollection.prototype.initialize = function() {\n    ViewCollection.__super__.initialize.apply(this, arguments);\n    this.views = {};\n    this.listenTo(this.collection, \"reset\", this.onReset);\n    this.listenTo(this.collection, \"add\", this.addItem);\n    this.listenTo(this.collection, \"remove\", this.removeItem);\n    if (this.collectionEl == null) {\n      this.collectionEl = this.el;\n      return this.$collectionEl = this.$el;\n    }\n  };\n\n  ViewCollection.prototype.render = function() {\n    var id, view, _ref1;\n\n    _ref1 = this.views;\n    for (id in _ref1) {\n      view = _ref1[id];\n      view.$el.detach();\n    }\n    return ViewCollection.__super__.render.apply(this, arguments);\n  };\n\n  ViewCollection.prototype.afterRender = function() {\n    var id, view, _ref1;\n\n    if (!this.$collectionEl) {\n      this.$collectionEl = this.$(this.collectionEl);\n    }\n    _ref1 = this.views;\n    for (id in _ref1) {\n      view = _ref1[id];\n      this.appendView(view);\n    }\n    this.onReset(this.collection);\n    return this.onChange(this.views);\n  };\n\n  ViewCollection.prototype.remove = function() {\n    this.onReset([]);\n    return ViewCollection.__super__.remove.apply(this, arguments);\n  };\n\n  ViewCollection.prototype.onReset = function(newcollection) {\n    var id, view, _ref1;\n\n    _ref1 = this.views;\n    for (id in _ref1) {\n      view = _ref1[id];\n      view.remove();\n    }\n    return newcollection.forEach(this.addItem);\n  };\n\n  ViewCollection.prototype.addItem = function(model) {\n    var options, view;\n\n    options = _.extend({}, {\n      model: model\n    }, this.itemViewOptions(model));\n    view = new this.itemview(options);\n    this.views[model.cid] = view.render();\n    this.appendView(view);\n    return this.onChange(this.views);\n  };\n\n  ViewCollection.prototype.removeItem = function(model) {\n    this.views[model.cid].remove();\n    delete this.views[model.cid];\n    return this.onChange(this.views);\n  };\n\n  return ViewCollection;\n\n})(BaseView);\n","module.exports = {\n  \"Add\": \"Add\",\n  \"alarm\": \"Alarm\",\n  \"event\": \"Event\",\n  \"add the alarm\": \"add the alarm\",\n  \"create alarm\": \"Alarm creation\",\n  \"create event\": \"Event creation\",\n  \"edit alarm\": \"Alarm edition\",\n  \"edit event\": \"Event edition\",\n  \"edit\": \"Edit\",\n  \"create\": \"Create\",\n  \"creation\": \"Creation\",\n  \"invite\": \"Invite\",\n  \"close\": \"Close\",\n  \"delete\": \"Delete\",\n  \"Place\": \"Place\",\n  \"description\": \"Description\",\n  \"date\": \"date\",\n  \"Day\": \"Day\",\n  \"Edit\": \"Edit\",\n  \"Email\": \"Email\",\n  \"Import\": \"Import\",\n  \"Export\": \"Export\",\n  \"List\": \"List\",\n  \"list\": \"list\",\n  \"Calendar\": \"Calendar\",\n  \"calendar\": \"Calendar\",\n  \"Sync\": \"Sync\",\n  \"ie: 9:00 important meeting\": \"ie: 9:00 important meeting\",\n  \"Month\": \"Month\",\n  \"Popup\": \"Popup\",\n  \"Switch to List\": \"Switch to List\",\n  \"Switch to Calendar\": \"Switch to Calendar\",\n  \"time\": \"time\",\n  \"Today\": \"Today\",\n  \"What should I remind you ?\": \"What should I remind you?\",\n  \"alarm description placeholder\": \"What do you want to be reminded?\",\n  \"ICalendar import\": \"ICalendar import\",\n  \"select an icalendar file\": \"Select an icalendar file\",\n  \"import your icalendar file\": \"import your icalendar file\",\n  \"confirm import\": \"confirm import\",\n  \"cancel\": \"cancel\",\n  \"Create\": \"Create\",\n  \"Alarms to import\": \"Alarms to import\",\n  \"Events to import\": \"Events to import\",\n  \"Create Event\": \"Create Event\",\n  \"From hours:minutes\": \"From hours:minutes\",\n  \"To hours:minutes+days\": \"To hours:minutes+days\",\n  \"Description\": \"Description\",\n  \"days after\": \"days after\",\n  \"days later\": \"days later\",\n  \"Week\": \"Semaine\",\n  \"Alarms\": \"Alarms\",\n  \"Display\": \"Notification\",\n  \"DISPLAY\": \"Notification\",\n  \"EMAIL\": \"E-mail\",\n  \"BOTH\": \"E-mail & Notification\",\n  \"display previous events\": \"Display previous events\",\n  \"event\": \"Event\",\n  \"alarm\": \"Alarm\",\n  \"are you sure\": \"Are you sure ?\",\n  \"advanced\": \"More details\",\n  \"enter email\": \"Enter email\",\n  \"ON\": \"on\",\n  \"OFF\": \"off\",\n  \"recurrence\": \"Recurrence\",\n  \"recurrence rule\": \"Recurrence rules\",\n  \"make reccurent\": \"Make recurrent\",\n  \"repeat every\": \"Repeat every\",\n  \"no recurrence\": \"No recurrence\",\n  \"repeat on\": \"Repeat on\",\n  \"repeat on date\": \"Repeat on dates\",\n  \"repeat on weekday\": \"Repeat on weekday\",\n  \"repeat until\": \"Repeat until\",\n  \"after\": \"After\",\n  \"repeat\": \"Repeat\",\n  \"forever\": \"Forever\",\n  \"occurences\": \"occurences\",\n  \"every\": \"Every\",\n  \"days\": \"days\",\n  \"day\": \"day\",\n  \"weeks\": \"weeks\",\n  \"week\": \"week\",\n  \"months\": \"months\",\n  \"month\": \"month\",\n  \"years\": \"years\",\n  \"year\": \"year\",\n  \"until\": \"until\",\n  \"for\": \"for\",\n  \"on\": \"on\",\n  \"on the\": \"on the\",\n  \"th\": \"th\",\n  \"nd\": \"nd\",\n  \"rd\": \"rd\",\n  \"st\": \"st\",\n  \"last\": \"last\",\n  \"and\": \"and\",\n  \"times\": \"times\",\n  \"weekday\": \"weekday\",\n  \"summary\": \"Summary\",\n  \"place\": \"Place\",\n  \"start\": \"Start\",\n  \"end\": \"End\",\n  \"tags\": \"Tags\",\n  \"add tags\": \"Add tags\",\n  \"change\": \"Change\",\n  \"change calendar\": \"Change calendar\",\n  \"save changes\": \"Save changes\",\n  \"save changes and invite guests\": \"Save changes and invite guests\",\n  \"guests\": \"Guests\",\n  \"no description\": \"A title must be set.\",\n  \"start after end\": \"The start date is after the end date.\",\n  \"invalid start date\": \"The start date is invalid.\",\n  \"invalid end date\": \"The end date is invalid.\",\n  \"invalid trigg date\": \"The date is invalid.\",\n  \"invalid action\": \"The action is invalid.\"\n};\n","module.exports = {\n  \"Add\": \"Ajouter\",\n  \"alarm\": \"Alarme\",\n  \"event\": \"Evénement\",\n  \"add the alarm\": \"Ajouter l'alarme\",\n  \"create alarm\": \"Création d'une alarme\",\n  \"create event\": \"Création d'un évènement\",\n  \"edit alarm\": \"Modification d'une alarme\",\n  \"edit event\": \"Modification d'un évènement\",\n  \"edit\": \"Enregistrer\",\n  \"create\": \"Enregistrer\",\n  \"creation\": \"Creation\",\n  \"invite\": \"Inviter\",\n  \"close\": \"Fermer\",\n  \"delete\": \"Supprimer\",\n  \"Place\": \"Lieu\",\n  \"description\": \"Description\",\n  \"date\": \"Date\",\n  \"Day\": \"Jour\",\n  \"Edit\": \"Modifier\",\n  \"Email\": \"Email\",\n  \"Import\": \"Import\",\n  \"Export\": \"Export\",\n  \"List\": \"Liste\",\n  \"list\": \"liste\",\n  \"Calendar\": \"Calendrier\",\n  \"calendar\": \"Calendrier\",\n  \"Sync\": \"Sync\",\n  \"ie: 9:00 important meeting\": \"exemple: 9:00 appeler Jacque\",\n  \"Month\": \"Mois\",\n  \"Popup\": \"Popup\",\n  \"Switch to List\": \"Basculer en mode List\",\n  \"Switch to Calendar\": \"Basculer en mode Calendrier\",\n  \"time\": \"Heure\",\n  \"Today\": \"Aujourd'hui\",\n  \"What should I remind you ?\": \"Que dois-je vous rappeler ?\",\n  \"alarm description placeholder\": \"Que voulez-vous vous rappeler ?\",\n  \"ICalendar importer\": \"Importateur ICalendar\",\n  \"import your icalendar file\": \"Importer votre fichier icalendar\",\n  \"confirm import\": \"Confirmer l'import\",\n  \"cancel\": \"Annuler\",\n  \"Create\": \"Créer\",\n  \"Alarms to import\": \"Alarmes à importer\",\n  \"Events to import\": \"Evenements à importer\",\n  \"Create Event\": \"Créer un évènement\",\n  \"From hours:minutes\": \"De heures:minutes\",\n  \"To hours:minutes+days\": \"A heures:minutes+jours\",\n  \"Description\": \"Description\",\n  \"days after\": \"jours plus tard\",\n  \"days later\": \"jours plus tard\",\n  \"Week\": \"Semaine\",\n  \"Alarms\": \"Alarmes\",\n  \"Display\": \"Notification\",\n  \"DISPLAY\": \"Notification\",\n  \"EMAIL\": \"E-mail\",\n  \"BOTH\": \"E-mail & Notification\",\n  \"display previous events\": \"Montrer les évènements précédent\",\n  \"event\": \"Evenement\",\n  \"alarm\": \"Alarme\",\n  \"are you sure\": \"Etes-vous sur ?\",\n  \"advanced\": \"Détails\",\n  \"enter email\": \"Entrer l'addresse email\",\n  \"ON\": \"activée\",\n  \"OFF\": \"désactivée\",\n  \"recurrence\": \"Recurrence\",\n  \"recurrence rule\": \"Règle de recurrence\",\n  \"make reccurent\": \"Rendre réccurent\",\n  \"repeat every\": \"Répéter tous les\",\n  \"no recurrence\": \"Pas de répétition\",\n  \"repeat on\": \"Répéter les\",\n  \"repeat on date\": \"Répéter les jours du mois\",\n  \"repeat on weekday\": \"Répéter le jour de la semaine\",\n  \"repeat until\": \"Répéter jusqu'au\",\n  \"after\": \"ou après\",\n  \"repeat\": \"Répétition\",\n  \"forever\": \"Pour toujours\",\n  \"occurences\": \"occasions\",\n  \"every\": \"tous les\",\n  \"days\": \"jours\",\n  \"day\": \"jour\",\n  \"weeks\": \"semaines\",\n  \"week\": \"semaines\",\n  \"months\": \"mois\",\n  \"month\": \"mois\",\n  \"years\": \"ans\",\n  \"year\": \"ans\",\n  \"until\": \"jusqu'au\",\n  \"for\": \"pour\",\n  \"on\": \"le\",\n  \"on the\": \"le\",\n  \"th\": \"ème\",\n  \"nd\": \"ème\",\n  \"rd\": \"ème\",\n  \"st\": \"er\",\n  \"last\": \"dernier\",\n  \"and\": \"et\",\n  \"times\": \"fois\",\n  \"weekday\": \"jours de la semaine\",\n  \"summary\": \"Titre\",\n  \"place\": \"Endroit\",\n  \"start\": \"Début\",\n  \"end\": \"Fin\",\n  \"tags\": \"Tags\",\n  \"add tags\": \"Ajouter des tags\",\n  \"change\": \"Modifier\",\n  \"change calendar\": \"Changer le calendrier\",\n  \"save changes\": \"Enregistrer\",\n  \"save changes and invite guests\": \"Enregistrer et envoyer les invitations\",\n  \"guests\": \"Invités\",\n  \"no description\": \"Le titre est obligatoire\",\n  \"start after end\": \"La fin est après le début.\",\n  \"invalid start date\": \"Le début est invalide.\",\n  \"invalid end date\": \"La fin est invalide.\",\n  \"invalid trigg date\": \"Le moment est invalide.\",\n  \"invalid action\": \"L'action est invalide.\"\n};\n","var File, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nmodule.exports = File = (function(_super) {\n  __extends(File, _super);\n\n  function File() {\n    _ref = File.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  File.prototype.sync = function(method, model, options) {\n    var progress;\n\n    progress = function(e) {\n      return model.trigger('progress', e);\n    };\n    _.extend(options, {\n      xhr: function() {\n        var xhr;\n\n        xhr = $.ajaxSettings.xhr();\n        if (xhr instanceof window.XMLHttpRequest) {\n          xhr.addEventListener('progress', progress, false);\n        }\n        if (xhr.upload) {\n          xhr.upload.addEventListener('progress', progress, false);\n        }\n        return xhr;\n      }\n    });\n    return Backbone.sync.apply(this, arguments);\n  };\n\n  return File;\n\n})(Backbone.Model);\n","var ConfigRunView, ConfigView, FolderCollection, FolderView, Router, app, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\napp = require('application');\n\nFolderView = require('./views/folder');\n\nConfigView = require('./views/config');\n\nConfigRunView = require('./views/config_run');\n\nFolderCollection = require('./collections/files');\n\nmodule.exports = Router = (function(_super) {\n  __extends(Router, _super);\n\n  function Router() {\n    _ref = Router.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  Router.prototype.routes = {\n    'folder/*path': 'folder',\n    'config': 'login',\n    'configrun': 'config'\n  };\n\n  Router.prototype.folder = function(path) {\n    if (path === null) {\n      app.backButton.attr('href', '#folder/').removeClass('ion-ios7-arrow-back').addClass('ion-home');\n    } else {\n      app.backButton.attr('href', '#folder/' + path.split('/').slice(0, -1)).removeClass('ion-home').addClass('ion-ios7-arrow-back');\n    }\n    return this.display(new FolderView({\n      collection: FolderCollection.getAtPath(path)\n    }));\n  };\n\n  Router.prototype.login = function() {\n    return this.display(new ConfigView());\n  };\n\n  Router.prototype.config = function() {\n    return this.display(new ConfigRunView());\n  };\n\n  Router.prototype.display = function(view) {\n    if (this.mainView) {\n      this.mainView.remove();\n    }\n    this.mainView = view.render();\n    return $('#mainContent').append(this.mainView.$el);\n  };\n\n  return Router;\n\n})(Backbone.Router);\n","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<label class=\"item item-input\"><span class=\"input-label\">');\nvar __val__ = t('cozy url')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</span><input id=\"input-url\" type=\"text\"/></label><label class=\"item item-input\"><span class=\"input-label\">');\nvar __val__ = t('cozy password')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</span><input id=\"input-pass\" type=\"password\"/></label><label class=\"item item-input\"><span class=\"input-label\">');\nvar __val__ = t('device name')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</span><input id=\"input-device\" type=\"text\"/></label><button id=\"btn-save\" class=\"button button-block button-calm\">Save</button>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div id=\"dialog-upload-file\" class=\"modal fade\"><div class=\"modal-dialog\"><div class=\"modal-content\"><div class=\"modal-header\"><button type=\"button\" data-dismiss=\"modal\" aria-hidden=\"true\" class=\"close\">×</button><h4 class=\"modal-title\">' + escape((interp = t(\"upload caption\")) == null ? '' : interp) + '</h4></div><div class=\"modal-body\"><fieldset><div class=\"form-group\"><label for=\"uploader\">' + escape((interp = t(\"upload msg\")) == null ? '' : interp) + '</label><input id=\"uploader\" type=\"file\" multiple=\"multiple\" class=\"form-control\"/></div></fieldset></div><div class=\"modal-footer\"><button id=\"cancel-new-file\" type=\"button\" data-dismiss=\"modal\" class=\"btn btn-link\">' + escape((interp = t(\"upload close\")) == null ? '' : interp) + '</button><button id=\"upload-file-send\" type=\"button\" class=\"btn btn-cozy-contrast\">' + escape((interp = t(\"upload send\")) == null ? '' : interp) + '</button></div></div></div></div><div id=\"dialog-new-folder\" class=\"modal fade\"><div class=\"modal-dialog\"><div class=\"modal-content\"><div class=\"modal-header\"><button type=\"button\" data-dismiss=\"modal\" aria-hidden=\"true\" class=\"close\">×</button><h4 class=\"modal-title\">' + escape((interp = t(\"new folder caption\")) == null ? '' : interp) + '</h4></div><div class=\"modal-body\"><fieldset><div class=\"form-group\"><label for=\"inputName\">' + escape((interp = t(\"new folder msg\")) == null ? '' : interp) + '</label><input id=\"inputName\" type=\"text\" class=\"form-control\"/></div><div id=\"folder-upload-form\" class=\"form-group hide\"><br/><p class=\"text-center\">or</p><label for=\"inputName\">' + escape((interp = t(\"upload folder msg\")) == null ? '' : interp) + '</label><input id=\"folder-uploader\" type=\"file\" directory=\"directory\" mozdirectory=\"mozdirectory\" webkitdirectory=\"webkitdirectory\" class=\"form-control\"/></div></fieldset></div><div class=\"modal-footer\"><button id=\"cancel-new-folder\" type=\"button\" data-dismiss=\"modal\" class=\"btn btn-link\">' + escape((interp = t(\"new folder close\")) == null ? '' : interp) + '</button><button id=\"new-folder-send\" type=\"button\" class=\"btn btn-cozy\">' + escape((interp = t(\"new folder send\")) == null ? '' : interp) + '</button></div></div></div></div><div id=\"affixbar\" data-spy=\"affix\" data-offset-top=\"1\"><div class=\"container\"><div class=\"row\"><div class=\"col-lg-12\"><p class=\"pull-right\"><input id=\"search-box\" type=\"search\" class=\"pull-right\"/><div id=\"upload-buttons\" class=\"pull-right\"><a id=\"button-upload-new-file\" class=\"btn btn-cozy\"><img src=\"images/add-file.png\"/></a>&nbsp;<a id=\"button-new-folder\" data-toggle=\"modal\" data-target=\"#dialog-new-folder\" class=\"btn btn-cozy\"><img src=\"images/add-folder.png\"/></a></div></p></div></div></div></div><div class=\"container\"><div class=\"row content-shadow\"><div id=\"content\" class=\"col-lg-12\"><div id=\"crumbs\"></div><div id=\"loading-indicator\"></div><table id=\"table-items\" class=\"table table-hover\"><tbody id=\"table-items-body\"><tr class=\"table-headers\"><td><span>Name</span><a id=\"down-name\" class=\"btn glyphicon glyphicon-chevron-down\"></a><a id=\"up-name\" class=\"btn glyphicon glyphicon-chevron-up\"></a></td><td class=\"size-column-cell\"><span>Size</span><a id=\"down-size\" class=\"glyphicon glyphicon-chevron-down btn\"></a><a id=\"up-size\" class=\"unactive btn glyphicon glyphicon-chevron-up\"></a></td><td class=\"type-column-cell\"><span>Type</span><a id=\"down-class\" class=\"btn glyphicon glyphicon-chevron-down\"></a><a id=\"up-class\" class=\"glyphicon glyphicon-chevron-up btn unactive\"></a></td><td class=\"date-column-cell\"><span>Date</span><a id=\"down-lastModification\" class=\"btn glyphicon glyphicon-chevron-down\"></a><a id=\"up-lastModification\" class=\"btn glyphicon glyphicon-chevron-up unactive\"></a></td></tr></tbody></table><div id=\"files\"></div></div></div></div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nif ( model.docType == 'Folder')\n{\nbuf.push('<i class=\"icon ion-folder\"></i>');\n}\nelse\n{\nbuf.push('<i class=\"icon ion-document\"></i>');\n}\nbuf.push('<span>');\nvar __val__ = model.name\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</span>');\n}\nreturn buf.join(\"\");\n};","var BaseView, ConfigView, showLoader, urlparse, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nshowLoader = require('./loader');\n\nurlparse = require('../lib/url');\n\nmodule.exports = ConfigView = (function(_super) {\n  __extends(ConfigView, _super);\n\n  function ConfigView() {\n    _ref = ConfigView.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  ConfigView.prototype.className = 'list';\n\n  ConfigView.prototype.template = require('../templates/config');\n\n  ConfigView.prototype.events = function() {\n    return {\n      'click #btn-save': 'doSave'\n    };\n  };\n\n  ConfigView.prototype.doSave = function() {\n    var config, device, pass, url,\n      _this = this;\n\n    url = this.$('#input-url').val();\n    pass = this.$('#input-pass').val();\n    device = this.$('#input-device').val();\n    if (!(url && pass && device)) {\n      return this.displayError('all fields are required');\n    }\n    if (url.slice(0, 4) === 'http') {\n      this.$('#input-url').val(url = urlparse(url).hostname);\n    }\n    config = {\n      cozyURL: url,\n      password: pass,\n      deviceName: device\n    };\n    return app.replicator.registerRemote(config, function(err) {\n      var loader, progressback;\n\n      if (err) {\n        return _this.displayError(err.message);\n      }\n      $('#footer').text('begin replication');\n      loader = showLoader('initial replication');\n      progressback = function(ratio) {\n        return loader.setContent('status = ' + 100 * ratio + '%');\n      };\n      return app.replicator.initialReplication(progressback, function(err) {\n        loader.hide();\n        if (err) {\n          return _this.displayError(err.message);\n        }\n        $('#footer').text('replication complete');\n        return app.router.navigate('folder/', {\n          trigger: true\n        });\n      });\n    });\n  };\n\n  ConfigView.prototype.displayError = function(text, field) {\n    if (this.error) {\n      this.error.remove();\n    }\n    this.error = $('<div>').addClass('button button-full button-energized');\n    this.error.text(text);\n    return this.$(field || '#btn-save').before(this.error);\n  };\n\n  return ConfigView;\n\n})(BaseView);\n","var BaseView, ConfigView, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nmodule.exports = ConfigView = (function(_super) {\n  __extends(ConfigView, _super);\n\n  function ConfigView() {\n    _ref = ConfigView.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  ConfigView.prototype.template = function() {\n    return \"<button id=\\\"redbtn\\\">RED BUTTON</button>\\n<button id=\\\"greenbtn\\\">GREEN BUTTON</button>\";\n  };\n\n  ConfigView.prototype.events = function() {\n    return {\n      'click #redbtn': 'redBtn',\n      'click #greenbtn': 'greenBtn'\n    };\n  };\n\n  ConfigView.prototype.redBtn = function() {\n    var _this = this;\n\n    return app.replicator.destroyDB(function(err) {\n      if (err) {\n        return _this.displayError(err.message, '#redbtn');\n      }\n      return $('#redbtn').text('DONE');\n    });\n  };\n\n  ConfigView.prototype.greenBtn = function() {\n    var _this = this;\n\n    return app.replicator.startSync(function(err) {\n      if (err) {\n        return _this.displayError(err.message, '#greenbtn');\n      }\n      return $('#greenbtn').text('DONE');\n    });\n  };\n\n  ConfigView.prototype.displayError = function(text, field) {\n    if (this.error) {\n      this.error.remove();\n    }\n    this.error = $('<div>').addClass('button button-full button-energized');\n    this.error.text(text);\n    return this.$(field).before(this.error);\n  };\n\n  return ConfigView;\n\n})(BaseView);\n","var CollectionView, FolderView, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nCollectionView = require('../lib/view_collection');\n\nmodule.exports = FolderView = (function(_super) {\n  __extends(FolderView, _super);\n\n  function FolderView() {\n    _ref = FolderView.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  FolderView.prototype.className = 'list';\n\n  FolderView.prototype.itemview = require('./folder_line');\n\n  return FolderView;\n\n})(CollectionView);\n","var BaseView, ConfigView, showLoader, _ref,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nshowLoader = require('./loader');\n\nmodule.exports = ConfigView = (function(_super) {\n  __extends(ConfigView, _super);\n\n  function ConfigView() {\n    this.onClick = __bind(this.onClick, this);    _ref = ConfigView.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  ConfigView.prototype.tagName = 'a';\n\n  ConfigView.prototype.className = 'item item-icon-left';\n\n  ConfigView.prototype.template = require('../templates/folder_line');\n\n  ConfigView.prototype.events = {\n    'click': 'onClick'\n  };\n\n  ConfigView.prototype.onClick = function() {\n    var loader, path, xhr;\n\n    if (this.model.get('docType') === 'Folder') {\n      path = this.model.get('path') + '/' + this.model.get('name');\n      return app.router.navigate(\"#folder\" + path, {\n        trigger: true\n      });\n    } else {\n      loader = showLoader('downloading binary');\n      xhr = app.replicator.getBinary(this.model.get('binary'), function(err, url) {\n        loader.hide();\n        if (err) {\n          return alert(err.message);\n        }\n        return window.open(url, '_system');\n      });\n      return loader.$el.on('click', function() {\n        xhr.abort();\n        return loader.hide();\n      });\n    }\n  };\n\n  return ConfigView;\n\n})(BaseView);\n","module.exports = function(content) {\n  var el, view;\n\n  $('body').append(el = $(\"<div class=\\\"loading-backdrop\\\" class=\\\"enabled\\\">\\n    <div class=\\\"loading\\\">\" + content + \"</div>\\n</div>\"));\n  view = new ionic.views.Loading({\n    el: el[0]\n  });\n  view.$el = el;\n  view.show();\n  view.setContent = function(text) {\n    return $el.find('.loading').text(text);\n  };\n  return view;\n};\n"]}