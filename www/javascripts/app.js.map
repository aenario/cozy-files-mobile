{"version":3,"sources":["app/application.coffee","app/collections/files.coffee","app/initialize.coffee","app/lib/base_view.coffee","app/lib/basic.coffee","app/lib/device_status.coffee","app/lib/request.js","app/lib/view_collection.coffee","app/locales/en.coffee","app/locales/fr.coffee","app/models/file.coffee","app/replicator/filesystem.coffee","app/replicator/main.coffee","app/replicator/replicator_backups.coffee","app/replicator/replicator_config.coffee","app/replicator/replicator_mapreduce.coffee","app/replicator/utils.coffee","app/router.coffee","app/templates/config.jade","app/templates/device_name_picker.jade","app/templates/first_sync.jade","app/templates/folder_line.jade","app/templates/layout.jade","app/templates/login.jade","app/templates/menu.jade","app/views/config.coffee","app/views/device_name_picker.coffee","app/views/first_sync.coffee","app/views/folder.coffee","app/views/folder_line.coffee","app/views/layout.coffee","app/views/login.coffee","app/views/menu.coffee"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtEA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5LA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3CA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArCA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArEA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzdA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtHA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhEA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhEA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1CA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtSA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/jBA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtXA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7FA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjIA;AAAA;ACAA;AAAA;AACA;AADA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9HA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzEA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtBA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAdA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3DA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAdA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArBA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnBA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArGA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1GA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzEA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtHA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzLA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3MA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArGA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtHA;AAAA","file":"../www/javascripts/app.js","sourcesContent":["var LayoutView, Replicator;\n\nReplicator = require('./replicator/main');\n\nLayoutView = require('./views/layout');\n\nmodule.exports = {\n  initialize: function() {\n    window.app = this;\n    if (window.isBrowserDebugging) {\n      window.navigator = window.navigator || {};\n      window.navigator.globalization = window.navigator.globalization || {};\n      window.navigator.globalization.getPreferredLanguage = function(callback) {\n        return callback({\n          value: 'fr-FR'\n        });\n      };\n    }\n    return navigator.globalization.getPreferredLanguage((function(_this) {\n      return function(properties) {\n        var Router, e, locales;\n        _this.locale = properties.value.split('-')[0];\n        _this.polyglot = new Polyglot();\n        locales = (function() {\n          try {\n            return require('locales/' + this.locale);\n          } catch (_error) {\n            e = _error;\n            return require('locales/en');\n          }\n        }).call(_this);\n        _this.polyglot.extend(locales);\n        window.t = _this.polyglot.t.bind(_this.polyglot);\n        Router = require('router');\n        _this.router = new Router();\n        _this.replicator = new Replicator();\n        _this.layout = new LayoutView();\n        return _this.replicator.init(function(err, config) {\n          if (err) {\n            console.log(err, err.stack);\n            return alert(err.message || err);\n          }\n          $('body').empty().append(_this.layout.render().$el);\n          Backbone.history.start();\n          if (config.remote) {\n            _this.router.navigate('folder/', {\n              trigger: true\n            });\n            return _this.router.once('collectionfetched', function() {\n              app.replicator.startRealtime();\n              app.replicator.backup();\n              return document.addEventListener(\"resume\", function() {\n                console.log(\"RESUME EVENT\");\n                if (app.backFromOpen) {\n                  return app.backFromOpen = false;\n                } else {\n                  return app.replicator.backup();\n                }\n              }, false);\n            });\n          } else {\n            return _this.router.navigate('login', {\n              trigger: true\n            });\n          }\n        });\n      };\n    })(this));\n  }\n};\n","var File, FileAndFolderCollection,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nFile = require('../models/file');\n\nmodule.exports = FileAndFolderCollection = (function(_super) {\n  __extends(FileAndFolderCollection, _super);\n\n  function FileAndFolderCollection() {\n    return FileAndFolderCollection.__super__.constructor.apply(this, arguments);\n  }\n\n  FileAndFolderCollection.prototype.model = File;\n\n  FileAndFolderCollection.cache = {};\n\n  FileAndFolderCollection.prototype.initialize = function(models, options) {\n    this.path = options.path;\n    this.query = options.query;\n    return this.notloaded = true;\n  };\n\n  FileAndFolderCollection.prototype.isSearch = function() {\n    return this.path === void 0;\n  };\n\n  FileAndFolderCollection.prototype.search = function(callback) {\n    var params;\n    params = {\n      query: this.query,\n      fields: ['name'],\n      include_docs: true\n    };\n    return app.replicator.db.search(params, (function(_this) {\n      return function(err, items) {\n        return _this.slowReset(items, function(err) {\n          _this.notloaded = false;\n          return callback(err);\n        });\n      };\n    })(this));\n  };\n\n  FileAndFolderCollection.prototype.fetch = function(_callback) {\n    var cacheKey, callback, items;\n    if (_callback == null) {\n      _callback = function() {};\n    }\n    callback = (function(_this) {\n      return function(err) {\n        _this.notloaded = false;\n        _this.trigger('sync');\n        return _callback(err);\n      };\n    })(this);\n    cacheKey = this.path === null ? '' : this.path;\n    if (cacheKey in FileAndFolderCollection.cache) {\n      items = FileAndFolderCollection.cache[cacheKey];\n      return this.slowReset(items, (function(_this) {\n        return function(err) {\n          if (!err) {\n            _this.fetchAdditional();\n          }\n          return callback(err);\n        };\n      })(this));\n    }\n    console.log(\"CACHE MISS \" + cacheKey);\n    return this._fetch(this.path, (function(_this) {\n      return function(err, items) {\n        if (err) {\n          return callback(err);\n        }\n        return _this.slowReset(items, function(err) {\n          if (!err) {\n            _this.fetchAdditional();\n          }\n          return callback(err);\n        });\n      };\n    })(this));\n  };\n\n  FileAndFolderCollection.prototype._fetch = function(path, callback) {\n    var params;\n    params = {\n      startkey: path ? ['/' + path] : [''],\n      endkey: path ? ['/' + path, {}] : ['', {}],\n      include_docs: true\n    };\n    return app.replicator.db.query('FilesAndFolder', params, callback);\n  };\n\n  FileAndFolderCollection.prototype.slowReset = function(results, callback) {\n    var i, models, nonBlockingAdd;\n    models = results.rows.map(function(row) {\n      var binary_id, doc, _ref, _ref1;\n      doc = row.doc;\n      if (binary_id = (_ref = doc.binary) != null ? (_ref1 = _ref.file) != null ? _ref1.id : void 0 : void 0) {\n        doc.incache = app.replicator.fileInFileSystem(doc);\n        doc.version = app.replicator.fileVersion(doc);\n      }\n      return doc;\n    });\n    this.reset(models.slice(0, 10));\n    i = 0;\n    return (nonBlockingAdd = (function(_this) {\n      return function() {\n        if (i * 10 > models.length) {\n          _this.nextAdd = null;\n          return callback(null);\n        }\n        i++;\n        _this.add(models.slice(i * 10, (i + 1) * 10));\n        return _this.nextAdd = setTimeout(nonBlockingAdd, 10);\n      };\n    })(this))();\n  };\n\n  FileAndFolderCollection.prototype.remove = function() {\n    FileAndFolderCollection.__super__.remove.apply(this, arguments);\n    return this.clearTimeout(this.nextAdd);\n  };\n\n  FileAndFolderCollection.prototype.cancelFetchAdditional = function() {\n    return this.cancelled = true;\n  };\n\n  FileAndFolderCollection.prototype.fetchAdditional = function() {\n    var toBeCached;\n    FileAndFolderCollection.cache = {};\n    toBeCached = this.filter(function(model) {\n      var _ref;\n      return ((_ref = model.get('docType')) != null ? _ref.toLowerCase() : void 0) === 'folder';\n    });\n    return async.eachSeries(toBeCached, (function(_this) {\n      return function(folder, cb) {\n        var path;\n        if (_this.cancelled) {\n          return cb(new Error('cancelled'));\n        }\n        path = folder.wholePath();\n        return _this._fetch(path, function(err, items) {\n          if (this.cancelled) {\n            return cb(new Error('cancelled'));\n          }\n          if (!err) {\n            FileAndFolderCollection.cache[path] = items;\n          }\n          return app.replicator.folderInFileSystem(path, function(err, incache) {\n            if (this.cancelled) {\n              return cb(new Error('cancelled'));\n            }\n            if (err) {\n              console.log(err);\n            }\n            folder.set('incache', incache);\n            return setTimeout(cb, 10);\n          });\n        });\n      };\n    })(this), (function(_this) {\n      return function(err) {\n        var path;\n        if (_this.cancelled) {\n          return;\n        }\n        if (err) {\n          console.log(err);\n        }\n        path = (_this.path || '').split('/').slice(0, -1).join('/');\n        return _this._fetch(path, function(err, items) {\n          if (_this.cancelled) {\n            return;\n          }\n          if (!err) {\n            FileAndFolderCollection.cache[path] = items;\n          }\n          return _this.trigger('fullsync');\n        });\n      };\n    })(this));\n  };\n\n  return FileAndFolderCollection;\n\n})(Backbone.Collection);\n","var app;\n\napp = require('application');\n\ndocument.addEventListener('deviceready', function() {\n  return app.initialize();\n});\n","var BaseView,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nmodule.exports = BaseView = (function(_super) {\n  __extends(BaseView, _super);\n\n  function BaseView() {\n    return BaseView.__super__.constructor.apply(this, arguments);\n  }\n\n  BaseView.prototype.template = function() {};\n\n  BaseView.prototype.initialize = function() {};\n\n  BaseView.prototype.getRenderData = function() {\n    var _ref;\n    return {\n      model: (_ref = this.model) != null ? _ref.toJSON() : void 0\n    };\n  };\n\n  BaseView.prototype.render = function() {\n    this.beforeRender();\n    this.$el.html(this.template(this.getRenderData()));\n    this.afterRender();\n    return this;\n  };\n\n  BaseView.prototype.beforeRender = function() {};\n\n  BaseView.prototype.afterRender = function() {};\n\n  BaseView.prototype.destroy = function() {\n    this.undelegateEvents();\n    this.$el.removeData().unbind();\n    this.remove();\n    return Backbone.View.prototype.remove.call(this);\n  };\n\n  return BaseView;\n\n})(Backbone.View);\n","var b64, b64_enc, basic;\n\nb64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n\nb64_enc = function(data) {\n  var ac, bits, h1, h2, h3, h4, i, o1, o2, o3, out;\n  if (!data) {\n    return data;\n  }\n  i = 0;\n  ac = 0;\n  out = [];\n  while (i < data.length) {\n    o1 = data.charCodeAt(i++);\n    o2 = data.charCodeAt(i++);\n    o3 = data.charCodeAt(i++);\n    bits = o1 << 16 | o2 << 8 | o3;\n    h1 = bits >> 18 & 0x3f;\n    h2 = bits >> 12 & 0x3f;\n    h3 = bits >> 6 & 0x3f;\n    h4 = bits & 0x3f;\n    out[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\n  }\n  out = out.join('');\n  switch (data.length % 3) {\n    case 1:\n      out = out.slice(0, -2) + '==';\n      break;\n    case 2:\n      out = out.slice(0, -1) + '=';\n  }\n  return out;\n};\n\nmodule.exports = basic = function(auth) {\n  return 'Basic ' + b64_enc(auth.username + ':' + auth.password);\n};\n","var battery, callbackWaiting, callbacks, initialized, readyForSync, readyForSyncMsg, update;\n\ncallbacks = [];\n\ninitialized = false;\n\nreadyForSync = null;\n\nreadyForSyncMsg = \"\";\n\nbattery = null;\n\ncallbackWaiting = function(err, ready, msg) {\n  var callback, _i, _len;\n  readyForSync = ready;\n  readyForSyncMsg = msg;\n  for (_i = 0, _len = callbacks.length; _i < _len; _i++) {\n    callback = callbacks[_i];\n    callback(err, ready, msg);\n  }\n  return callbacks = [];\n};\n\nupdate = function() {\n  if (battery == null) {\n    return;\n  }\n  if (!(battery.level > 20 || battery.isPlugged)) {\n    return callbackWaiting(null, false, 'no battery');\n  }\n  if (app.replicator.config.get('syncOnWifi') && !navigator.connection.type === Connection.WIFI) {\n    return callbackWaiting(null, false, 'no wifi');\n  }\n  return callbackWaiting(null, true);\n};\n\nmodule.exports.checkReadyForSync = function(callback) {\n  var timeout;\n  if (readyForSync != null) {\n    callback(null, readyForSync, readyForSyncMsg);\n  } else if (window.isBrowserDebugging) {\n    callback(null, true);\n  } else {\n    callbacks.push(callback);\n  }\n  if (!initialized) {\n    timeout = true;\n    setTimeout((function(_this) {\n      return function() {\n        if (timeout) {\n          timeout = false;\n          initialized = false;\n          return callback(null, true);\n        }\n      };\n    })(this), 4 * 1000);\n    window.addEventListener('batterystatus', (function(_this) {\n      return function(newStatus) {\n        if (timeout) {\n          timeout = false;\n          battery = newStatus;\n          return update();\n        }\n      };\n    })(this), false);\n    app.replicator.config.on('change:syncOnWifi', update);\n    return initialized = true;\n  }\n};\n","// Browser Request\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nvar XHR = XMLHttpRequest\nif (!XHR) throw new Error('missing XMLHttpRequest')\nrequest.log = {\n  'trace': noop, 'debug': noop, 'info': noop, 'warn': noop, 'error': noop\n}\n\nvar DEFAULT_TIMEOUT = 3 * 60 * 1000 // 3 minutes\n\n//\n// request\n//\n\nfunction request(options, callback) {\n  // The entry-point to the API: prep the options object and pass the real work to run_xhr.\n  if(typeof callback !== 'function')\n    throw new Error('Bad callback given: ' + callback)\n\n  if(!options)\n    throw new Error('No options given')\n\n  var options_onResponse = options.onResponse; // Save this for later.\n\n  if(typeof options === 'string')\n    options = {'uri':options};\n  else\n    options = JSON.parse(JSON.stringify(options)); // Use a duplicate for mutating.\n\n  options.onResponse = options_onResponse // And put it back.\n\n  if (options.verbose) request.log = getLogger();\n\n  if(options.url) {\n    options.uri = options.url;\n    delete options.url;\n  }\n\n  if(!options.uri && options.uri !== \"\")\n    throw new Error(\"options.uri is a required argument\");\n\n  if(typeof options.uri != \"string\")\n    throw new Error(\"options.uri must be a string\");\n\n  var unsupported_options = ['proxy', '_redirectsFollowed', 'maxRedirects', 'followRedirect']\n  for (var i = 0; i < unsupported_options.length; i++)\n    if(options[ unsupported_options[i] ])\n      throw new Error(\"options.\" + unsupported_options[i] + \" is not supported\")\n\n  options.callback = callback\n  options.method = options.method || 'GET';\n  options.headers = options.headers || {};\n  options.body    = options.body || null\n  options.timeout = options.timeout || request.DEFAULT_TIMEOUT\n\n  if(options.headers.host)\n    throw new Error(\"Options.headers.host is not supported\");\n\n  if(options.json) {\n    options.headers.accept = options.headers.accept || 'application/json'\n    if(options.method !== 'GET')\n      options.headers['content-type'] = 'application/json'\n\n    if(typeof options.json !== 'boolean')\n      options.body = JSON.stringify(options.json)\n    else if(typeof options.body !== 'string')\n      options.body = JSON.stringify(options.body)\n  }\n\n  //BEGIN QS Hack\n  var serialize = function(obj) {\n    var str = [];\n    for(var p in obj)\n      if (obj.hasOwnProperty(p)) {\n        str.push(encodeURIComponent(p) + \"=\" + encodeURIComponent(obj[p]));\n      }\n    return str.join(\"&\");\n  }\n\n  if(options.qs){\n    var qs = (typeof options.qs == 'string')? options.qs : serialize(options.qs);\n    if(options.uri.indexOf('?') !== -1){ //no get params\n        options.uri = options.uri+'&'+qs;\n    }else{ //existing get params\n        options.uri = options.uri+'?'+qs;\n    }\n  }\n  //END QS Hack\n\n  //BEGIN FORM Hack\n  var multipart = function(obj) {\n    //todo: support file type (useful?)\n    var result = {};\n    result.boundry = '-------------------------------'+Math.floor(Math.random()*1000000000);\n    var lines = [];\n    for(var p in obj){\n        if (obj.hasOwnProperty(p)) {\n            lines.push(\n                '--'+result.boundry+\"\\n\"+\n                'Content-Disposition: form-data; name=\"'+p+'\"'+\"\\n\"+\n                \"\\n\"+\n                obj[p]+\"\\n\"\n            );\n        }\n    }\n    lines.push( '--'+result.boundry+'--' );\n    result.body = lines.join('');\n    result.length = result.body.length;\n    result.type = 'multipart/form-data; boundary='+result.boundry;\n    return result;\n  }\n\n  if(options.form){\n    if(typeof options.form == 'string') throw('form name unsupported');\n    if(options.method === 'POST'){\n        var encoding = (options.encoding || 'application/x-www-form-urlencoded').toLowerCase();\n        options.headers['content-type'] = encoding;\n        switch(encoding){\n            case 'application/x-www-form-urlencoded':\n                options.body = serialize(options.form).replace(/%20/g, \"+\");\n                break;\n            case 'multipart/form-data':\n                var multi = multipart(options.form);\n                //options.headers['content-length'] = multi.length;\n                options.body = multi.body;\n                options.headers['content-type'] = multi.type;\n                break;\n            default : throw new Error('unsupported encoding:'+encoding);\n        }\n    }\n  }\n  //END FORM Hack\n\n  // If onResponse is boolean true, call back immediately when the response is known,\n  // not when the full request is complete.\n  options.onResponse = options.onResponse || noop\n  if(options.onResponse === true) {\n    options.onResponse = callback\n    options.callback = noop\n  }\n\n  // XXX Browsers do not like this.\n  //if(options.body)\n  //  options.headers['content-length'] = options.body.length;\n\n  // HTTP basic authentication\n  if(!options.headers.authorization && options.auth)\n    options.headers.authorization = 'Basic ' + b64_enc(options.auth.username + ':' + options.auth.password);\n\n  return run_xhr(options)\n}\n\nvar req_seq = 0\nfunction run_xhr(options) {\n  var xhr = new XHR\n    , timed_out = false\n    , is_cors = is_crossDomain(options.uri)\n    , supports_cors = ('withCredentials' in xhr)\n\n  req_seq += 1\n  xhr.seq_id = req_seq\n  xhr.id = req_seq + ': ' + options.method + ' ' + options.uri\n  xhr._id = xhr.id // I know I will type \"_id\" from habit all the time.\n\n  if(is_cors && !supports_cors) {\n    var cors_err = new Error('Browser does not support cross-origin request: ' + options.uri)\n    cors_err.cors = 'unsupported'\n    return options.callback(cors_err, xhr)\n  }\n\n  xhr.timeoutTimer = setTimeout(too_late, options.timeout)\n  function too_late() {\n    timed_out = true\n    var er = new Error('ETIMEDOUT')\n    er.code = 'ETIMEDOUT'\n    er.duration = options.timeout\n\n    request.log.error('Timeout', { 'id':xhr._id, 'milliseconds':options.timeout })\n    return options.callback(er, xhr)\n  }\n\n  // Some states can be skipped over, so remember what is still incomplete.\n  var did = {'response':false, 'loading':false, 'end':false}\n\n  xhr.onreadystatechange = on_state_change\n  xhr.open(options.method, options.uri, true) // asynchronous\n  if(is_cors)\n    xhr.withCredentials = !! options.withCredentials\n  xhr.send(options.body)\n  return xhr\n\n  function on_state_change(event) {\n    if(timed_out)\n      return request.log.debug('Ignoring timed out state change', {'state':xhr.readyState, 'id':xhr.id})\n\n    request.log.debug('State change', {'state':xhr.readyState, 'id':xhr.id, 'timed_out':timed_out})\n\n    if(xhr.readyState === XHR.OPENED) {\n      request.log.debug('Request started', {'id':xhr.id})\n      for (var key in options.headers)\n        xhr.setRequestHeader(key, options.headers[key])\n    }\n\n    else if(xhr.readyState === XHR.HEADERS_RECEIVED)\n      on_response()\n\n    else if(xhr.readyState === XHR.LOADING) {\n      on_response()\n      on_loading()\n    }\n\n    else if(xhr.readyState === XHR.DONE) {\n      on_response()\n      on_loading()\n      on_end()\n    }\n  }\n\n  function on_response() {\n    if(did.response)\n      return\n\n    did.response = true\n    request.log.debug('Got response', {'id':xhr.id, 'status':xhr.status})\n    clearTimeout(xhr.timeoutTimer)\n    xhr.statusCode = xhr.status // Node request compatibility\n\n    // Detect failed CORS requests.\n    if(is_cors && xhr.statusCode == 0) {\n      var cors_err = new Error('CORS request rejected: ' + options.uri)\n      cors_err.cors = 'rejected'\n\n      // Do not process this request further.\n      did.loading = true\n      did.end = true\n\n      return options.callback(cors_err, xhr)\n    }\n\n    options.onResponse(null, xhr)\n  }\n\n  function on_loading() {\n    if(did.loading)\n      return\n\n    did.loading = true\n    request.log.debug('Response body loading', {'id':xhr.id})\n    // TODO: Maybe simulate \"data\" events by watching xhr.responseText\n  }\n\n  function on_end() {\n    if(did.end)\n      return\n\n    did.end = true\n    request.log.debug('Request done', {'id':xhr.id})\n\n    xhr.body = xhr.responseText\n    if(options.json) {\n      try        { xhr.body = JSON.parse(xhr.responseText) }\n      catch (er) { return options.callback(er, xhr)        }\n    }\n\n    options.callback(null, xhr, xhr.body)\n  }\n\n} // request\n\nrequest.withCredentials = false;\nrequest.DEFAULT_TIMEOUT = DEFAULT_TIMEOUT;\n\n//\n// defaults\n//\n\nrequest.defaults = function(options, requester) {\n  var def = function (method) {\n    var d = function (params, callback) {\n      if(typeof params === 'string')\n        params = {'uri': params};\n      else {\n        params = JSON.parse(JSON.stringify(params));\n      }\n      for (var i in options) {\n        if (params[i] === undefined) params[i] = options[i]\n      }\n      return method(params, callback)\n    }\n    return d\n  }\n  var de = def(request)\n  de.get = def(request.get)\n  de.post = def(request.post)\n  de.put = def(request.put)\n  de.head = def(request.head)\n  return de\n}\n\n//\n// HTTP method shortcuts\n//\n\nvar shortcuts = [ 'get', 'put', 'post', 'head' ];\nshortcuts.forEach(function(shortcut) {\n  var method = shortcut.toUpperCase();\n  var func   = shortcut.toLowerCase();\n\n  request[func] = function(opts) {\n    if(typeof opts === 'string')\n      opts = {'method':method, 'uri':opts};\n    else {\n      opts = JSON.parse(JSON.stringify(opts));\n      opts.method = method;\n    }\n\n    var args = [opts].concat(Array.prototype.slice.apply(arguments, [1]));\n    return request.apply(this, args);\n  }\n})\n\n//\n// CouchDB shortcut\n//\n\nrequest.couch = function(options, callback) {\n  if(typeof options === 'string')\n    options = {'uri':options}\n\n  // Just use the request API to do JSON.\n  options.json = true\n  if(options.body)\n    options.json = options.body\n  delete options.body\n\n  callback = callback || noop\n\n  var xhr = request(options, couch_handler)\n  return xhr\n\n  function couch_handler(er, resp, body) {\n    if(er)\n      return callback(er, resp, body)\n\n    if((resp.statusCode < 200 || resp.statusCode > 299) && body.error) {\n      // The body is a Couch JSON object indicating the error.\n      er = new Error('CouchDB error: ' + (body.error.reason || body.error.error || body.error))\n      for (var key in body)\n        er[key] = body[key]\n      return callback(er, resp, body);\n    }\n\n    return callback(er, resp, body);\n  }\n}\n\n//\n// Utility\n//\n\nfunction noop() {}\n\nfunction getLogger() {\n  var logger = {}\n    , levels = ['trace', 'debug', 'info', 'warn', 'error']\n    , level, i\n\n  for(i = 0; i < levels.length; i++) {\n    level = levels[i]\n\n    logger[level] = noop\n    if(typeof console !== 'undefined' && console && console[level])\n      logger[level] = formatted(console, level)\n  }\n\n  return logger\n}\n\nfunction formatted(obj, method) {\n  return formatted_logger\n\n  function formatted_logger(str, context) {\n    if(typeof context === 'object')\n      str += ' ' + JSON.stringify(context)\n\n    return obj[method].call(obj, str)\n  }\n}\n\n// Return whether a URL is a cross-domain request.\nfunction is_crossDomain(url) {\n  var rurl = /^([\\w\\+\\.\\-]+:)(?:\\/\\/([^\\/?#:]*)(?::(\\d+))?)?/\n\n  // jQuery #8138, IE may throw an exception when accessing\n  // a field from window.location if document.domain has been set\n  var ajaxLocation\n  try { ajaxLocation = location.href }\n  catch (e) {\n    // Use the href attribute of an A element since IE will modify it given document.location\n    ajaxLocation = document.createElement( \"a\" );\n    ajaxLocation.href = \"\";\n    ajaxLocation = ajaxLocation.href;\n  }\n\n  var ajaxLocParts = rurl.exec(ajaxLocation.toLowerCase()) || []\n    , parts = rurl.exec(url.toLowerCase() )\n\n  var result = !!(\n    parts &&\n    (  parts[1] != ajaxLocParts[1]\n    || parts[2] != ajaxLocParts[2]\n    || (parts[3] || (parts[1] === \"http:\" ? 80 : 443)) != (ajaxLocParts[3] || (ajaxLocParts[1] === \"http:\" ? 80 : 443))\n    )\n  )\n\n  //console.debug('is_crossDomain('+url+') -> ' + result)\n  return result\n}\n\n// MIT License from http://phpjs.org/functions/base64_encode:358\nfunction b64_enc (data) {\n    // Encodes string using MIME base64 algorithm\n    var b64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n    var o1, o2, o3, h1, h2, h3, h4, bits, i = 0, ac = 0, enc=\"\", tmp_arr = [];\n\n    if (!data) {\n        return data;\n    }\n\n    // assume utf8 data\n    // data = this.utf8_encode(data+'');\n\n    do { // pack three octets into four hexets\n        o1 = data.charCodeAt(i++);\n        o2 = data.charCodeAt(i++);\n        o3 = data.charCodeAt(i++);\n\n        bits = o1<<16 | o2<<8 | o3;\n\n        h1 = bits>>18 & 0x3f;\n        h2 = bits>>12 & 0x3f;\n        h3 = bits>>6 & 0x3f;\n        h4 = bits & 0x3f;\n\n        // use hexets to index into b64, and append result to encoded string\n        tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\n    } while (i < data.length);\n\n    enc = tmp_arr.join('');\n\n    switch (data.length % 3) {\n        case 1:\n            enc = enc.slice(0, -2) + '==';\n        break;\n        case 2:\n            enc = enc.slice(0, -1) + '=';\n        break;\n    }\n\n    return enc;\n}\nmodule.exports = request;","var BaseView, ViewCollection,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('lib/base_view');\n\nmodule.exports = ViewCollection = (function(_super) {\n  __extends(ViewCollection, _super);\n\n  function ViewCollection() {\n    this.removeItem = __bind(this.removeItem, this);\n    this.addItem = __bind(this.addItem, this);\n    return ViewCollection.__super__.constructor.apply(this, arguments);\n  }\n\n  ViewCollection.prototype.itemview = null;\n\n  ViewCollection.prototype.views = {};\n\n  ViewCollection.prototype.template = function() {\n    return '';\n  };\n\n  ViewCollection.prototype.itemViewOptions = function() {};\n\n  ViewCollection.prototype.collectionEl = null;\n\n  ViewCollection.prototype.onChange = function() {\n    return this.$el.toggleClass('empty', _.size(this.views) === 0);\n  };\n\n  ViewCollection.prototype.appendView = function(view) {\n    var idx, modelAfter, viewAfter;\n    idx = this.collection.indexOf(view.model);\n    modelAfter = this.collection.at(idx + 1);\n    if (!modelAfter) {\n      return this.$collectionEl.append(view.el);\n    }\n    viewAfter = this.views[modelAfter.cid];\n    if (viewAfter) {\n      return viewAfter.$el.before(view.el);\n    } else {\n      return this.$collectionEl.append(view.el);\n    }\n  };\n\n  ViewCollection.prototype.initialize = function() {\n    ViewCollection.__super__.initialize.apply(this, arguments);\n    this.views = {};\n    this.listenTo(this.collection, \"reset\", this.onReset);\n    this.listenTo(this.collection, \"add\", this.addItem);\n    this.listenTo(this.collection, \"remove\", this.removeItem);\n    if (this.collectionEl == null) {\n      this.collectionEl = this.el;\n      return this.$collectionEl = this.$el;\n    }\n  };\n\n  ViewCollection.prototype.render = function() {\n    var id, view, _ref;\n    _ref = this.views;\n    for (id in _ref) {\n      view = _ref[id];\n      view.$el.detach();\n    }\n    return ViewCollection.__super__.render.apply(this, arguments);\n  };\n\n  ViewCollection.prototype.afterRender = function() {\n    var id, view, _ref;\n    if (!this.$collectionEl) {\n      this.$collectionEl = this.$(this.collectionEl);\n    }\n    _ref = this.views;\n    for (id in _ref) {\n      view = _ref[id];\n      this.appendView(view);\n    }\n    this.onReset(this.collection);\n    return this.onChange(this.views);\n  };\n\n  ViewCollection.prototype.remove = function() {\n    this.onReset([]);\n    return ViewCollection.__super__.remove.apply(this, arguments);\n  };\n\n  ViewCollection.prototype.onReset = function(newcollection) {\n    var id, view, _ref;\n    _ref = this.views;\n    for (id in _ref) {\n      view = _ref[id];\n      view.remove();\n    }\n    return newcollection.forEach(this.addItem);\n  };\n\n  ViewCollection.prototype.addItem = function(model) {\n    var options, view;\n    options = _.extend({}, {\n      model: model\n    }, this.itemViewOptions(model));\n    view = new this.itemview(options);\n    this.views[model.cid] = view.render();\n    this.appendView(view);\n    return this.onChange(this.views);\n  };\n\n  ViewCollection.prototype.removeItem = function(model) {\n    this.views[model.cid].remove();\n    delete this.views[model.cid];\n    return this.onChange(this.views);\n  };\n\n  return ViewCollection;\n\n})(BaseView);\n","module.exports = {\n  \"app name\": \"Cozy mobile\",\n  \"cozy url\": \"Cozy's domain\",\n  \"cozy password\": \"Cozy's password\",\n  \"name device\": \"Name this device\",\n  \"device name\": \"Device name\",\n  \"search\": \"search\",\n  \"config\": \"Config\",\n  \"never\": \"Never\",\n  \"phone2cozy title\": \"Phone to Cozy backup\",\n  \"contacts sync label\": \"Backup contacts\",\n  \"images sync label\": \"Backup images\",\n  \"wifi sync label\": \"Backup on Wifi only\",\n  \"home\": \"Home\",\n  \"about\": \"About\",\n  \"last sync\": \"Last sync was : \",\n  \"last backup\": \"Last was : \",\n  \"reset title\": \"Reset\",\n  \"reset action\": \"Reset\",\n  \"retry synchro\": \"Sync\",\n  \"synchro warning\": \"This start a replication from the beginning. It can take a long time.\",\n  \"reset warning\": \"This will erase all cozy-generated data on your phone.\",\n  \"pull to sync\": \"Pull to sync\",\n  \"syncing\": \"Syncing\",\n  \"contacts_scan\": \"Scanning contacts for changes\",\n  \"contacts_sync\": \"Syncing contacts\",\n  \"pictures_sync\": \"Syncing pictures\",\n  \"synchronized with\": \"Synchronized with \",\n  \"this folder is empty\": \"This folder is empty.\",\n  \"no results\": \"No results\",\n  \"loading\": \"Loading\",\n  \"remove local\": \"Remove local\",\n  \"download\": \"Download\",\n  \"sync\": \"Refresh\",\n  \"backup\": \"Backup\",\n  \"save\": \"Save\",\n  \"done\": \"Done\",\n  \"confirm message\": \"Are you sure?\",\n  \"replication complete\": \"Replication complete\",\n  \"no activity found\": \"No application on phone for this kind of file.\",\n  \"not enough space\": \"Not enough disk space, remove some files from cache.\",\n  \"no battery\": \"Not enough battery, Backup cancelled.\",\n  \"no wifi\": \"No Wifi, Backup cancelled.\",\n  \"next\": \"Next\",\n  \"back\": \"Back\",\n  \"connection failure\": \"Connection failure\",\n  \"setup 1/3\": \"Setup 1/3\",\n  \"password placeholder\": \"your password\",\n  \"authenticating...\": \"Authenticating...\",\n  \"setup 2/3\": \"Setup 2/3\",\n  \"device name explanation\": \"Choose a display name for this device so you can easily manage it from your Cozy.\",\n  \"device name placeholder\": \"my-phone\",\n  \"registering...\": \"Registering...\",\n  \"setup 3/3\": \"Setup 3/3\",\n  \"setup end\": \"End of setting\",\n  \"message step 0\": \"Step 1/3: Files synchronization.\",\n  \"message step 1\": \"Step 2/3: Folders synchronization.\",\n  \"message step 2\": \"Step 3/3: Documents preparation.\",\n  \"wait message device\": \"Device configuration...\",\n  \"ready message\": \"The application is ready to be used!\",\n  \"waiting...\": \"Waiting...\",\n  \"filesystem bug error\": \"File system bug error. Try to restart your phone.\",\n  \"end\": \"End\"\n};\n","module.exports = {\n  \"app name\": \"Cozy mobile\",\n  \"cozy url\": \"Adresse Cozy\",\n  \"cozy password\": \"Mot de passe\",\n  \"device name\": \"Nom de l'appareil\",\n  \"name device\": \"Nom de l'appareil\",\n  \"search\": \"Recherche\",\n  \"config\": \"Configuration\",\n  \"never\": \"Jamais\",\n  \"phone2cozy title\": \"Sauvegarde du téléphone\",\n  \"contacts sync label\": \"Sauvegarde des contacts\",\n  \"images sync label\": \"Sauvegarde des images du téléphone\",\n  \"wifi sync label\": \"Sauvegarde uniquement en Wifi\",\n  \"home\": \"Accueil\",\n  \"about\": \"À propos\",\n  \"last sync\": \"Dernière synchro : \",\n  \"last backup\": \"Derniere sauvegarde : \",\n  \"reset title\": \"Remise à zéro\",\n  \"reset action\": \"R.à.Z\",\n  \"retry synchro\": \"Sync\",\n  \"synchro warning\": \"Cela relancera une synchronisation depuis le début. Cela peut prendre du temps.\",\n  \"reset warning\": \"Cela supprimera toutes les données cozy sur votre mobile (dont votre device).\",\n  \"pull to sync\": \"Tirer pour synchroniser\",\n  \"syncing\": \"En cours de synchronisation\",\n  \"contacts_scan\": \"Extraction des contacts\",\n  \"contacts_sync\": \"Synchronisation des contacts\",\n  \"pictures_sync\": \"Synchronisation des images\",\n  \"synchronized with\": \"Synchronisé avec \",\n  \"this folder is empty\": \"Ce dossier est vide.\",\n  \"no results\": \"Pas de résultats\",\n  \"loading\": \"Chargement\",\n  \"remove local\": \"Supprimer du tél.\",\n  \"download\": \"Télécharger\",\n  \"sync\": \"Rafraîchir\",\n  \"backup\": \"Sauvegarder\",\n  \"save\": \"Sauvegarder\",\n  \"done\": \"Fait\",\n  \"confirm message\": \"Êtes-vous sûr ?\",\n  \"replication complete\": \"Réplication complétée\",\n  \"no activity found\": \"Aucune application n'a été trouvé sur ce téléphone pour ce type de fichier.\",\n  \"not enough space\": \"Il n'y a pas suffisament d'espace disque sur votre mobile.\",\n  \"no battery\": \"La sauvegarde n'aura pas lieu car vous n'avez pas assez de batterie.\",\n  \"no wifi\": \"La sauvegarde n'aura pas lieu car vous n'êtes pas en wifi.\",\n  \"next\": \"Suivant\",\n  \"back\": \"Retour\",\n  \"connection failure\": \"Echec de la connexion\",\n  \"setup 1/3\": \"Configuration 1/3\",\n  \"password placeholder\": \"votre mot de passe\",\n  \"authenticating...\": \"Vérification des identifiants...\",\n  \"setup 2/3\": \"Configuration 2/3\",\n  \"device name explanation\": \"Choisissez un nom d'usage pour ce périphérique pour pouvoir le gérer facilement depuis votre Cozy.\",\n  \"device name placeholder\": \"mon-telephone\",\n  \"registering...\": \"Enregistrement...\",\n  \"setup 3/3\": \"Configuration 3/3\",\n  \"setup end\": \"Fin de la configuration\",\n  \"wait message device\": \"Enregistrement du device...\",\n  \"message step 0\": \"Etape 1/3 : Synchronisation des fichiers.\",\n  \"message step 1\": \"Etape 2/3 : Synchronisation des dossiers.\",\n  \"message step 2\": \"Etape 3/3 : Préparation des documents.\",\n  \"ready message\": \"L'application est prête à être utilisée !\",\n  \"waiting...\": \"En attente...\",\n  \"filesystem bug error\": \"Erreur dans le système de fichier. Essayez de redémarrer votre téléphone\",\n  \"end\": \"Fin\"\n};\n","var File,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nmodule.exports = File = (function(_super) {\n  __extends(File, _super);\n\n  function File() {\n    return File.__super__.constructor.apply(this, arguments);\n  }\n\n  File.prototype.idAttribute = \"_id\";\n\n  File.prototype.defaults = function() {\n    return {\n      incache: 'loading',\n      version: false\n    };\n  };\n\n  File.prototype.initialize = function() {\n    return this.isDeviceFolder = this.isFolder() && this.wholePath() === app.replicator.config.get('deviceName');\n  };\n\n  File.prototype.isFolder = function() {\n    var _ref;\n    return ((_ref = this.get('docType')) != null ? _ref.toLowerCase() : void 0) === 'folder';\n  };\n\n  File.prototype.wholePath = function() {\n    var name, path;\n    name = this.get('name');\n    if (path = this.get('path')) {\n      return \"\" + (path.slice(1)) + \"/\" + name;\n    } else {\n      return name;\n    }\n  };\n\n  return File;\n\n})(Backbone.Model);\n","var DOWNLOADS_FOLDER, basic, fs, getFileSystem, readable, __chromeSafe;\n\nDOWNLOADS_FOLDER = 'cozy-downloads';\n\nbasic = require('../lib/basic');\n\nmodule.exports = fs = {};\n\ngetFileSystem = function(callback) {\n  var onError, onSuccess;\n  onSuccess = function(fs) {\n    return callback(null, fs);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  if (window.isBrowserDebugging) {\n    __chromeSafe();\n  }\n  return window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onSuccess, onError);\n};\n\nreadable = function(err) {\n  var code, name;\n  for (name in FileError) {\n    code = FileError[name];\n    if (code === err.code) {\n      return new Error(name.replace('_ERR', '').replace('_', ' '));\n    }\n  }\n  return new Error(JSON.stringify(err));\n};\n\nmodule.exports.initialize = function(callback) {\n  return getFileSystem((function(_this) {\n    return function(err, filesystem) {\n      if (err) {\n        return callback(readable(err));\n      }\n      window.FileTransfer.fs = filesystem;\n      return fs.getOrCreateSubFolder(filesystem.root, DOWNLOADS_FOLDER, function(err, downloads) {\n        if (err) {\n          return callback(readable(err));\n        }\n        downloads.getFile('.nomedia', {\n          create: true,\n          exclusive: false\n        }, function() {\n          return console.log(\"NOMEDIA FILE CREATED\");\n        }, function() {\n          return console.log(\"NOMEDIA FILE NOT CREATED\");\n        });\n        return fs.getChildren(downloads, function(err, children) {\n          if (err) {\n            return callback(readable(err));\n          }\n          return callback(null, downloads, children);\n        });\n      });\n    };\n  })(this));\n};\n\nmodule.exports[\"delete\"] = function(entry, callback) {\n  var onError, onSuccess;\n  onSuccess = function() {\n    return callback(null);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return entry.remove(onSuccess, onError);\n};\n\nmodule.exports.getFile = function(parent, name, callback) {\n  var onError, onSuccess;\n  onSuccess = function(entry) {\n    return callback(null, entry);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return parent.getFile(name, null, onSuccess, onError);\n};\n\nmodule.exports.getDirectory = function(parent, name, callback) {\n  var onError, onSuccess;\n  onSuccess = function(entry) {\n    return callback(null, entry);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return parent.getDirectory(name, {}, onSuccess, onError);\n};\n\nmodule.exports.getOrCreateSubFolder = function(parent, name, callback) {\n  var onError, onSuccess;\n  onSuccess = function(entry) {\n    return callback(null, entry);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return parent.getDirectory(name, {\n    create: true\n  }, onSuccess, function(err) {\n    if (err.code !== FileError.PATH_EXISTS_ERR) {\n      return callback(err);\n    }\n    return parent.getDirectory(name, {}, onSuccess, function(err) {\n      if (err.code !== FileError.NOT_FOUND_ERR) {\n        return callback(err);\n      }\n      return callback(new Error(t('filesystem bug error')));\n    });\n  });\n};\n\nmodule.exports.getChildren = function(directory, callback) {\n  var onError, onSuccess, reader;\n  reader = directory.createReader();\n  onSuccess = function(entries) {\n    return callback(null, entries);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return reader.readEntries(onSuccess, onError);\n};\n\nmodule.exports.rmrf = function(directory, callback) {\n  var onError, onSuccess;\n  onError = function(err) {\n    return callback(err);\n  };\n  onSuccess = function() {\n    return callback(null);\n  };\n  return directory.removeRecursively(onSuccess, onError);\n};\n\nmodule.exports.freeSpace = function(callback) {\n  var onError, onSuccess;\n  onError = function(err) {\n    return callback(err);\n  };\n  onSuccess = function() {\n    return callback(null);\n  };\n  return cordova.exec(onSuccess, onError, 'File', 'getFreeDiskSpace', []);\n};\n\nmodule.exports.entryFromPath = function(path, callback) {\n  var onError, onSuccess;\n  onSuccess = function(entry) {\n    return callback(null, entry);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return resolveLocalFileSystemURL('file://' + path, onSuccess, onError);\n};\n\nmodule.exports.fileFromEntry = function(entry, callback) {\n  var onError, onSuccess;\n  onSuccess = function(file) {\n    return callback(null, file);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return entry.file(onSuccess, onError);\n};\n\nmodule.exports.contentFromFile = function(file, callback) {\n  var reader;\n  reader = new FileReader();\n  reader.onerror = callback;\n  reader.onload = function() {\n    return callback(null, reader.result);\n  };\n  return reader.readAsArrayBuffer(file);\n};\n\nmodule.exports.getFileFromPath = function(path, callback) {\n  return fs.entryFromPath(path, function(err, entry) {\n    if (err) {\n      return callback(err);\n    }\n    return fs.fileFromEntry(entry, callback);\n  });\n};\n\nmodule.exports.metadataFromEntry = function(entry, callback) {\n  var onError, onSuccess;\n  onSuccess = function(file) {\n    return callback(null, file);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return entry.getMetadata(onSuccess, onError);\n};\n\nmodule.exports.download = function(options, progressback, callback) {\n  var auth, errors, ft, headers, onError, onSuccess, path, url;\n  errors = ['An error happened (UNKNOWN)', 'An error happened (NOT FOUND)', 'An error happened (INVALID URL)', 'This file isnt available offline', 'ABORTED'];\n  options = (url = options.url, path = options.path, auth = options.auth, options);\n  url = encodeURI(url);\n  onSuccess = function(entry) {\n    return callback(null, entry);\n  };\n  onError = function(err) {\n    return callback(new Error(errors[err.code]));\n  };\n  ft = new FileTransfer();\n  ft.onprogress = function(e) {\n    if (e.lengthComputable) {\n      return progressback(e.loaded, e.total);\n    } else {\n      return progressback(3, 10);\n    }\n  };\n  headers = {\n    Authorization: basic(auth)\n  };\n  return ft.download(url, path, onSuccess, onError, true, {\n    headers: headers\n  });\n};\n\n__chromeSafe = function() {\n  var FileTransfer;\n  window.LocalFileSystem = {\n    PERSISTENT: window.PERSISTENT\n  };\n  window.requestFileSystem = function(type, size, onSuccess, onError) {\n    size = 5 * 1024 * 1024;\n    return navigator.webkitPersistentStorage.requestQuota(size, function(granted) {\n      return window.webkitRequestFileSystem(type, granted, onSuccess, onError);\n    }, onError);\n  };\n  window.ImagesBrowser = {\n    getImageList: function() {\n      return [];\n    }\n  };\n  return window.FileTransfer = FileTransfer = (function() {\n    function FileTransfer() {}\n\n    FileTransfer.prototype.download = function(url, local, onSuccess, onError, _, options) {\n      var key, value, xhr, _ref;\n      xhr = new XMLHttpRequest();\n      xhr.open('GET', url, true);\n      xhr.overrideMimeType('text/plain; charset=x-user-defined');\n      xhr.responseType = \"arraybuffer\";\n      _ref = options.headers;\n      for (key in _ref) {\n        value = _ref[key];\n        xhr.setRequestHeader(key, value);\n      }\n      xhr.onreadystatechange = function() {\n        if (xhr.readyState !== 4) {\n          return;\n        }\n        return FileTransfer.fs.root.getFile(local, {\n          create: true\n        }, function(entry) {\n          return entry.createWriter(function(writer) {\n            var bb;\n            writer.onwrite = function() {\n              return onSuccess(entry);\n            };\n            writer.onerror = function(err) {\n              return onError(err);\n            };\n            bb = new BlobBuilder();\n            bb.append(xhr.response);\n            return writer.write(bb.getBlob(mimetype));\n          }, function(err) {\n            return onError(err);\n          });\n        }, function(err) {\n          return onError(err);\n        });\n      };\n      return xhr.send(null);\n    };\n\n    return FileTransfer;\n\n  })();\n};\n","var DBCONTACTS, DBNAME, DBOPTIONS, DBPHOTOS, Replicator, ReplicatorConfig, fs, makeDesignDocs, request,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\nrequest = require('../lib/request');\n\nfs = require('./filesystem');\n\nmakeDesignDocs = require('./replicator_mapreduce');\n\nReplicatorConfig = require('./replicator_config');\n\nDBNAME = \"cozy-files.db\";\n\nDBCONTACTS = \"cozy-contacts.db\";\n\nDBPHOTOS = \"cozy-photos.db\";\n\nDBOPTIONS = window.isBrowserDebugging ? {} : {\n  adapter: 'websql'\n};\n\nmodule.exports = Replicator = (function(_super) {\n  var realtimeBackupCoef;\n\n  __extends(Replicator, _super);\n\n  function Replicator() {\n    this.startRealtime = __bind(this.startRealtime, this);\n    this.folderInFileSystem = __bind(this.folderInFileSystem, this);\n    this.fileVersion = __bind(this.fileVersion, this);\n    this.fileInFileSystem = __bind(this.fileInFileSystem, this);\n    return Replicator.__super__.constructor.apply(this, arguments);\n  }\n\n  Replicator.prototype.db = null;\n\n  Replicator.prototype.config = null;\n\n  _.extend(Replicator.prototype, require('./replicator_backups'));\n\n  Replicator.prototype.defaults = function() {\n    return {\n      inSync: false,\n      inBackup: false\n    };\n  };\n\n  Replicator.prototype.destroyDB = function(callback) {\n    return this.db.destroy((function(_this) {\n      return function(err) {\n        if (err) {\n          return callback(err);\n        }\n        return _this.contactsDB.destroy(function(err) {\n          if (err) {\n            return callback(err);\n          }\n          return _this.photosDB.destroy(function(err) {\n            if (err) {\n              return callback(err);\n            }\n            return fs.rmrf(_this.downloads, callback);\n          });\n        });\n      };\n    })(this));\n  };\n\n  Replicator.prototype.resetSynchro = function(callback) {\n    return this.initialReplication(callback);\n  };\n\n  Replicator.prototype.init = function(callback) {\n    return fs.initialize((function(_this) {\n      return function(err, downloads, cache) {\n        if (err) {\n          return callback(err);\n        }\n        _this.downloads = downloads;\n        _this.cache = cache;\n        _this.db = new PouchDB(DBNAME, DBOPTIONS);\n        _this.contactsDB = new PouchDB(DBCONTACTS, DBOPTIONS);\n        _this.photosDB = new PouchDB(DBPHOTOS, DBOPTIONS);\n        return makeDesignDocs(_this.db, _this.contactsDB, _this.photosDB, function(err) {\n          if (err) {\n            return callback(err);\n          }\n          _this.config = new ReplicatorConfig(_this);\n          return _this.config.fetch(callback);\n        });\n      };\n    })(this));\n  };\n\n  Replicator.prototype.getDbFilesOfFolder = function(folder, callback) {\n    var options, path;\n    path = folder.path + '/' + folder.name;\n    options = {\n      include_docs: true,\n      startkey: path,\n      endkey: path + '\\uffff'\n    };\n    return this.db.query('FilesAndFolder', options, function(err, results) {\n      var docs, files;\n      if (err) {\n        return callback(err);\n      }\n      docs = results.rows.map(function(row) {\n        return row.doc;\n      });\n      files = docs.filter(function(doc) {\n        var _ref;\n        return ((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'file';\n      });\n      return callback(null, files);\n    });\n  };\n\n  Replicator.prototype.registerRemote = function(config, callback) {\n    return request.post({\n      uri: \"https://\" + config.cozyURL + \"/device/\",\n      auth: {\n        username: 'owner',\n        password: config.password\n      },\n      json: {\n        login: config.deviceName,\n        type: 'mobile'\n      }\n    }, (function(_this) {\n      return function(err, response, body) {\n        if (err) {\n          return callback(err);\n        } else if (response.statusCode === 401 && response.reason) {\n          return callback(new Error('cozy need patch'));\n        } else if (response.statusCode === 401) {\n          return callback(new Error('wrong password'));\n        } else if (response.statusCode === 400) {\n          return callback(new Error('device name already exist'));\n        } else {\n          _.extend(config, {\n            password: body.password,\n            deviceId: body.id,\n            auth: {\n              username: config.deviceName,\n              password: body.password\n            },\n            fullRemoteURL: (\"https://\" + config.deviceName + \":\" + body.password) + (\"@\" + config.cozyURL + \"/cozy\")\n          });\n          return _this.config.save(config, callback);\n        }\n      };\n    })(this));\n  };\n\n  Replicator.prototype.checkCredentials = function(config, callback) {\n    return request.post({\n      uri: \"https://\" + config.cozyURL + \"/login\",\n      json: {\n        username: 'owner',\n        password: config.password\n      }\n    }, function(err, response, body) {\n      var error;\n      if ((response != null ? response.statusCode : void 0) !== 200) {\n        error = (err != null ? err.message : void 0) || body.error || body.message;\n      } else {\n        error = null;\n      }\n      return callback(error);\n    });\n  };\n\n  Replicator.prototype.updateIndex = function(callback) {\n    return this.db.search({\n      build: true,\n      fields: ['name']\n    }, (function(_this) {\n      return function(err) {\n        console.log(\"INDEX BUILT\");\n        if (err) {\n          console.log(err);\n        }\n        return _this.db.query('FilesAndFolder', {}, function() {\n          return _this.db.query('LocalPath', {}, function() {\n            return callback(null);\n          });\n        });\n      };\n    })(this));\n  };\n\n  Replicator.prototype.initialReplication = function(callback) {\n    var options;\n    console.log(\"initialReplication\");\n    this.set('initialReplicationStep', 0);\n    options = this.config.makeUrl('/_changes?descending=true&limit=1');\n    return request.get(options, (function(_this) {\n      return function(err, res, body) {\n        var last_seq;\n        if (err) {\n          return callback(err);\n        }\n        last_seq = body.last_seq;\n        return async.series([\n          function(cb) {\n            return _this.copyView('file', cb);\n          }, function(cb) {\n            return _this.set('initialReplicationStep', 1) && cb(null);\n          }, function(cb) {\n            return _this.copyView('folder', cb);\n          }, function(cb) {\n            return _this.set('initialReplicationStep', 2) && cb(null);\n          }, function(cb) {\n            return _this.config.save({\n              checkpointed: last_seq\n            }, cb);\n          }, function(cb) {\n            return _this.db.query('FilesAndFolder', {}, cb);\n          }\n        ], function(err) {\n          console.log(\"end of inital replication \" + (Date.now()));\n          _this.set('initialReplicationStep', 3);\n          callback(err);\n          return _this.updateIndex(function() {\n            return console.log(\"Index built\");\n          });\n        });\n      };\n    })(this));\n  };\n\n  Replicator.prototype.copyView = function(model, callback) {\n    var options;\n    console.log(\"copyView \" + (Date.now()));\n    options = this.config.makeUrl(\"/_design/\" + model + \"/_view/all/\");\n    return request.get(options, (function(_this) {\n      return function(err, res, body) {\n        var _ref;\n        if (err) {\n          return callback(err);\n        }\n        if (!((_ref = body.rows) != null ? _ref.length : void 0)) {\n          return callback(null);\n        }\n        return async.eachSeries(body.rows, function(doc, cb) {\n          doc = doc.value;\n          return _this.db.put(doc, {\n            'new_edits': false\n          }, function(err, file) {\n            return cb();\n          });\n        }, callback);\n      };\n    })(this));\n  };\n\n  Replicator.prototype.fileInFileSystem = function(file) {\n    return this.cache.some(function(entry) {\n      return entry.name.indexOf(file.binary.file.id) !== -1;\n    });\n  };\n\n  Replicator.prototype.fileVersion = function(file) {\n    return this.cache.some(function(entry) {\n      return entry.name === file.binary.file.id + '-' + file.binary.file.rev;\n    });\n  };\n\n  Replicator.prototype.folderInFileSystem = function(path, callback) {\n    var fsCacheFolder, options;\n    options = {\n      startkey: path,\n      endkey: path + '\\uffff'\n    };\n    fsCacheFolder = this.cache.map(function(entry) {\n      return entry.name;\n    });\n    return this.db.query('PathToBinary', options, function(err, results) {\n      if (err) {\n        return callback(err);\n      }\n      if (results.rows.length === 0) {\n        return callback(null, null);\n      }\n      return callback(null, _.every(results.rows, function(row) {\n        var _ref;\n        return _ref = row.value, __indexOf.call(fsCacheFolder, _ref) >= 0;\n      }));\n    });\n  };\n\n  Replicator.prototype.getBinary = function(model, progressback, callback) {\n    var binary_id, binary_rev;\n    binary_id = model.binary.file.id;\n    binary_rev = model.binary.file.rev;\n    return fs.getOrCreateSubFolder(this.downloads, binary_id + '-' + binary_rev, (function(_this) {\n      return function(err, binfolder) {\n        if (err && err.code !== FileError.PATH_EXISTS_ERR) {\n          return callback(err);\n        }\n        if (!model.name) {\n          return callback(new Error('no model name :' + JSON.stringify(model)));\n        }\n        return fs.getFile(binfolder, model.name, function(err, entry) {\n          var options;\n          if (entry) {\n            return callback(null, entry.toURL());\n          }\n          options = _this.config.makeUrl(\"/\" + binary_id + \"/file\");\n          options.path = binfolder.toURL() + '/' + model.name;\n          return fs.download(options, progressback, function(err, entry) {\n            var found;\n            if (((err != null ? err.message : void 0) != null) && err.message === \"This file isnt available offline\" && _this.fileInFileSystem(model)) {\n              found = false;\n              _this.cache.some(function(entry) {\n                if (entry.name.indexOf(binary_id) !== -1) {\n                  found = true;\n                  console.log(entry);\n                  console.log(entry.toURL());\n                  return callback(null, entry.toURL() + '/' + model.name);\n                }\n              });\n              if (!found) {\n                return callback(err);\n              }\n            } else if (err) {\n              return fs[\"delete\"](binfolder, function(delerr) {\n                return callback(err);\n              });\n            } else {\n              _this.cache.push(binfolder);\n              console.log(entry.toURL());\n              callback(null, entry.toURL());\n              return _this.removeAllLocal(binary_id, binary_rev);\n            }\n          });\n        });\n      };\n    })(this));\n  };\n\n  Replicator.prototype.getBinaryFolder = function(folder, progressback, callback) {\n    return this.getDbFilesOfFolder(folder, (function(_this) {\n      return function(err, files) {\n        var totalSize;\n        if (err) {\n          return callback(err);\n        }\n        totalSize = files.reduce((function(sum, file) {\n          return sum + file.size;\n        }), 0);\n        return fs.freeSpace(function(err, available) {\n          var progressHandlers, reportProgress;\n          if (err) {\n            return callback(err);\n          }\n          if (totalSize > available * 1024) {\n            alert(t('not enough space'));\n            return callback(null);\n          } else {\n            progressHandlers = {};\n            reportProgress = function(id, done, total) {\n              var key, status;\n              progressHandlers[id] = [done, total];\n              total = done = 0;\n              for (key in progressHandlers) {\n                status = progressHandlers[key];\n                done += status[0];\n                total += status[1];\n              }\n              return progressback(done, total);\n            };\n            return async.eachLimit(files, 5, function(file, cb) {\n              var pb;\n              console.log(\"DOWNLOAD \" + file.name);\n              pb = reportProgress.bind(null, file._id);\n              return _this.getBinary(file, pb, cb);\n            }, callback);\n          }\n        });\n      };\n    })(this));\n  };\n\n  Replicator.prototype.removeAllLocal = function(id, rev) {\n    return this.cache.some((function(_this) {\n      return function(entry) {\n        if (entry.name.indexOf(id) !== -1 && entry.name !== id + '-' + rev) {\n          return fs.getDirectory(_this.downloads, entry.name, function(err, binfolder) {\n            if (err) {\n              return callback(err);\n            }\n            return fs.rmrf(binfolder, function(err) {\n              var currentEntry, index, _i, _len, _ref, _results;\n              _ref = _this.cache;\n              _results = [];\n              for (index = _i = 0, _len = _ref.length; _i < _len; index = ++_i) {\n                currentEntry = _ref[index];\n                if (!(currentEntry.name === entry.name)) {\n                  continue;\n                }\n                _this.cache.splice(index, 1);\n                break;\n              }\n              return _results;\n            });\n          });\n        }\n      };\n    })(this));\n  };\n\n  Replicator.prototype.removeLocal = function(model, callback) {\n    var binary_id, binary_rev;\n    binary_id = model.binary.file.id;\n    binary_rev = model.binary.file.rev;\n    console.log(\"REMOVE LOCAL\");\n    console.log(binary_id);\n    return fs.getDirectory(this.downloads, binary_id + '-' + binary_rev, (function(_this) {\n      return function(err, binfolder) {\n        if (err) {\n          return callback(err);\n        }\n        return fs.rmrf(binfolder, function(err) {\n          var entry, index, _i, _len, _ref;\n          _ref = _this.cache;\n          for (index = _i = 0, _len = _ref.length; _i < _len; index = ++_i) {\n            entry = _ref[index];\n            if (!(entry.name === binary_id + '-' + binary_rev)) {\n              continue;\n            }\n            _this.cache.splice(index, 1);\n            break;\n          }\n          return callback(null);\n        });\n      };\n    })(this));\n  };\n\n  Replicator.prototype.removeLocalFolder = function(folder, callback) {\n    return this.getDbFilesOfFolder(folder, (function(_this) {\n      return function(err, files) {\n        if (err) {\n          return callback(err);\n        }\n        return async.eachSeries(files, function(file, cb) {\n          return _this.removeLocal(file, cb);\n        }, callback);\n      };\n    })(this));\n  };\n\n  Replicator.prototype.sync = function(callback) {\n    if (this.get('inSync')) {\n      return callback(null);\n    }\n    console.log(\"SYNC CALLED\");\n    this.set('inSync', true);\n    return this._sync({}, (function(_this) {\n      return function(err) {\n        _this.set('inSync', false);\n        return callback(err);\n      };\n    })(this));\n  };\n\n  Replicator.prototype._sync = function(options, callback) {\n    var checkpoint, replication, total_count, _ref;\n    console.log(\"BEGIN SYNC\");\n    total_count = 0;\n    if ((_ref = this.liveReplication) != null) {\n      _ref.cancel();\n    }\n    checkpoint = options.checkpoint || this.config.get('checkpointed');\n    replication = this.db.replicate.from(this.config.remote, {\n      batch_size: 20,\n      batches_limit: 5,\n      filter: function(doc) {\n        return doc.docType === 'Folder' || doc.docType === 'File';\n      },\n      live: false,\n      since: checkpoint\n    });\n    replication.on('change', function(change) {\n      return console.log(\"REPLICATION CHANGE : \" + change);\n    });\n    replication.once('error', (function(_this) {\n      return function(err) {\n        var _ref1;\n        console.log(\"REPLICATOR ERRROR \" + (JSON.stringify(err)) + \" \" + err.stack);\n        if (((err != null ? (_ref1 = err.result) != null ? _ref1.status : void 0 : void 0) != null) && err.result.status === 'aborted') {\n          if (replication != null) {\n            replication.cancel();\n          }\n          return _this._sync(options, callback);\n        }\n      };\n    })(this));\n    return replication.once('complete', (function(_this) {\n      return function(result) {\n        console.log(\"REPLICATION COMPLETED\");\n        return _this.config.save({\n          checkpointed: result.last_seq\n        }, function(err) {\n          callback(err);\n          app.router.forceRefresh();\n          return _this.updateIndex(function() {\n            console.log('start Realtime');\n            return _this.startRealtime();\n          });\n        });\n      };\n    })(this));\n  };\n\n  realtimeBackupCoef = 1;\n\n  Replicator.prototype.startRealtime = function() {\n    if (this.liveReplication) {\n      return;\n    }\n    console.log('REALTIME START');\n    this.liveReplication = this.db.replicate.from(this.config.remote, {\n      batch_size: 20,\n      batches_limit: 5,\n      filter: function(doc) {\n        return doc.docType === 'Folder' || doc.docType === 'File';\n      },\n      since: this.config.get('checkpointed'),\n      continuous: true\n    });\n    this.liveReplication.on('change', (function(_this) {\n      return function(e) {\n        realtimeBackupCoef = 1;\n        return _this.set('inSync', true);\n      };\n    })(this));\n    this.liveReplication.on('uptodate', (function(_this) {\n      return function(e) {\n        realtimeBackupCoef = 1;\n        _this.set('inSync', false);\n        app.router.forceRefresh();\n        return console.log(\"UPTODATE\", e);\n      };\n    })(this));\n    this.liveReplication.once('complete', (function(_this) {\n      return function(e) {\n        console.log(\"LIVE REPLICATION CANCELLED\");\n        _this.set('inSync', false);\n        _this.liveReplication = null;\n        return _this.startRealtime();\n      };\n    })(this));\n    return this.liveReplication.once('error', (function(_this) {\n      return function(e) {\n        var timeout;\n        _this.liveReplication = null;\n        if (realtimeBackupCoef < 6) {\n          realtimeBackupCoef++;\n        }\n        timeout = 1000 * (1 << realtimeBackupCoef);\n        console.log(\"REALTIME BROKE, TRY AGAIN IN \" + timeout + \" \" + (e.toString()));\n        return setTimeout(_this.startRealtime, timeout);\n      };\n    })(this));\n  };\n\n  return Replicator;\n\n})(Backbone.Model);\n","var DeviceStatus, fs,\n  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\nDeviceStatus = require('../lib/device_status');\n\nfs = require('./filesystem');\n\nmodule.exports = {\n  backup: function(callback) {\n    var _ref;\n    if (callback == null) {\n      callback = function() {};\n    }\n    if (this.get('inBackup')) {\n      return callback(null);\n    }\n    this.set('inBackup', true);\n    this.set('backup_step', null);\n    if ((_ref = this.liveReplication) != null) {\n      _ref.cancel();\n    }\n    return this._backup((function(_this) {\n      return function(err) {\n        _this.set('backup_step', null);\n        _this.set('inBackup', false);\n        _this.startRealtime();\n        if (err) {\n          return callback(err);\n        }\n        return _this.config.save({\n          lastBackup: new Date().toString()\n        }, function(err) {\n          return callback(null);\n        });\n      };\n    })(this));\n  },\n  _backup: function(callback) {\n    return DeviceStatus.checkReadyForSync((function(_this) {\n      return function(err, ready, msg) {\n        console.log(\"SYNC STATUS\", err, ready, msg);\n        if (err) {\n          return callback(err);\n        }\n        if (!ready) {\n          return callback(new Error(t(msg)));\n        }\n        console.log(\"WE ARE READY FOR SYNC\");\n        return _this.syncPictures(function(err) {\n          if (err) {\n            return callback(err);\n          }\n          return _this.syncContacts(function(err) {\n            return callback(err);\n          });\n        });\n      };\n    })(this));\n  },\n  syncContacts: function(callback) {\n    if (!this.config.get('syncContacts')) {\n      return callback(null);\n    }\n    console.log(\"SYNC CONTACTS\");\n    this.set('backup_step', 'contacts_scan');\n    this.set('backup_step_done', null);\n    return async.parallel([\n      ImagesBrowser.getContactsList, (function(_this) {\n        return function(cb) {\n          return _this.contactsDB.query('ContactsByLocalId', {}, cb);\n        };\n      })(this)\n    ], (function(_this) {\n      return function(err, result) {\n        var dbCache, dbContacts, phoneContacts, processed, _ref;\n        if (err) {\n          return callback(err);\n        }\n        phoneContacts = result[0], (_ref = result[1], dbContacts = _ref.rows);\n        console.log(\"BEGIN SYNC \" + dbContacts.length + \" \" + phoneContacts.length);\n        dbCache = {};\n        dbContacts.forEach(function(row) {\n          return dbCache[row.key] = {\n            id: row.id,\n            rev: row.value[1],\n            version: row.value[0]\n          };\n        });\n        processed = 0;\n        _this.set('backup_step_total', phoneContacts.length);\n        return async.eachSeries(phoneContacts, function(contact, cb) {\n          var inDb, log;\n          _this.set('backup_step_done', processed++);\n          contact.localId = contact.localId.toString();\n          contact.docType = 'Contact';\n          inDb = dbCache[contact.localId];\n          log = \"CONTACT : \" + contact.localId + \" \" + contact.localVersion;\n          log += \"DB \" + (inDb != null ? inDb.version : void 0) + \" : \";\n          if (contact.localVersion === (inDb != null ? inDb.version : void 0)) {\n            console.log(log + \"NOTHING TO DO\");\n            return cb(null);\n          } else if (inDb != null) {\n            console.log(log + \"UPDATING\");\n            return _this.contactsDB.put(contact, inDb.id, inDb.rev, cb);\n          } else {\n            console.log(log + \"CREATING\");\n            return _this.contactsDB.post(contact, function(err, doc) {\n              if (err) {\n                return callback(err);\n              }\n              if (!doc.ok) {\n                return callback(new Error('cant create'));\n              }\n              dbCache[contact.localId] = {\n                id: doc.id,\n                rev: doc.rev,\n                version: contact.localVersion\n              };\n              return cb(null);\n            });\n          }\n        }, function(err) {\n          var ids, replication;\n          if (err) {\n            return callback(err);\n          }\n          console.log(\"SYNC CONTACTS phone -> pouch DONE\");\n          ids = _.map(dbCache, function(doc) {\n            return doc.id;\n          });\n          _this.set('backup_step', 'contacts_sync');\n          _this.set('backup_step_total', ids.length);\n          replication = _this.contactsDB.replicate.to(_this.config.remote, {\n            since: 0,\n            doc_ids: ids\n          });\n          replication.on('error', callback);\n          replication.on('change', function(e) {\n            return _this.set('backup_step_done', e.last_seq);\n          });\n          return replication.on('complete', function() {\n            callback(null);\n            return _this.contactsDB.query('ContactsByLocalId', {}, function() {});\n          });\n        });\n      };\n    })(this));\n  },\n  syncPictures: function(callback) {\n    if (!this.config.get('syncImages')) {\n      return callback(null);\n    }\n    console.log(\"SYNC PICTURES\");\n    this.set('backup_step', 'pictures_scan');\n    this.set('backup_step_done', null);\n    return async.series([\n      this.ensureDeviceFolder.bind(this), ImagesBrowser.getImagesList, (function(_this) {\n        return function(cb) {\n          return _this.photosDB.query('PhotosByLocalId', {}, cb);\n        };\n      })(this)\n    ], (function(_this) {\n      return function(err, results) {\n        var dbImages, device, images, myDownloadFolder, toUpload, _ref;\n        if (err) {\n          return callback(err);\n        }\n        device = results[0], images = results[1], (_ref = results[2], dbImages = _ref.rows);\n        console.log(\"SYNC IMAGES : \" + images.length + \" \" + dbImages.length);\n        dbImages = dbImages.map(function(row) {\n          return row.key;\n        });\n        myDownloadFolder = _this.downloads.toURL().replace('file://', '');\n        toUpload = [];\n        return async.eachSeries(images, function(path, cb) {\n          if (__indexOf.call(dbImages, path) < 0) {\n            toUpload.push(path);\n          }\n          return setTimeout(cb, 1);\n        }, function() {\n          var processed;\n          processed = 0;\n          _this.set('backup_step', 'pictures_sync');\n          _this.set('backup_step_total', toUpload.length);\n          return async.eachSeries(toUpload, function(path, cb) {\n            _this.set('backup_step_done', processed++);\n            console.log(\"UPLOADING \" + path);\n            return _this.uploadPicture(path, device, function(err) {\n              if (err) {\n                console.log(\"ERROR \" + path + \" \" + err);\n              }\n              return setTimeout(cb, 1);\n            });\n          }, callback);\n        });\n      };\n    })(this));\n  },\n  uploadPicture: function(path, device, callback) {\n    return fs.getFileFromPath(path, (function(_this) {\n      return function(err, file) {\n        if (err) {\n          return callback(err);\n        }\n        return fs.contentFromFile(file, function(err, content) {\n          if (err) {\n            return callback(err);\n          }\n          return _this.createBinary(content, file.type, function(err, bin) {\n            if (err) {\n              return callback(err);\n            }\n            return _this.createFile(file, path, bin, device, function(err, res) {\n              if (err) {\n                return callback(err);\n              }\n              return _this.createPhoto(path, callback);\n            });\n          });\n        });\n      };\n    })(this));\n  },\n  createBinary: function(blob, mime, callback) {\n    return this.config.remote.post({\n      docType: 'Binary'\n    }, (function(_this) {\n      return function(err, doc) {\n        if (err) {\n          return callback(err);\n        }\n        if (!doc.ok) {\n          return callback(new Error('cant create binary'));\n        }\n        return _this.config.remote.putAttachment(doc.id, 'file', doc.rev, blob, mime, function(err, doc) {\n          if (err) {\n            return callback(err);\n          }\n          if (!doc.ok) {\n            return callback(new Error('cant attach'));\n          }\n          delete _this.config.remoteHostObject.headers['Content-Type'];\n          return callback(null, doc);\n        });\n      };\n    })(this));\n  },\n  createFile: function(cordovaFile, localPath, binaryDoc, device, callback) {\n    var dbFile;\n    dbFile = {\n      docType: 'File',\n      localPath: localPath,\n      name: cordovaFile.name,\n      path: device.path + '/' + device.name,\n      \"class\": this.fileClassFromMime(cordovaFile.type),\n      lastModification: new Date(cordovaFile.lastModified).toISOString(),\n      creationDate: new Date(cordovaFile.lastModified).toISOString(),\n      size: cordovaFile.size,\n      tags: ['uploaded-from-' + this.config.get('deviceName')],\n      binary: {\n        file: {\n          id: binaryDoc.id,\n          rev: binaryDoc.rev\n        }\n      }\n    };\n    return this.config.remote.post(dbFile, callback);\n  },\n  createPhoto: function(localPath, callback) {\n    var dbPhoto;\n    dbPhoto = {\n      docType: 'Photo',\n      localId: localPath\n    };\n    return this.photosDB.post(dbPhoto, callback);\n  },\n  fileClassFromMime: function(type) {\n    switch (type.split('/')[0]) {\n      case 'image':\n        return \"image\";\n      case 'audio':\n        return \"music\";\n      case 'video':\n        return \"video\";\n      case 'text':\n      case 'application':\n        return \"document\";\n      default:\n        return \"file\";\n    }\n  },\n  ensureDeviceFolder: function(callback) {\n    var createNew, findDevice;\n    findDevice = (function(_this) {\n      return function(id, callback) {\n        return _this.db.get(id, function(err, res) {\n          if (err == null) {\n            return callback();\n          } else {\n            return findDevice(id, callback);\n          }\n        });\n      };\n    })(this);\n    createNew = (function(_this) {\n      return function(number) {\n        var folder, options;\n        if (number == null) {\n          number = 0;\n        }\n        console.log(\"MAKING ONE\");\n        folder = {\n          docType: 'Folder',\n          name: _this.config.get('deviceName'),\n          path: '',\n          lastModification: new Date().toISOString(),\n          creationDate: new Date().toISOString(),\n          tags: []\n        };\n        if (number !== 0) {\n          folder.name = _this.config.get('deviceName') + '-' + number;\n        }\n        options = {\n          key: ['', \"1_\" + (folder.name.toLowerCase())]\n        };\n        return _this.db.query('FilesAndFolder', options, function(err, folders) {\n          if (folders.rows.length === 0) {\n            return _this.config.remote.post(folder, function(err, res) {\n              var dbDevice;\n              dbDevice = {\n                docType: 'Device',\n                localId: res.id\n              };\n              return _this.photosDB.post(dbDevice, function(err, res) {\n                app.replicator.startRealtime();\n                return findDevice(dbDevice.localId, function() {\n                  if (err) {\n                    return callback(err);\n                  }\n                  return callback(null, folder);\n                });\n              });\n            });\n          } else {\n            return createNew(number + 1);\n          }\n        });\n      };\n    })(this);\n    return this.photosDB.query('DevicesByLocalId', {}, (function(_this) {\n      return function(err, results) {\n        var device;\n        if (err) {\n          return callback(err);\n        }\n        if (results.rows.length > 0) {\n          device = results.rows[0];\n          return _this.db.get(device.key, function(err, res) {\n            if (err != null) {\n              createNew();\n              return this.photosDB.remove(device.value);\n            } else {\n              console.log(\"DEVICE FOLDER EXISTS\");\n              console.log(res);\n              return callback(null, res);\n            }\n          });\n        } else {\n          return createNew();\n        }\n      };\n    })(this));\n  }\n};\n","var ReplicatorConfig, basic,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nbasic = require('../lib/basic');\n\nmodule.exports = ReplicatorConfig = (function(_super) {\n  __extends(ReplicatorConfig, _super);\n\n  function ReplicatorConfig(replicator) {\n    this.replicator = replicator;\n    ReplicatorConfig.__super__.constructor.call(this, null);\n    this.remote = null;\n  }\n\n  ReplicatorConfig.prototype.defaults = function() {\n    return {\n      _id: 'localconfig',\n      syncContacts: app.locale === 'digidisk',\n      syncImages: true,\n      syncOnWifi: true,\n      cozyURL: '',\n      deviceName: ''\n    };\n  };\n\n  ReplicatorConfig.prototype.fetch = function(callback) {\n    return this.replicator.db.get('localconfig', (function(_this) {\n      return function(err, config) {\n        if (config) {\n          _this.set(config);\n          _this.remote = _this.createRemotePouchInstance();\n        }\n        return callback(null, _this);\n      };\n    })(this));\n  };\n\n  ReplicatorConfig.prototype.save = function(changes, callback) {\n    this.set(changes);\n    return this.replicator.db.put(this.toJSON(), (function(_this) {\n      return function(err, res) {\n        if (err) {\n          return callback(err);\n        }\n        if (!res.ok) {\n          return callback(new Error('cant save config'));\n        }\n        _this.set({\n          _rev: res.rev\n        });\n        _this.remote = _this.createRemotePouchInstance();\n        return typeof callback === \"function\" ? callback(null, _this) : void 0;\n      };\n    })(this));\n  };\n\n  ReplicatorConfig.prototype.makeUrl = function(path) {\n    return {\n      json: true,\n      auth: this.get('auth'),\n      url: 'https://' + this.get('cozyURL') + '/cozy' + path\n    };\n  };\n\n  ReplicatorConfig.prototype.makeFilterName = function() {\n    return this.get('deviceId') + '/filter';\n  };\n\n  ReplicatorConfig.prototype.createRemotePouchInstance = function() {\n    return new PouchDB({\n      name: this.get('fullRemoteURL'),\n      getHost: (function(_this) {\n        return function() {\n          return _this.remoteHostObject = {\n            remote: true,\n            protocol: 'https',\n            host: _this.get('cozyURL'),\n            port: 443,\n            path: '',\n            db: 'cozy',\n            headers: {\n              Authorization: basic(_this.get('auth'))\n            }\n          };\n        };\n      })(this)\n    });\n  };\n\n  return ReplicatorConfig;\n\n})(Backbone.Model);\n","var ContactsByLocalIdDesignDoc, DevicesByLocalIdDesignDoc, FilesAndFolderDesignDoc, LocalPathDesignDoc, PathToBinaryDesignDoc, PhotosByLocalIdDesignDoc, createOrUpdateDesign;\n\ncreateOrUpdateDesign = function(db, design, callback) {\n  return db.get(design._id, (function(_this) {\n    return function(err, existing) {\n      if ((existing != null ? existing.version : void 0) === design.version) {\n        return callback(null);\n      } else {\n        console.log(\"REDEFINING DESIGN \" + design._id + \" FROM \" + existing);\n        if (existing) {\n          design._rev = existing._rev;\n        }\n        return db.put(design, callback);\n      }\n    };\n  })(this));\n};\n\nPathToBinaryDesignDoc = {\n  _id: '_design/PathToBinary',\n  version: 1,\n  views: {\n    'PathToBinary': {\n      map: Object.toString.apply(function(doc) {\n        var _ref, _ref1, _ref2;\n        if (((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'file') {\n          return emit(doc.path + '/' + doc.name, (_ref1 = doc.binary) != null ? (_ref2 = _ref1.file) != null ? _ref2.id : void 0 : void 0);\n        }\n      })\n    }\n  }\n};\n\nFilesAndFolderDesignDoc = {\n  _id: '_design/FilesAndFolder',\n  version: 1,\n  views: {\n    'FilesAndFolder': {\n      map: Object.toString.apply(function(doc) {\n        var _ref, _ref1;\n        if (doc.name != null) {\n          if (((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'file') {\n            emit([doc.path, '2_' + doc.name.toLowerCase()]);\n          }\n          if (((_ref1 = doc.docType) != null ? _ref1.toLowerCase() : void 0) === 'folder') {\n            return emit([doc.path, '1_' + doc.name.toLowerCase()]);\n          }\n        }\n      })\n    }\n  }\n};\n\nLocalPathDesignDoc = {\n  _id: '_design/LocalPath',\n  version: 1,\n  views: {\n    'LocalPath': {\n      map: Object.toString.apply(function(doc) {\n        if (doc.localPath) {\n          return emit(doc.localPath);\n        }\n      })\n    }\n  }\n};\n\nContactsByLocalIdDesignDoc = {\n  _id: '_design/ContactsByLocalId',\n  version: 1,\n  views: {\n    'ContactsByLocalId': {\n      map: Object.toString.apply(function(doc) {\n        var _ref;\n        if (((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'contact' && doc.localId) {\n          return emit(doc.localId, [doc.localVersion, doc._rev]);\n        }\n      })\n    }\n  }\n};\n\nPhotosByLocalIdDesignDoc = {\n  _id: '_design/PhotosByLocalId',\n  version: 1,\n  views: {\n    'PhotosByLocalId': {\n      map: Object.toString.apply(function(doc) {\n        var _ref;\n        if (((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'photo') {\n          return emit(doc.localId);\n        }\n      })\n    }\n  }\n};\n\nDevicesByLocalIdDesignDoc = {\n  _id: '_design/DevicesByLocalId',\n  version: 2,\n  views: {\n    'DevicesByLocalId': {\n      map: Object.toString.apply(function(doc) {\n        var _ref;\n        if (((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'device') {\n          return emit(doc.localId, doc);\n        }\n      })\n    }\n  }\n};\n\nmodule.exports = function(db, contactsDB, photosDB, callback) {\n  return async.series([\n    function(cb) {\n      return createOrUpdateDesign(db, FilesAndFolderDesignDoc, cb);\n    }, function(cb) {\n      return createOrUpdateDesign(db, LocalPathDesignDoc, cb);\n    }, function(cb) {\n      return createOrUpdateDesign(db, PathToBinaryDesignDoc, cb);\n    }, function(cb) {\n      return createOrUpdateDesign(contactsDB, ContactsByLocalIdDesignDoc, cb);\n    }, function(cb) {\n      return createOrUpdateDesign(photosDB, PhotosByLocalIdDesignDoc, cb);\n    }, function(cb) {\n      return createOrUpdateDesign(photosDB, DevicesByLocalIdDesignDoc, cb);\n    }\n  ], callback);\n};\n","\n","var ConfigView, DeviceNamePickerView, FirstSyncView, FolderCollection, FolderView, LoginView, Router, app,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\napp = require('application');\n\nFolderView = require('./views/folder');\n\nLoginView = require('./views/login');\n\nDeviceNamePickerView = require('./views/device_name_picker');\n\nFirstSyncView = require('./views/first_sync');\n\nConfigView = require('./views/config');\n\nFolderCollection = require('./collections/files');\n\nmodule.exports = Router = (function(_super) {\n  __extends(Router, _super);\n\n  function Router() {\n    return Router.__super__.constructor.apply(this, arguments);\n  }\n\n  Router.prototype.routes = {\n    'folder/*path': 'folder',\n    'search/*query': 'search',\n    'login': 'login',\n    'device-name-picker': 'deviceNamePicker',\n    'first-sync': 'firstSync',\n    'config': 'config'\n  };\n\n  Router.prototype.folder = function(path) {\n    var backpath, collection, parts;\n    $('#btn-menu, #btn-back').show();\n    if (path === null) {\n      app.layout.setBackButton('#folder/', 'home');\n      app.layout.setTitle('Cozy');\n    } else {\n      parts = path.split('/');\n      backpath = '#folder/' + parts.slice(0, -1).join('/');\n      app.layout.setBackButton(backpath, 'ios7-arrow-back');\n      app.layout.setTitle(parts[parts.length - 1]);\n    }\n    collection = new FolderCollection([], {\n      path: path\n    });\n    this.display(new FolderView({\n      collection: collection\n    }, collection.fetch()));\n    return collection.once('fullsync', (function(_this) {\n      return function() {\n        return _this.trigger('collectionfetched');\n      };\n    })(this));\n  };\n\n  Router.prototype.search = function(query) {\n    var collection;\n    $('#btn-menu, #btn-back').show();\n    app.layout.setBackButton('#folder/', 'home');\n    app.layout.setTitle(t('search') + ' \"' + query + '\"');\n    collection = new FolderCollection([], {\n      query: query\n    });\n    this.display(new FolderView({\n      collection: collection\n    }));\n    return collection.search((function(_this) {\n      return function(err) {\n        if (err) {\n          console.log(err.stack);\n          return alert(err);\n        }\n        return $('#search-input').blur();\n      };\n    })(this));\n  };\n\n  Router.prototype.login = function() {\n    app.layout.setTitle(t('setup 1/3'));\n    $('#btn-menu, #btn-back').hide();\n    return this.display(new LoginView());\n  };\n\n  Router.prototype.deviceNamePicker = function() {\n    app.layout.setTitle(t('setup 2/3'));\n    return this.display(new DeviceNamePickerView());\n  };\n\n  Router.prototype.firstSync = function() {\n    app.layout.setTitle(t('setup end'));\n    return this.display(new FirstSyncView());\n  };\n\n  Router.prototype.config = function() {\n    var titleKey;\n    $('#btn-back').hide();\n    titleKey = app.isFirstRun ? 'setup 3/3' : 'config';\n    app.layout.setTitle(t(titleKey));\n    return this.display(new ConfigView());\n  };\n\n  Router.prototype.display = function(view) {\n    return app.layout.transitionTo(view);\n  };\n\n  Router.prototype.forceRefresh = function() {\n    var col, path, _ref;\n    col = (_ref = app.layout.currentView) != null ? _ref.collection : void 0;\n    if ((col != null ? col.path : void 0) === null) {\n      path = '';\n    } else if ((col != null ? col.path : void 0) !== void 0) {\n      path = col.path;\n    } else {\n      return;\n    }\n    delete FolderCollection.cache[path];\n    return col.fetch();\n  };\n\n  return Router;\n\n})(Backbone.Router);\n","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div class=\"list\"><div class=\"item item-divider\">');\nvar __val__ = t('phone2cozy title')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div>');\nif ( locale == 'digidisk')\n{\nbuf.push('<div class=\"item item-checkbox\">');\nvar __val__ = t('contacts sync label')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('<label class=\"checkbox\"><input');\nbuf.push(attrs({ 'id':('contactSyncCheck'), 'type':(\"checkbox\"), 'checked':(syncContacts) }, {\"type\":true,\"checked\":true}));\nbuf.push('/></label></div>');\n}\nbuf.push('<div class=\"item item-checkbox\">');\nvar __val__ = t('images sync label')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('<label class=\"checkbox\"><input');\nbuf.push(attrs({ 'id':('imageSyncCheck'), 'type':(\"checkbox\"), 'checked':(syncImages) }, {\"type\":true,\"checked\":true}));\nbuf.push('/></label></div><div class=\"item item-checkbox\">');\nvar __val__ = t('wifi sync label')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('<label class=\"checkbox\"><input');\nbuf.push(attrs({ 'id':('wifiSyncCheck'), 'type':(\"checkbox\"), 'checked':(syncOnWifi) }, {\"type\":true,\"checked\":true}));\nbuf.push('/></label></div>');\nif ( firstRun)\n{\nbuf.push('<div class=\"item\"><button id=\"configDone\" class=\"button button-block button-balanced\">');\nvar __val__ = t('next')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</button></div>');\n}\nelse\n{\nbuf.push('<div id=\"doBackup\" class=\"item item-icon-left\"><i class=\"icon ion-clock\"></i><span class=\"text\">');\nvar __val__ = t('last backup')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('&nbsp;' + escape((interp = lastBackup) == null ? '' : interp) + '.</span></div><div class=\"item item-divider\">');\nvar __val__ = t('about')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div class=\"item\">');\nvar __val__ = t('synchronized with') + cozyURL\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div class=\"item\">');\nvar __val__ = t('device name') + ' : ' + deviceName\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div class=\"item\">');\nvar __val__ = t('app name') + ' v 0.1.1'\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div class=\"item item-divider\">');\nvar __val__ = t('reset title')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div style=\"padding-left: 95px; white-space: normal;\" class=\"item item-button-left\"><button id=\"synchrobtn\" class=\"button button-assertive\">');\nvar __val__ = t('retry synchro')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</button>');\nvar __val__ = t('synchro warning')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div style=\"padding-left: 95px; white-space: normal;\" class=\"item item-button-left\"><button id=\"redbtn\" class=\"button button-assertive\">');\nvar __val__ = t('reset action')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</button>');\nvar __val__ = t('reset warning')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div>');\n}\nbuf.push('</div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div id=\"deviceNamePicker\" class=\"list\"><div class=\"card\"><div class=\"item item-text-wrap\">');\nvar __val__ = t('device name explanation')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div></div><div class=\"card\"><label class=\"item item-input item-stacked-label\"><span class=\"input-label\">');\nvar __val__ = t('name device')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</span><input');\nbuf.push(attrs({ 'id':('input-device'), 'type':(\"text\"), 'value':(\"\" + (t('device name placeholder')) + \"\") }, {\"type\":true,\"value\":true}));\nbuf.push('/></label></div><div class=\"button-bar item-input\"><button id=\"btn-back\" class=\"button button-dark icon-left ion-chevron-left button-clear\">');\nvar __val__ = t('back')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</button><button id=\"btn-save\" class=\"button button-balanced\">');\nvar __val__ = t('next')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</button></div></div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div class=\"list\"><div id=\"finishSync\" class=\"card\"><div class=\"progress item item-text-wrap\">');\nvar __val__ = messageText\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div></div><div class=\"item-input\"><button id=\"btn-end\" class=\"button button-block button-balanced\">');\nvar __val__ = buttonText\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</button></div></div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div class=\"item-content\">');\nif ( isFolder)\n{\nbuf.push('<i class=\"icon ion-folder\"></i>');\n}\nelse\n{\nbuf.push('<i class=\"icon ion-document\"></i>');\n}\nbuf.push('<span>');\nvar __val__ = model.name\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</span>');\nif ( isFolder)\n{\nbuf.push('<i class=\"icon ion-chevron-right\"></i>');\n}\nelse if ( model.incache && model.version)\n{\nbuf.push('<i class=\"cache-indicator icon ion-iphone\"></i>');\n}\nelse if ( model.incache)\n{\nbuf.push('<i class=\"cache-indicator-version icon ion-iphone\"></i>');\n}\nelse\n{\nbuf.push('<i class=\"cache-indicator icon ion-ios7-cloud-download-outline\"></i>');\n}\nbuf.push('</div><div class=\"item-options invisible\">');\nif ( model.incache == 'loading')\n{\nbuf.push('<div class=\"button\">');\nvar __val__ = t('loading')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div>');\n}\nelse if ( model.incache)\n{\nbuf.push('<div class=\"button uncache\">');\nvar __val__ = t('remove local')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div>');\n}\nelse\n{\nbuf.push('<div class=\"button download\">');\nvar __val__ = t('download')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div>');\n}\nbuf.push('</div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div id=\"container\" class=\"pane\"><div id=\"bar-header\" class=\"bar bar-header\"><a id=\"btn-menu\" class=\"button button-icon\"><img src=\"img/menu-icon-blue.png\"/></a><h1 id=\"title\" class=\"title\">Loading</h1><a id=\"headerSpinner\" class=\"button button-icon icon ion-looping\"></a></div><div class=\"bar bar-subheader bar-calm\"><h2 id=\"backupIndicator\" class=\"title\"></h2></div><div id=\"viewsPlaceholder\" class=\"scroll-content has-header has-footer\"><div class=\"scroll\"><div class=\"scroll-refresher\"><div class=\"ionic-refresher-content\"><div class=\"icon-pulling\"><i class=\"icon ion-arrow-down-c\"></i>');\nvar __val__ = t('pull to sync')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div class=\"icon-refreshing\"><i class=\"icon ion-loading-d\"></i>');\nvar __val__ = t('syncing')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div></div></div></div></div><div class=\"bar bar-footer\"><a id=\"btn-back\" class=\"button button-icon icon ion-ios7-arrow-back\"></a></div></div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div class=\"list\"><div class=\"card\"><label class=\"item item-input\"><span class=\"input-label\">');\nvar __val__ = t('cozy url')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</span><input');\nbuf.push(attrs({ 'id':('input-url'), 'type':(\"url\"), 'placeholder':(\"john.cozycloud.cc\"), 'value':(\"\" + (defaultValue.cozyURL) + \"\") }, {\"type\":true,\"placeholder\":true,\"value\":true}));\nbuf.push('/></label><label class=\"item item-input\"><span class=\"input-label\">');\nvar __val__ = t('cozy password')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</span><input');\nbuf.push(attrs({ 'id':('input-pass'), 'type':(\"password\"), 'placeholder':(\"\" + (t('password placeholder')) + \"\"), 'value':(\"\" + (defaultValue.password) + \"\") }, {\"type\":true,\"placeholder\":true,\"value\":true}));\nbuf.push('/></label><button id=\"btn-save\" class=\"button button-block button-balanced item\">');\nvar __val__ = t('next')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</button></div></div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div class=\"bar bar-header bar-dark\"><h1 class=\"title\">Menu</h1></div><div class=\"content has-header\"><div class=\"item item-input-inset\"><label class=\"item-input-wrapper\"><input');\nbuf.push(attrs({ 'id':('search-input'), 'type':(\"text\"), 'placeholder':(t(\"search\")) }, {\"type\":true,\"placeholder\":true}));\nbuf.push('/></label><a id=\"btn-search\" class=\"button button-icon icon ion-search\"></a></div><a href=\"#folder/\" class=\"item item-icon-left\"><i class=\"icon ion-home\"></i>');\nvar __val__ = t('home')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</a><a href=\"#config\" class=\"item item-icon-left\"><i class=\"icon ion-wrench\"></i>');\nvar __val__ = t('config')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</a><a id=\"backupButton\" class=\"item item-icon-left\"><i class=\"icon ion-ios7-cloud-upload-outline\"></i>');\nvar __val__ = t('backup')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</a></div>');\n}\nreturn buf.join(\"\");\n};","var BaseView, ConfigView,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nmodule.exports = ConfigView = (function(_super) {\n  __extends(ConfigView, _super);\n\n  function ConfigView() {\n    return ConfigView.__super__.constructor.apply(this, arguments);\n  }\n\n  ConfigView.prototype.template = require('../templates/config');\n\n  ConfigView.prototype.menuEnabled = true;\n\n  ConfigView.prototype.events = function() {\n    return {\n      'tap #configDone': 'configDone',\n      'tap #redbtn': 'redBtn',\n      'tap #synchrobtn': 'synchroBtn',\n      'tap #contactSyncCheck': 'saveChanges',\n      'tap #imageSyncCheck': 'saveChanges',\n      'tap #wifiSyncCheck': 'saveChanges'\n    };\n  };\n\n  ConfigView.prototype.getRenderData = function() {\n    var config;\n    config = app.replicator.config.toJSON();\n    return _.extend({}, config, {\n      lastSync: this.formatDate(config != null ? config.lastSync : void 0),\n      lastBackup: this.formatDate(config != null ? config.lastBackup : void 0),\n      firstRun: app.isFirstRun,\n      locale: app.locale\n    });\n  };\n\n  ConfigView.prototype.formatDate = function(date) {\n    if (!date) {\n      return t('never');\n    } else {\n      if (!(date instanceof Date)) {\n        date = new Date(date);\n      }\n      return date.toDateString() + ' ' + date.toTimeString();\n    }\n  };\n\n  ConfigView.prototype.configDone = function() {\n    return app.router.navigate('first-sync', {\n      trigger: true\n    });\n  };\n\n  ConfigView.prototype.redBtn = function() {\n    if (confirm(t('confirm message'))) {\n      return app.replicator.destroyDB((function(_this) {\n        return function(err) {\n          if (err) {\n            return alert(err.message);\n          }\n          $('#redbtn').text(t('done'));\n          return window.location.reload(true);\n        };\n      })(this));\n    }\n  };\n\n  ConfigView.prototype.synchroBtn = function() {\n    if (confirm(t('confirm message'))) {\n      return app.replicator.resetSynchro((function(_this) {\n        return function(err) {\n          if (err) {\n            return alert(err.message);\n          }\n          return app.router.navigate('first-sync', {\n            trigger: true\n          });\n        };\n      })(this));\n    }\n  };\n\n  ConfigView.prototype.saveChanges = function() {\n    this.$('#contactSyncCheck, #imageSyncCheck, #wifiSyncCheck').prop('disabled', true);\n    return app.replicator.config.save({\n      syncContacts: this.$('#contactSyncCheck').is(':checked'),\n      syncImages: this.$('#imageSyncCheck').is(':checked'),\n      syncOnWifi: this.$('#wifiSyncCheck').is(':checked')\n    }, (function(_this) {\n      return function() {\n        return _this.$('#contactSyncCheck, #imageSyncCheck, #wifiSyncCheck').prop('disabled', false);\n      };\n    })(this));\n  };\n\n  return ConfigView;\n\n})(BaseView);\n","var BaseView, DeviceNamePickerView,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nmodule.exports = DeviceNamePickerView = (function(_super) {\n  __extends(DeviceNamePickerView, _super);\n\n  function DeviceNamePickerView() {\n    return DeviceNamePickerView.__super__.constructor.apply(this, arguments);\n  }\n\n  DeviceNamePickerView.prototype.className = 'list';\n\n  DeviceNamePickerView.prototype.template = require('../templates/device_name_picker');\n\n  DeviceNamePickerView.prototype.events = function() {\n    return {\n      'blur #input-device': 'onCompleteDefaultValue',\n      'focus #input-device': 'onRemoveDefaultValue',\n      'click #btn-back': 'doBack',\n      'keypress #input-device': 'blurIfEnter'\n    };\n  };\n\n  DeviceNamePickerView.prototype.doBack = function() {\n    return app.router.navigate('login', {\n      trigger: true\n    });\n  };\n\n  DeviceNamePickerView.prototype.blurIfEnter = function(e) {\n    if (e.keyCode === 13) {\n      return this.$('#input-device').blur();\n    }\n  };\n\n  DeviceNamePickerView.prototype.doSave = function() {\n    var config, device;\n    if (this.saving) {\n      return null;\n    }\n    this.saving = $('#btn-save').text();\n    if (this.error) {\n      this.error.remove();\n    }\n    device = this.$('#input-device').val();\n    if (!device) {\n      return this.displayError('all fields are required');\n    }\n    config = app.loginConfig;\n    config.deviceName = device;\n    $('#btn-save').text(t('registering...'));\n    return app.replicator.registerRemote(config, (function(_this) {\n      return function(err) {\n        var noop;\n        if (err != null) {\n          return _this.displayError(err.message);\n        } else {\n          delete app.loginConfig;\n          app.isFirstRun = true;\n          console.log('starting first replication');\n          noop = function() {};\n          app.replicator.initialReplication(noop);\n          return app.router.navigate('config', {\n            trigger: true\n          });\n        }\n      };\n    })(this));\n  };\n\n  DeviceNamePickerView.prototype.onCompleteDefaultValue = function() {\n    var device;\n    device = this.$('#input-device').val();\n    if (device === '') {\n      return this.$('#input-device').val(t('device name placeholder'));\n    }\n  };\n\n  DeviceNamePickerView.prototype.onRemoveDefaultValue = function() {\n    var device;\n    device = this.$('#input-device').val();\n    if (device === t('device name placeholder')) {\n      return this.$('#input-device').val('');\n    }\n  };\n\n  DeviceNamePickerView.prototype.displayError = function(text, field) {\n    $('#btn-save').text(this.saving);\n    this.saving = false;\n    if (this.error) {\n      this.error.remove();\n    }\n    if (~text.indexOf('CORS request rejected')) {\n      text = t('connection failure');\n    }\n    this.error = $('<div>').addClass('button button-full button-energized');\n    this.error.text(text);\n    return this.$(field || 'label').after(this.error);\n  };\n\n  return DeviceNamePickerView;\n\n})(BaseView);\n","var BaseView, FirstSyncView,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nmodule.exports = FirstSyncView = (function(_super) {\n  __extends(FirstSyncView, _super);\n\n  function FirstSyncView() {\n    return FirstSyncView.__super__.constructor.apply(this, arguments);\n  }\n\n  FirstSyncView.prototype.className = 'list';\n\n  FirstSyncView.prototype.template = require('../templates/first_sync');\n\n  FirstSyncView.prototype.events = function() {\n    return {\n      'tap #btn-end': 'end'\n    };\n  };\n\n  FirstSyncView.prototype.getRenderData = function() {\n    var buttonText, messageText, step;\n    step = app.replicator.get('initialReplicationStep');\n    console.log(\"onChange : \" + step);\n    if (step === 3) {\n      messageText = t('ready message');\n      buttonText = t('end');\n    } else {\n      messageText = t(\"message step \" + step);\n      buttonText = t('waiting...');\n    }\n    return {\n      messageText: messageText,\n      buttonText: buttonText\n    };\n  };\n\n  FirstSyncView.prototype.initialize = function() {\n    return this.listenTo(app.replicator, 'change:initialReplicationStep', this.onChange);\n  };\n\n  FirstSyncView.prototype.onChange = function(replicator) {\n    var step;\n    step = replicator.get('initialReplicationStep');\n    this.$('#finishSync .progress').text(t(\"message step \" + step));\n    return (this.render() === step && step === 3);\n  };\n\n  FirstSyncView.prototype.end = function() {\n    var step;\n    step = parseInt(app.replicator.get('initialReplicationStep'));\n    console.log(\"end \" + step);\n    if (step !== 3) {\n      return;\n    }\n    app.replicator.backup(function(err) {\n      if (err) {\n        alert(err);\n      }\n      return console.log(\"pics & contacts synced\");\n    });\n    app.isFirstRun = false;\n    return app.router.navigate('folder/', {\n      trigger: true\n    });\n  };\n\n  return FirstSyncView;\n\n})(BaseView);\n","var CollectionView, FolderView,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nCollectionView = require('../lib/view_collection');\n\nmodule.exports = FolderView = (function(_super) {\n  __extends(FolderView, _super);\n\n  function FolderView() {\n    this.displaySlider = __bind(this.displaySlider, this);\n    this.remove = __bind(this.remove, this);\n    this.appendView = __bind(this.appendView, this);\n    this.onChange = __bind(this.onChange, this);\n    return FolderView.__super__.constructor.apply(this, arguments);\n  }\n\n  FolderView.prototype.className = 'list';\n\n  FolderView.prototype.itemview = require('./folder_line');\n\n  FolderView.prototype.pullToRefreshEnabled = true;\n\n  FolderView.prototype.menuEnabled = true;\n\n  FolderView.prototype.events = function() {\n    return {\n      'tap .cache-indicator': 'displaySlider',\n      'hold .item': 'displaySlider'\n    };\n  };\n\n  FolderView.prototype.isParentOf = function(otherFolderView) {\n    if (this.collection.path === null) {\n      return true;\n    }\n    if (this.collection.isSearch()) {\n      return false;\n    }\n    if (!otherFolderView.collection.path) {\n      return false;\n    }\n    return -1 !== otherFolderView.collection.path.indexOf(this.collection.path);\n  };\n\n  FolderView.prototype.initialize = function() {\n    FolderView.__super__.initialize.apply(this, arguments);\n    return this.listenTo(this.collection, 'sync', this.onChange);\n  };\n\n  FolderView.prototype.afterRender = function() {\n    var _ref;\n    if ((_ref = this.ionicView) != null) {\n      _ref.destroy();\n    }\n    FolderView.__super__.afterRender.apply(this, arguments);\n    return this.ionicView = new ionic.views.ListView({\n      el: this.$el[0],\n      _handleDrag: function(e) {\n        ionic.views.ListView.prototype._handleDrag.apply(this, arguments);\n        e.preventDefault();\n        return e.stopPropagation();\n      }\n    });\n  };\n\n  FolderView.prototype.onChange = function() {\n    var message;\n    this.$('#empty-message').remove();\n    if (_.size(this.views) === 0) {\n      message = this.collection.notloaded ? 'loading' : this.collection.isSearch() ? 'no results' : 'this folder is empty';\n      return $('<li class=\"item\" id=\"empty-message\">').text(t(message)).appendTo(this.$el);\n    }\n  };\n\n  FolderView.prototype.appendView = function(view) {\n    FolderView.__super__.appendView.apply(this, arguments);\n    return view.parent = this;\n  };\n\n  FolderView.prototype.remove = function() {\n    FolderView.__super__.remove.apply(this, arguments);\n    return this.collection.cancelFetchAdditional();\n  };\n\n  FolderView.prototype.displaySlider = function(event) {\n    var dX, op;\n    console.log(\"DISPLAY SLIDER\");\n    this.ionicView.clearDragEffects();\n    op = new ionic.SlideDrag({\n      el: this.ionicView.el,\n      canSwipe: function() {\n        return true;\n      }\n    });\n    op.start({\n      target: event.target\n    });\n    dX = op._currentDrag.startOffsetX === 0 ? 0 - op._currentDrag.buttonsWidth : op._currentDrag.buttonsWidth;\n    op.end({\n      gesture: {\n        deltaX: dX,\n        direction: 'right'\n      }\n    });\n    ionic.requestAnimationFrame((function(_this) {\n      return function() {\n        return _this.ionicView._lastDragOp = op;\n      };\n    })(this));\n    event.preventDefault();\n    return event.stopPropagation();\n  };\n\n  return FolderView;\n\n})(CollectionView);\n","var BaseView, FolderLineView,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nmodule.exports = FolderLineView = (function(_super) {\n  __extends(FolderLineView, _super);\n\n  function FolderLineView() {\n    this.removeFromCache = __bind(this.removeFromCache, this);\n    this.addToCache = __bind(this.addToCache, this);\n    this.onClick = __bind(this.onClick, this);\n    this.updateProgress = __bind(this.updateProgress, this);\n    this.hideProgress = __bind(this.hideProgress, this);\n    this.displayProgress = __bind(this.displayProgress, this);\n    this.setCacheIcon = __bind(this.setCacheIcon, this);\n    this.afterRender = __bind(this.afterRender, this);\n    this.initialize = __bind(this.initialize, this);\n    return FolderLineView.__super__.constructor.apply(this, arguments);\n  }\n\n  FolderLineView.prototype.tagName = 'a';\n\n  FolderLineView.prototype.template = require('../templates/folder_line');\n\n  FolderLineView.prototype.events = {\n    'tap .item-content': 'onClick',\n    'tap .item-options .download': 'addToCache',\n    'tap .item-options .uncache': 'removeFromCache'\n  };\n\n  FolderLineView.prototype.className = 'item item-icon-left item-icon-right item-complex';\n\n  FolderLineView.prototype.initialize = function() {\n    return this.listenTo(this.model, 'change', this.render);\n  };\n\n  FolderLineView.prototype.getRenderData = function() {\n    return _.extend(FolderLineView.__super__.getRenderData.apply(this, arguments), {\n      isFolder: this.model.isFolder()\n    });\n  };\n\n  FolderLineView.prototype.afterRender = function() {\n    return this.$el[0].dataset.folderid = this.model.get('_id');\n  };\n\n  FolderLineView.prototype.setCacheIcon = function(klass) {\n    var icon, _ref, _ref1;\n    icon = this.$('.cache-indicator');\n    icon.removeClass('ion-warning ion-looping ion-ios7-cloud-download-outline');\n    icon.removeClass('ion-ios7-download-outline').addClass(klass);\n    return (_ref = this.parent) != null ? (_ref1 = _ref.ionicView) != null ? _ref1.clearDragEffects() : void 0 : void 0;\n  };\n\n  FolderLineView.prototype.displayProgress = function() {\n    this.downloading = true;\n    this.hideProgress();\n    this.setCacheIcon('ion-looping');\n    this.progresscontainer = $('<div class=\"item-progress\"></div>').append(this.progressbar = $('<div class=\"item-progress-bar\"></div>'));\n    return this.progresscontainer.appendTo(this.$el);\n  };\n\n  FolderLineView.prototype.hideProgress = function(err, incache) {\n    var version, _ref;\n    this.downloading = false;\n    if (err) {\n      alert(err);\n    }\n    incache = app.replicator.fileInFileSystem;\n    version = app.replicator.fileVersion;\n    if ((incache != null) && incache !== this.model.get('incache')) {\n      this.model.set({\n        incache: incache\n      });\n    }\n    if ((version != null) && version !== this.model.get('version')) {\n      this.model.set({\n        version: version\n      });\n    }\n    return (_ref = this.progresscontainer) != null ? _ref.remove() : void 0;\n  };\n\n  FolderLineView.prototype.updateProgress = function(done, total) {\n    var _ref;\n    return (_ref = this.progressbar) != null ? _ref.css('width', (100 * done / total) + '%') : void 0;\n  };\n\n  FolderLineView.prototype.onClick = function(event) {\n    var path;\n    if ($(event.target).closest('.cache-indicator').length) {\n      return true;\n    }\n    if (this.downloading) {\n      return true;\n    }\n    if (this.model.isFolder()) {\n      path = this.model.get('path') + '/' + this.model.get('name');\n      app.router.navigate(\"#folder\" + path, {\n        trigger: true\n      });\n      return true;\n    }\n    this.displayProgress();\n    return app.replicator.getBinary(this.model.attributes, this.updateProgress, (function(_this) {\n      return function(err, url) {\n        _this.hideProgress();\n        if (err) {\n          return alert(err);\n        }\n        _this.model.set({\n          incache: true\n        });\n        _this.model.set({\n          version: app.replicator.fileVersion(_this.model.attributes)\n        });\n        app.backFromOpen = true;\n        return ExternalFileUtil.openWith(url, '', void 0, function(success) {}, function(err) {\n          if (0 === (err != null ? err.indexOf('No Activity found') : void 0)) {\n            err = t('no activity found');\n          }\n          alert(err);\n          return console.log(err);\n        });\n      };\n    })(this));\n  };\n\n  FolderLineView.prototype.addToCache = function() {\n    var onadded;\n    if (this.downloading) {\n      return true;\n    }\n    this.displayProgress();\n    onadded = (function(_this) {\n      return function(err) {\n        _this.hideProgress();\n        if (err) {\n          return alert(err);\n        }\n        _this.model.set({\n          incache: true\n        });\n        return _this.model.set({\n          version: app.replicator.fileVersion(_this.model.attributes)\n        });\n      };\n    })(this);\n    if (this.model.isFolder()) {\n      return app.replicator.getBinaryFolder(this.model.attributes, this.updateProgress, onadded);\n    } else {\n      return app.replicator.getBinary(this.model.attributes, this.updateProgress, onadded);\n    }\n  };\n\n  FolderLineView.prototype.removeFromCache = function() {\n    var onremoved;\n    if (this.downloading) {\n      return true;\n    }\n    this.displayProgress();\n    onremoved = (function(_this) {\n      return function(err) {\n        _this.hideProgress();\n        if (err) {\n          return alert(err);\n        }\n        return _this.model.set({\n          incache: false\n        });\n      };\n    })(this);\n    if (this.model.isFolder()) {\n      return app.replicator.removeLocalFolder(this.model.attributes, onremoved);\n    } else {\n      return app.replicator.removeLocal(this.model.attributes, onremoved);\n    }\n  };\n\n  return FolderLineView;\n\n})(BaseView);\n","var BaseView, FolderView, Layout, Menu,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nFolderView = require('./folder');\n\nMenu = require('./menu');\n\nmodule.exports = Layout = (function(_super) {\n  __extends(Layout, _super);\n\n  function Layout() {\n    this.onBackButtonClicked = __bind(this.onBackButtonClicked, this);\n    this.onSearchButtonClicked = __bind(this.onSearchButtonClicked, this);\n    this.onMenuButtonClicked = __bind(this.onMenuButtonClicked, this);\n    this.setTitle = __bind(this.setTitle, this);\n    this.setBackButton = __bind(this.setBackButton, this);\n    this.closeMenu = __bind(this.closeMenu, this);\n    this.togglePullToRefresh = __bind(this.togglePullToRefresh, this);\n    return Layout.__super__.constructor.apply(this, arguments);\n  }\n\n  Layout.prototype.template = require('../templates/layout');\n\n  Layout.prototype.events = function() {\n    return {\n      'tap #btn-back': 'onBackButtonClicked',\n      'tap #btn-menu': 'onMenuButtonClicked'\n    };\n  };\n\n  Layout.prototype.initialize = function() {\n    var OpEvents;\n    document.addEventListener(\"menubutton\", this.onMenuButtonClicked, false);\n    document.addEventListener(\"searchbutton\", this.onSearchButtonClicked, false);\n    document.addEventListener(\"backbutton\", this.onBackButtonClicked, false);\n    this.listenTo(app.replicator, 'change:inSync change:inBackup', (function(_this) {\n      return function() {\n        var inBackup, inSync;\n        inSync = app.replicator.get('inSync');\n        inBackup = app.replicator.get('inBackup');\n        _this.spinner.toggle(inSync || inBackup);\n        return _this.refresher.toggleClass('refreshing', inSync);\n      };\n    })(this));\n    OpEvents = 'change:inBackup change:backup_step change:backup_step_done';\n    return this.listenTo(app.replicator, OpEvents, _.debounce((function(_this) {\n      return function() {\n        var step, text;\n        step = app.replicator.get('backup_step');\n        if (step && (step !== 'pictures_scan' && step !== 'contacts_scan')) {\n          text = t(step);\n          if (app.replicator.get('backup_step_done')) {\n            text += \": \" + (app.replicator.get('backup_step_done'));\n            text += \"/\" + (app.replicator.get('backup_step_total'));\n          }\n          _this.backupIndicator.text(text).parent().slideDown();\n          return _this.viewsPlaceholder.addClass('has-subheader');\n        } else {\n          _this.backupIndicator.parent().slideUp();\n          return _this.viewsPlaceholder.removeClass('has-subheader');\n        }\n      };\n    })(this), 100));\n  };\n\n  Layout.prototype.afterRender = function() {\n    var onActive, onClose, onStart;\n    this.menu = new Menu();\n    this.menu.render();\n    this.$el.append(this.menu.$el);\n    this.container = this.$('#container');\n    this.viewsPlaceholder = this.$('#viewsPlaceholder');\n    this.viewsBlock = this.viewsPlaceholder.find('.scroll');\n    this.refresher = this.viewsBlock.find('.scroll-refresher');\n    this.backButton = this.container.find('#btn-back');\n    this.menuButton = this.container.find('#btn-menu');\n    this.spinner = this.container.find('#headerSpinner');\n    this.spinner.hide();\n    this.title = this.container.find('#title');\n    this.backupIndicator = this.container.find('#backupIndicator');\n    this.backupIndicator.parent().hide();\n    this.ionicContainer = new ionic.views.SideMenuContent({\n      el: this.container[0]\n    });\n    this.ionicMenu = new ionic.views.SideMenu({\n      el: this.menu.$el[0],\n      width: 270\n    });\n    this.controller = new ionic.controllers.SideMenuController({\n      content: this.ionicContainer,\n      left: this.ionicMenu\n    });\n    this.ionicScroll = new ionic.views.Scroll({\n      el: this.viewsPlaceholder[0]\n    });\n    this.ionicScroll.scrollTo(1, 0, true, null);\n    this.ionicScroll.scrollTo(0, 0, true, null);\n    return this.ionicScroll.activatePullToRefresh(50, onActive = (function(_this) {\n      return function() {\n        _this.refresher.addClass('active');\n        return console.log(\"ON ACTIVE\");\n      };\n    })(this), onClose = (function(_this) {\n      return function() {\n        console.log(\"ON CLOSE\");\n        return _this.refresher.removeClass('active');\n      };\n    })(this), onStart = (function(_this) {\n      return function() {\n        _this.ionicScroll.finishPullToRefresh();\n        return app.replicator.sync(function(err) {\n          if (err) {\n            return console.log(err);\n          }\n        });\n      };\n    })(this));\n  };\n\n  Layout.prototype.togglePullToRefresh = function(activated) {\n    this.refresher.toggle(activated);\n    this.ionicScroll.options.bouncing = activated;\n    return this.ionicScroll.__refreshHeight = activated ? 50 : null;\n  };\n\n  Layout.prototype.closeMenu = function() {\n    return this.controller.toggleLeft(false);\n  };\n\n  Layout.prototype.setBackButton = function(href, icon) {\n    this.backButton.attr('href', href);\n    this.backButton.removeClass('ion-home ion-ios7-arrow-back');\n    return this.backButton.addClass('ion-' + icon);\n  };\n\n  Layout.prototype.setTitle = function(text) {\n    return this.title.text(text);\n  };\n\n  Layout.prototype.transitionTo = function(view) {\n    var $next, currClass, menuEnabled, nextClass, ptrEnabled, transitionend, type, _ref;\n    this.closeMenu();\n    $next = view.render().$el;\n    ptrEnabled = (view.pullToRefreshEnabled != null) && view.pullToRefreshEnabled;\n    this.togglePullToRefresh(ptrEnabled);\n    menuEnabled = (view.menuEnabled != null) && view.menuEnabled;\n    this.ionicMenu.setIsEnabled(menuEnabled);\n    if (this.currentView instanceof FolderView && view instanceof FolderView) {\n      type = this.currentView.isParentOf(view) ? 'left' : 'right';\n    } else {\n      type = 'none';\n    }\n    if (type === 'none') {\n      if ((_ref = this.currentView) != null) {\n        _ref.remove();\n      }\n      this.viewsBlock.append($next);\n      this.ionicScroll.hintResize();\n      return this.currentView = view;\n    } else {\n      nextClass = type === 'left' ? 'sliding-next' : 'sliding-prev';\n      currClass = type === 'left' ? 'sliding-prev' : 'sliding-next';\n      $next.addClass(nextClass);\n      this.viewsBlock.append($next);\n      $next.width();\n      this.currentView.$el.addClass(currClass);\n      $next.removeClass(nextClass);\n      transitionend = 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend';\n      return $next.one(transitionend, _.once((function(_this) {\n        return function() {\n          _this.currentView.remove();\n          _this.currentView = view;\n          return _this.ionicScroll.scrollTo(0, 0, true, null);\n        };\n      })(this)));\n    }\n  };\n\n  Layout.prototype.onMenuButtonClicked = function() {\n    this.menu.reset();\n    return this.controller.toggleLeft();\n  };\n\n  Layout.prototype.onSearchButtonClicked = function() {\n    this.onMenuButtonClicked();\n    return this.$('#search-input').focus();\n  };\n\n  Layout.prototype.onBackButtonClicked = function(event) {\n    app.router.navigate(this.backButton.attr('href'), {\n      trigger: true\n    });\n    event.preventDefault();\n    return event.stopPropagation();\n  };\n\n  return Layout;\n\n})(BaseView);\n","var BaseView, LoginView,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nmodule.exports = LoginView = (function(_super) {\n  __extends(LoginView, _super);\n\n  function LoginView() {\n    return LoginView.__super__.constructor.apply(this, arguments);\n  }\n\n  LoginView.prototype.className = 'list';\n\n  LoginView.prototype.template = require('../templates/login');\n\n  LoginView.prototype.events = function() {\n    return {\n      'click #btn-save': 'doSave',\n      'click #input-pass': 'doComplete'\n    };\n  };\n\n  LoginView.prototype.getRenderData = function() {\n    var defaultValue;\n    defaultValue = app.loginConfig || {\n      cozyURL: '',\n      password: ''\n    };\n    return {\n      defaultValue: defaultValue\n    };\n  };\n\n  LoginView.prototype.doComplete = function() {\n    var url;\n    url = this.$('#input-url').val();\n    if (url.indexOf('.') === -1 && url.length > 0) {\n      return this.$('#input-url').val(url + \".cozycloud.cc\");\n    }\n  };\n\n  LoginView.prototype.doSave = function() {\n    var config, pass, url;\n    if (this.saving) {\n      return null;\n    }\n    this.saving = $('#btn-save').text();\n    if (this.error) {\n      this.error.remove();\n    }\n    url = this.$('#input-url').val();\n    pass = this.$('#input-pass').val();\n    if (!(url && pass)) {\n      return this.displayError('all fields are required');\n    }\n    if (url.slice(0, 4) === 'http') {\n      url = url.replace('https://', '').replace('http://', '');\n      this.$('#input-url').val(url);\n    }\n    if (url[url.length - 1] === '/') {\n      this.$('#input-url').val(url = url.slice(0, -1));\n    }\n    config = {\n      cozyURL: url,\n      password: pass\n    };\n    $('#btn-save').text(t('authenticating...'));\n    return app.replicator.checkCredentials(config, (function(_this) {\n      return function(error) {\n        if (error != null) {\n          return _this.displayError(error);\n        } else {\n          app.loginConfig = config;\n          console.log('check credentials done');\n          return app.router.navigate('device-name-picker', {\n            trigger: true\n          });\n        }\n      };\n    })(this));\n  };\n\n  LoginView.prototype.displayError = function(text, field) {\n    $('#btn-save').text(this.saving);\n    this.saving = false;\n    if (this.error) {\n      this.error.remove();\n    }\n    if (~text.indexOf('CORS request rejected')) {\n      text = t('connection failure');\n    }\n    this.error = $('<div>').addClass('button button-full button-energized');\n    this.error.text(text);\n    return this.$(field || '#btn-save').before(this.error);\n  };\n\n  return LoginView;\n\n})(BaseView);\n","var BaseView, Menu,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nmodule.exports = Menu = (function(_super) {\n  var setLooping;\n\n  __extends(Menu, _super);\n\n  function Menu() {\n    this.doSearchIfEnter = __bind(this.doSearchIfEnter, this);\n    return Menu.__super__.constructor.apply(this, arguments);\n  }\n\n  Menu.prototype.id = 'menu';\n\n  Menu.prototype.className = 'menu menu-left';\n\n  Menu.prototype.template = require('../templates/menu');\n\n  Menu.prototype.events = {\n    'click #syncButton': 'sync',\n    'click #backupButton': 'backup',\n    'click #btn-search': 'doSearch',\n    'click a.item': 'closeMenu',\n    'keydown #search-input': 'doSearchIfEnter'\n  };\n\n  setLooping = function(btn, looping) {\n    var newIcon, oldIcon;\n    oldIcon = looping ? 'ion-ios7-cloud-upload-outline' : 'ion-looping';\n    newIcon = looping ? 'ion-looping' : 'ion-ios7-cloud-upload-outline';\n    return btn.find('i').removeClass(oldIcon).addClass(newIcon);\n  };\n\n  Menu.prototype.afterRender = function() {\n    this.syncButton = this.$('#syncButton');\n    this.backupButton = this.$('#backupButton');\n    this.listenTo(app.replicator, 'change:inSync', (function(_this) {\n      return function() {\n        return setLooping(_this.syncButton, app.replicator.get('inSync'));\n      };\n    })(this));\n    this.listenTo(app.replicator, 'change:inBackup', (function(_this) {\n      return function() {\n        return setLooping(_this.backupButton, app.replicator.get('inBackup'));\n      };\n    })(this));\n    setLooping(this.syncButton, app.replicator.get('inSync'));\n    return setLooping(this.backupButton, app.replicator.get('inBackup'));\n  };\n\n  Menu.prototype.closeMenu = function() {\n    return app.layout.closeMenu();\n  };\n\n  Menu.prototype.sync = function() {\n    if (app.replicator.get('inSync')) {\n      return;\n    }\n    app.layout.closeMenu();\n    return app.replicator.sync(function(err) {\n      var _ref, _ref1;\n      if (err) {\n        console.log(err, err.stack);\n      }\n      if (err) {\n        alert(err);\n      }\n      return (_ref = app.layout.currentView) != null ? (_ref1 = _ref.collection) != null ? _ref1.fetch() : void 0 : void 0;\n    });\n  };\n\n  Menu.prototype.backup = function() {\n    if (app.replicator.get('inBackup')) {\n      return;\n    }\n    app.layout.closeMenu();\n    return app.replicator.backup(function(err) {\n      var _ref, _ref1;\n      if (err) {\n        console.log(err, err.stack);\n      }\n      if (err) {\n        alert(err);\n      }\n      return (_ref = app.layout.currentView) != null ? (_ref1 = _ref.collection) != null ? _ref1.fetch() : void 0 : void 0;\n    });\n  };\n\n  Menu.prototype.doSearchIfEnter = function(event) {\n    if (event.which === 13) {\n      return this.doSearch();\n    }\n  };\n\n  Menu.prototype.doSearch = function() {\n    var val;\n    val = $('#search-input').val();\n    if (val.length === 0) {\n      return true;\n    }\n    app.layout.closeMenu();\n    return app.router.navigate('#search/' + val, {\n      trigger: true\n    });\n  };\n\n  Menu.prototype.reset = function() {\n    return this.$('#search-input').blur().val('');\n  };\n\n  return Menu;\n\n})(BaseView);\n"]}